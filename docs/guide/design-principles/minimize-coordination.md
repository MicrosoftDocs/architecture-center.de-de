---
title: Minimieren der Koordination
titleSuffix: Azure Application Architecture Guide
description: Minimieren Sie die Koordinierung zwischen Anwendungsdiensten, um Skalierbarkeit zu erzielen.
author: MikeWasson
ms.date: 08/30/2018
ms.topic: guide
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: seojan19
ms.openlocfilehash: e124e6720b909bafc74a4c074454ec0a3ec30c59
ms.sourcegitcommit: 1b50810208354577b00e89e5c031b774b02736e2
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 01/23/2019
ms.locfileid: "54488578"
---
# <a name="minimize-coordination"></a><span data-ttu-id="5464f-103">Minimieren der Koordination</span><span class="sxs-lookup"><span data-stu-id="5464f-103">Minimize coordination</span></span>

## <a name="minimize-coordination-between-application-services-to-achieve-scalability"></a><span data-ttu-id="5464f-104">Minimieren Sie die Koordination zwischen Anwendungsdiensten, um Skalierbarkeit zu erzielen.</span><span class="sxs-lookup"><span data-stu-id="5464f-104">Minimize coordination between application services to achieve scalability</span></span>

<span data-ttu-id="5464f-105">Die meisten Cloudanwendungen bestehen aus mehreren Anwendungsdiensten – Web-Front-Ends, Datenbanken, Geschäftsprozessen, Bericht- und Analysefunktionen und vielem mehr.</span><span class="sxs-lookup"><span data-stu-id="5464f-105">Most cloud applications consist of multiple application services &mdash; web front ends, databases, business processes, reporting and analysis, and so on.</span></span> <span data-ttu-id="5464f-106">Um Skalierbarkeit und Zuverlässigkeit zu erzielen, sollte jeder dieser Dienste auf mehreren Instanzen ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="5464f-106">To achieve scalability and reliability, each of those services should run on multiple instances.</span></span>

<span data-ttu-id="5464f-107">Was passiert, wenn zwei Instanzen versuchen, gleichzeitige Vorgänge auszuführen, die einen gemeinsamen Status betreffen?</span><span class="sxs-lookup"><span data-stu-id="5464f-107">What happens when two instances try to perform concurrent operations that affect some shared state?</span></span> <span data-ttu-id="5464f-108">In einigen Fällen muss eine Koordination zwischen den Knoten stattfinden, um beispielsweise die Einhaltung von ACID-Garantien (Atomarität, Konsistenz, Isolation, Dauerhaftigkeit) sicherzustellen.</span><span class="sxs-lookup"><span data-stu-id="5464f-108">In some cases, there must be coordination across nodes, for example to preserve ACID guarantees.</span></span> <span data-ttu-id="5464f-109">In diesem Diagramm wartet `Node2` auf `Node1`, um eine Datenbanksperre aufzuheben:</span><span class="sxs-lookup"><span data-stu-id="5464f-109">In this diagram, `Node2` is waiting for `Node1` to release a database lock:</span></span>

![Diagramm der Datenbanksperre](./images/database-lock.svg)

<span data-ttu-id="5464f-111">Die Koordination schränkt die Vorteile der horizontalen Skalierung ein und verursacht Engpässe.</span><span class="sxs-lookup"><span data-stu-id="5464f-111">Coordination limits the benefits of horizontal scale and creates bottlenecks.</span></span> <span data-ttu-id="5464f-112">In diesem Beispiel werden Sie vermehrt Sperrkonflikte bemerken, wenn Sie die Anwendung horizontal hochskalieren und weitere Instanzen hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="5464f-112">In this example, as you scale out the application and add more instances, you'll see increased lock contention.</span></span> <span data-ttu-id="5464f-113">Im schlimmsten Fall warten die Front-End-Instanzen den größten Teil ihrer Zeit auf Sperren.</span><span class="sxs-lookup"><span data-stu-id="5464f-113">In the worst case, the front-end instances will spend most of their time waiting on locks.</span></span>

<span data-ttu-id="5464f-114">Eine „Exactly-Once“-Semantik ist eine weitere häufige Quelle der Koordination.</span><span class="sxs-lookup"><span data-stu-id="5464f-114">"Exactly once" semantics are another frequent source of coordination.</span></span> <span data-ttu-id="5464f-115">Ein Beispiel: Ein Auftrag muss genau einmal verarbeitet werden.</span><span class="sxs-lookup"><span data-stu-id="5464f-115">For example, an order must be processed exactly once.</span></span> <span data-ttu-id="5464f-116">Zwei Worker lauschen auf neue Aufträge.</span><span class="sxs-lookup"><span data-stu-id="5464f-116">Two workers are listening for new orders.</span></span> <span data-ttu-id="5464f-117">`Worker1` nimmt einen Auftrag zur Verarbeitung an.</span><span class="sxs-lookup"><span data-stu-id="5464f-117">`Worker1` picks up an order for processing.</span></span> <span data-ttu-id="5464f-118">Die Anwendung muss sicherstellen, dass einerseits `Worker2` keine doppelte Arbeit verrichtet und dass andererseits der Auftrag nicht verworfen wird, wenn `Worker1` abstürzt.</span><span class="sxs-lookup"><span data-stu-id="5464f-118">The application must ensure that `Worker2` doesn't duplicate the work, but also if `Worker1` crashes, the order isn't dropped.</span></span>

![Koordinationsdiagramm](./images/coordination.svg)

<span data-ttu-id="5464f-120">Sie können ein Muster wie [Scheduler-Agent-Supervisor][sas-pattern] verwenden, um die Koordination zwischen den Workern sicherzustellen. In diesem Fall wäre allerdings eine Partitionierung der Aufgaben vermutlich der bessere Ansatz.</span><span class="sxs-lookup"><span data-stu-id="5464f-120">You can use a pattern such as [Scheduler Agent Supervisor][sas-pattern] to coordinate between the workers, but in this case a better approach might be to partition the work.</span></span> <span data-ttu-id="5464f-121">Jedem Worker wird ein bestimmter Auftragsbereich zugewiesen (beispielsweise getrennt nach Abrechnungsregion).</span><span class="sxs-lookup"><span data-stu-id="5464f-121">Each worker is assigned a certain range of orders (say, by billing region).</span></span> <span data-ttu-id="5464f-122">Wenn ein Worker abstürzt, nimmt eine neue Instanz die Verarbeitung an der Stelle auf, an der die vorherige Instanz aufgehört hat, aber es entstehen keine Konflikte durch mehrere Instanzen.</span><span class="sxs-lookup"><span data-stu-id="5464f-122">If a worker crashes, a new instance picks up where the previous instance left off, but multiple instances aren't contending.</span></span>

## <a name="recommendations"></a><span data-ttu-id="5464f-123">Empfehlungen</span><span class="sxs-lookup"><span data-stu-id="5464f-123">Recommendations</span></span>

<span data-ttu-id="5464f-124">**Implementieren Sie die letztliche Konsistenz**.</span><span class="sxs-lookup"><span data-stu-id="5464f-124">**Embrace eventual consistency**.</span></span> <span data-ttu-id="5464f-125">Wenn Daten verteilt sind, ist Koordination erforderlich, um Garantien für hohe Konsistenz zu erzwingen.</span><span class="sxs-lookup"><span data-stu-id="5464f-125">When data is distributed, it takes coordination to enforce strong consistency guarantees.</span></span> <span data-ttu-id="5464f-126">Ein Beispiel: Ein Vorgang aktualisiert zwei Datenbanken.</span><span class="sxs-lookup"><span data-stu-id="5464f-126">For example, suppose an operation updates two databases.</span></span> <span data-ttu-id="5464f-127">Anstatt den Vorgang in einem einzelnen Transaktionsbereich zu platzieren, ist es besser, wenn das System für letztliche Konsistenz sorgen kann – eventuell durch Verwendung des Musters [Ausgleichende Transaktion][compensating-transaction] –, um nach einem Fehler logisch ein Rollback ausführen zu können.</span><span class="sxs-lookup"><span data-stu-id="5464f-127">Instead of putting it into a single transaction scope, it's better if the system can accommodate eventual consistency, perhaps by using the [Compensating Transaction][compensating-transaction] pattern to logically roll back after a failure.</span></span>

<span data-ttu-id="5464f-128">**Verwenden Sie Domänenereignisse, um den Zustand zu synchronisieren**.</span><span class="sxs-lookup"><span data-stu-id="5464f-128">**Use domain events to synchronize state**.</span></span> <span data-ttu-id="5464f-129">Ein [Domänenereignis][domain-event] ist ein Ereignis, das für die Domäne relevante Vorkommnisse aufzeichnet.</span><span class="sxs-lookup"><span data-stu-id="5464f-129">A [domain event][domain-event] is an event that records when something happens that has significance within the domain.</span></span> <span data-ttu-id="5464f-130">Interessierte Dienste können auf das Ereignis lauschen, anstatt eine globale Transaktion zu verwenden, um für die Koordination zwischen mehreren Diensten zu sorgen.</span><span class="sxs-lookup"><span data-stu-id="5464f-130">Interested services can listen for the event, rather than using a global transaction to coordinate across multiple services.</span></span> <span data-ttu-id="5464f-131">Bei diesem Ansatz muss das System die letztliche Konsistenz tolerieren (siehe vorherigen Punkt).</span><span class="sxs-lookup"><span data-stu-id="5464f-131">If this approach is used, the system must tolerate eventual consistency (see previous item).</span></span>

<span data-ttu-id="5464f-132">**Berücksichtigen Sie Muster wie CQRS (Command Query Responsibility Segregation) und Event Sourcing**.</span><span class="sxs-lookup"><span data-stu-id="5464f-132">**Consider patterns such as CQRS and event sourcing**.</span></span> <span data-ttu-id="5464f-133">Diese beiden Muster können dazu beitragen, Konflikte zwischen Lese- und Schreibworkloads zu reduzieren.</span><span class="sxs-lookup"><span data-stu-id="5464f-133">These two patterns can help to reduce contention between read workloads and write workloads.</span></span>

- <span data-ttu-id="5464f-134">Das [CQRS-Muster][cqrs-pattern] trennt Lesevorgänge von Schreibvorgängen.</span><span class="sxs-lookup"><span data-stu-id="5464f-134">The [CQRS pattern][cqrs-pattern] separates read operations from write operations.</span></span> <span data-ttu-id="5464f-135">In einigen Implementierungen sind die Lesedaten physisch von den Schreibdaten getrennt.</span><span class="sxs-lookup"><span data-stu-id="5464f-135">In some implementations, the read data is physically separated from the write data.</span></span>

- <span data-ttu-id="5464f-136">Beim [Event Sourcing-Muster][event-sourcing] werden Zustandsänderungen als eine Reihe von Ereignissen in einem nur zum Anfügen vorgesehenen Datenspeicher aufgezeichnet.</span><span class="sxs-lookup"><span data-stu-id="5464f-136">In the [Event Sourcing pattern][event-sourcing], state changes are recorded as a series of events to an append-only data store.</span></span> <span data-ttu-id="5464f-137">Das Anfügen eines Ereignisses an den Datenstrom ist ein atomischer Vorgang, der nur eine minimale Sperre erfordert.</span><span class="sxs-lookup"><span data-stu-id="5464f-137">Appending an event to the stream is an atomic operation, requiring minimal locking.</span></span>

<span data-ttu-id="5464f-138">Diese beiden Muster ergänzen sich.</span><span class="sxs-lookup"><span data-stu-id="5464f-138">These two patterns complement each other.</span></span> <span data-ttu-id="5464f-139">Wenn der lesegeschützte Speicher im CQRS-Muster das Event Sourcing verwendet, kann der schreibgeschützte Speicher auf die gleichen Ereignisse lauschen, um eine lesbare, für Abfragen optimierte Momentaufnahme des aktuellen Zustands zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="5464f-139">If the write-only store in CQRS uses event sourcing, the read-only store can listen for the same events to create a readable snapshot of the current state, optimized for queries.</span></span> <span data-ttu-id="5464f-140">Bevor Sie CQRS oder Event Sourcing implementieren, sollten Sie sich jedoch über die Herausforderungen dieses Ansatzes im Klaren sein.</span><span class="sxs-lookup"><span data-stu-id="5464f-140">Before adopting CQRS or event sourcing, however, be aware of the challenges of this approach.</span></span> <span data-ttu-id="5464f-141">Weitere Informationen finden Sie unter [Architekturstil für CQRS][cqrs-style].</span><span class="sxs-lookup"><span data-stu-id="5464f-141">For more information, see [CQRS architecture style][cqrs-style].</span></span>

<span data-ttu-id="5464f-142">**Partitionieren Sie Daten**.</span><span class="sxs-lookup"><span data-stu-id="5464f-142">**Partition data**.</span></span>  <span data-ttu-id="5464f-143">Vermeiden Sie es, all Ihre Daten in ein Datenschema zu platzieren, das von vielen Anwendungsdiensten gemeinsam genutzt wird.</span><span class="sxs-lookup"><span data-stu-id="5464f-143">Avoid putting all of your data into one data schema that is shared across many application services.</span></span> <span data-ttu-id="5464f-144">Eine Microservicearchitektur unterstreicht dieses Prinzip, indem jeder Dienst für den eigenen Datenspeicher zuständig ist.</span><span class="sxs-lookup"><span data-stu-id="5464f-144">A microservices architecture enforces this principle by making each service responsible for its own data store.</span></span> <span data-ttu-id="5464f-145">Innerhalb einer Datenbank kann das Partitionieren von Daten in Shards die Parallelität verbessern, da ein Dienst, der Daten in einen Shard schreibt, sich nicht auf einen Dienst auswirkt, der Daten in einen anderen Shard schreibt.</span><span class="sxs-lookup"><span data-stu-id="5464f-145">Within a single database, partitioning the data into shards can improve concurrency, because a service writing to one shard does not affect a service writing to a different shard.</span></span>

<span data-ttu-id="5464f-146">**Entwerfen Sie idempotente Vorgänge**.</span><span class="sxs-lookup"><span data-stu-id="5464f-146">**Design idempotent operations**.</span></span> <span data-ttu-id="5464f-147">Entwerfen Sie Vorgänge nach Möglichkeit idempotent.</span><span class="sxs-lookup"><span data-stu-id="5464f-147">When possible, design operations to be idempotent.</span></span> <span data-ttu-id="5464f-148">Auf diese Weise können sie mit einer „Least-Once“-Semantik verarbeitet werden.</span><span class="sxs-lookup"><span data-stu-id="5464f-148">That way, they can be handled using at-least-once semantics.</span></span> <span data-ttu-id="5464f-149">Sie können z.B. Arbeitselemente in eine Warteschlange einreihen.</span><span class="sxs-lookup"><span data-stu-id="5464f-149">For example, you can put work items on a queue.</span></span> <span data-ttu-id="5464f-150">Wenn ein Worker während eines Vorgangs abstürzt, kann ein anderer Worker das Arbeitselement ganz einfach übernehmen.</span><span class="sxs-lookup"><span data-stu-id="5464f-150">If a worker crashes in the middle of an operation, another worker simply picks up the work item.</span></span>

<span data-ttu-id="5464f-151">**Verwenden Sie asynchrone parallele Verarbeitung**.</span><span class="sxs-lookup"><span data-stu-id="5464f-151">**Use asynchronous parallel processing**.</span></span> <span data-ttu-id="5464f-152">Wenn ein Vorgang mehrere Schritte erfordert, die asynchron ausgeführt werden (z.B. Remotedienstaufrufe), können Sie diese möglicherweise parallel aufrufen und die Ergebnisse aggregieren.</span><span class="sxs-lookup"><span data-stu-id="5464f-152">If an operation requires multiple steps that are performed asynchronously (such as remote service calls), you might be able to call them in parallel, and then aggregate the results.</span></span> <span data-ttu-id="5464f-153">Bei diesem Ansatz wird davon ausgegangen, dass kein Schritt von den Ergebnissen des vorherigen Schritts abhängig ist.</span><span class="sxs-lookup"><span data-stu-id="5464f-153">This approach assumes that each step does not depend on the results of the previous step.</span></span>

<span data-ttu-id="5464f-154">**Verwenden Sie nach Möglichkeit die optimistische Parallelität**.</span><span class="sxs-lookup"><span data-stu-id="5464f-154">**Use optimistic concurrency when possible**.</span></span> <span data-ttu-id="5464f-155">Bei der pessimistischen Parallelität werden Datenbanksperren verwendet, um Konflikte zu verhindern.</span><span class="sxs-lookup"><span data-stu-id="5464f-155">Pessimistic concurrency control uses database locks to prevent conflicts.</span></span> <span data-ttu-id="5464f-156">Dies kann zu eine unzureichenden Leistung führen und die Verfügbarkeit verringern.</span><span class="sxs-lookup"><span data-stu-id="5464f-156">This can cause poor performance and reduce availability.</span></span> <span data-ttu-id="5464f-157">Bei der optimistischen Parallelität ändert jede Transaktion eine Kopie oder Momentaufnahme der Daten.</span><span class="sxs-lookup"><span data-stu-id="5464f-157">With optimistic concurrency control, each transaction modifies a copy or snapshot of the data.</span></span> <span data-ttu-id="5464f-158">Wenn ein Commit für die Transaktion ausgeführt wird, überprüft die Datenbank-Engine die Transaktion und lehnt sie ab, wenn sie die Datenbankkonsistenz beeinträchtigen würde.</span><span class="sxs-lookup"><span data-stu-id="5464f-158">When the transaction is committed, the database engine validates the transaction and rejects any transactions that would affect database consistency.</span></span>

<span data-ttu-id="5464f-159">Azure SQL-Datenbank und SQL Server unterstützen die optimistische Parallelität durch [Momentaufnahmenisolation][sql-snapshot-isolation].</span><span class="sxs-lookup"><span data-stu-id="5464f-159">Azure SQL Database and SQL Server support optimistic concurrency through [snapshot isolation][sql-snapshot-isolation].</span></span> <span data-ttu-id="5464f-160">Einige Azure-Speicherdienste unterstützen die optimistische Parallelität durch die Verwendung von ETags, z.B. [Azure Cosmos DB][cosmosdb-faq] und [Azure Storage][storage-concurrency].</span><span class="sxs-lookup"><span data-stu-id="5464f-160">Some Azure storage services support optimistic concurrency through the use of Etags, including [Azure Cosmos DB][cosmosdb-faq] and [Azure Storage][storage-concurrency].</span></span>

<span data-ttu-id="5464f-161">**Ziehen Sie MapReduce oder andere parallele, verteilte Algorithmen in Betracht**.</span><span class="sxs-lookup"><span data-stu-id="5464f-161">**Consider MapReduce or other parallel, distributed algorithms**.</span></span> <span data-ttu-id="5464f-162">Je nach Daten und der Art der auszuführenden Aufgaben können Sie die Aufgaben möglicherweise in unabhängige Tasks aufteilen, die von mehreren Knoten parallel ausgeführt werden können.</span><span class="sxs-lookup"><span data-stu-id="5464f-162">Depending on the data and type of work to be performed, you may be able to split the work into independent tasks that can be performed by multiple nodes working in parallel.</span></span> <span data-ttu-id="5464f-163">Weitere Informationen dazu finden Sie unter [Big Compute-Architekturstil][big-compute].</span><span class="sxs-lookup"><span data-stu-id="5464f-163">See [Big compute architecture style][big-compute].</span></span>

<span data-ttu-id="5464f-164">**Verwenden Sie die Auswahl einer übergeordneten Instanz für die Koordination**.</span><span class="sxs-lookup"><span data-stu-id="5464f-164">**Use leader election for coordination**.</span></span> <span data-ttu-id="5464f-165">In Fällen, in denen Sie Vorgänge koordinieren müssen, stellen Sie sicher, dass die koordinierende Instanz nicht zu einem Single Point of Failure in der Anwendung wird.</span><span class="sxs-lookup"><span data-stu-id="5464f-165">In cases where you need to coordinate operations, make sure the coordinator does not become a single point of failure in the application.</span></span> <span data-ttu-id="5464f-166">Bei Verwendung des [Musters für die Auswahl einer übergeordneten Instanz][leader-election] ist eine Instanz zu jedem Zeitpunkt übergeordnet und agiert als Koordinator.</span><span class="sxs-lookup"><span data-stu-id="5464f-166">Using the [Leader Election pattern][leader-election], one instance is the leader at any time, and acts as the coordinator.</span></span> <span data-ttu-id="5464f-167">Wenn die übergeordnete Instanz ausfällt, wird eine neue Instanz als übergeordnete Instanz ausgewählt.</span><span class="sxs-lookup"><span data-stu-id="5464f-167">If the leader fails, a new instance is elected to be the leader.</span></span>

<!-- links -->

[big-compute]: ../architecture-styles/big-compute.md
[compensating-transaction]: ../../patterns/compensating-transaction.md
[cqrs-style]: ../architecture-styles/cqrs.md
[cqrs-pattern]: ../../patterns/cqrs.md
[cosmosdb-faq]: /azure/cosmos-db/faq
[domain-event]: https://martinfowler.com/eaaDev/DomainEvent.html
[event-sourcing]: ../../patterns/event-sourcing.md
[leader-election]: ../../patterns/leader-election.md
[sas-pattern]: ../../patterns/scheduler-agent-supervisor.md
[sql-snapshot-isolation]: /sql/t-sql/statements/set-transaction-isolation-level-transact-sql
[storage-concurrency]: https://azure.microsoft.com/blog/managing-concurrency-in-microsoft-azure-storage-2/