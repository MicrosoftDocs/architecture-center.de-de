---
title: Kommunikation zwischen Diensten in Microservices
description: Kommunikation zwischen Diensten in Microservices
author: MikeWasson
ms.date: 12/08/2017
ms.openlocfilehash: aff2fb7b2be25ca32d6224cee15363880cfb1488
ms.sourcegitcommit: a8453c4bc7c870fa1a12bb3c02e3b310db87530c
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 12/29/2017
---
# <a name="designing-microservices-interservice-communication"></a><span data-ttu-id="89a35-103">Entwerfen von Microservices: Kommunikation zwischen Diensten</span><span class="sxs-lookup"><span data-stu-id="89a35-103">Designing microservices: Interservice communication</span></span>

<span data-ttu-id="89a35-104">Die Kommunikation zwischen Microservices muss effizient und stabil sein.</span><span class="sxs-lookup"><span data-stu-id="89a35-104">Communication between microservices must be efficient and robust.</span></span> <span data-ttu-id="89a35-105">Wenn zahlreiche kompakte Dienste miteinander interagieren, um eine einzelne Transaktion abzuwickeln, kann sich das als Herausforderung erweisen.</span><span class="sxs-lookup"><span data-stu-id="89a35-105">With lots of small services interacting to complete a single transaction, this can be a challenge.</span></span> <span data-ttu-id="89a35-106">In diesem Kapitel gehen wir auf die Unterschiede zwischen asynchronem Messaging und synchronen APIs ein.</span><span class="sxs-lookup"><span data-stu-id="89a35-106">In this chapter, we look at the tradeoffs between asynchronous messaging versus synchronous APIs.</span></span> <span data-ttu-id="89a35-107">Anschließend beschäftigen wir uns mit einigen Herausforderungen beim Entwerfen einer robusten Kommunikation zwischen Diensten, und Sie erfahren, welche Rolle ein Dienstnetz dabei spielen kann.</span><span class="sxs-lookup"><span data-stu-id="89a35-107">Then we look at some of the challenges in designing resilient interservice communication, and the role that a service mesh can play.</span></span>

![](./images/interservice-communication.png)

## <a name="challenges"></a><span data-ttu-id="89a35-108">Herausforderungen</span><span class="sxs-lookup"><span data-stu-id="89a35-108">Challenges</span></span> 

<span data-ttu-id="89a35-109">Im Anschluss finden Sie einige der größten Herausforderungen im Zusammenhang mit der Kommunikation zwischen Diensten.</span><span class="sxs-lookup"><span data-stu-id="89a35-109">Here are some of the main challenges arising from service-to-service communication.</span></span> <span data-ttu-id="89a35-110">Viele dieser Herausforderungen lassen sich mit den weiter unten beschriebenen Dienstnetzen in den Griff bekommen.</span><span class="sxs-lookup"><span data-stu-id="89a35-110">Service meshes, described later in this chapter, are designed to handle many of these challenges.</span></span>

<span data-ttu-id="89a35-111">**Resilienz:**</span><span class="sxs-lookup"><span data-stu-id="89a35-111">**Resiliency.**</span></span> <span data-ttu-id="89a35-112">Von einem Microservice können Dutzende oder sogar Hunderte von Instanzen vorhanden sein.</span><span class="sxs-lookup"><span data-stu-id="89a35-112">There may be dozens or even hundreds of instances of any given microservice.</span></span> <span data-ttu-id="89a35-113">Eine Instanz kann aus verschiedensten Gründen ausfallen.</span><span class="sxs-lookup"><span data-stu-id="89a35-113">An instance can fail for any number of reasons.</span></span> <span data-ttu-id="89a35-114">Ein Ausfall kann auf der Knotenebene auftreten – beispielsweise aufgrund eines Hardwarefehlers oder durch den Neustart eines virtuellen Computers.</span><span class="sxs-lookup"><span data-stu-id="89a35-114">There can be a node-level failure, such as a hardware failure or a VM reboot.</span></span> <span data-ttu-id="89a35-115">Es kann vorkommen, dass eine Instanz abstürzt oder die Menge an eingehenden Anforderungen nicht mehr bewältigen und somit keine neuen Anforderungen verarbeiten kann.</span><span class="sxs-lookup"><span data-stu-id="89a35-115">An instance might crash, or be overwhelmed with requests and unable to process any new requests.</span></span> <span data-ttu-id="89a35-116">Jedes dieser Ereignisse kann dazu führen, dass ein Netzwerkaufruf nicht erfolgreich ist.</span><span class="sxs-lookup"><span data-stu-id="89a35-116">Any of these events can cause a network call to fail.</span></span> <span data-ttu-id="89a35-117">Es gibt zwei Entwurfsmuster, mit denen sich die Resilienz von Netzwerkaufrufen zwischen Diensten verbessern lässt:</span><span class="sxs-lookup"><span data-stu-id="89a35-117">There are two design patterns that can help make service-to-service network calls more resilient:</span></span>

- <span data-ttu-id="89a35-118">**[Wiederholung:](../patterns/retry.md)**</span><span class="sxs-lookup"><span data-stu-id="89a35-118">**[Retry](../patterns/retry.md)**.</span></span> <span data-ttu-id="89a35-119">Das Scheitern eines Netzwerkaufrufs kann eine vorübergehende Ursache haben, die sich von selbst erledigt.</span><span class="sxs-lookup"><span data-stu-id="89a35-119">A network call may fail because of a transient fault that goes away by itself.</span></span> <span data-ttu-id="89a35-120">Der Aufrufer sollte den Vorgang daher mehrmals oder bis zum Erreichen eines Timeouts wiederholen, damit nicht sofort ein Fehler auftritt.</span><span class="sxs-lookup"><span data-stu-id="89a35-120">Rather than fail outright, the caller should typically retry the operation a certain number of times, or until a configured time-out period elapses.</span></span> <span data-ttu-id="89a35-121">Bei nicht idempotenten Vorgängen können Wiederholungen allerdings unerwünschte Nebenwirkungen haben.</span><span class="sxs-lookup"><span data-stu-id="89a35-121">However, if an operation is not idempotent, retries can cause unintended side effects.</span></span> <span data-ttu-id="89a35-122">Es kann vorkommen, dass der ursprüngliche Aufruf erfolgreich ist, der Aufrufer aber keine Antwort erhält.</span><span class="sxs-lookup"><span data-stu-id="89a35-122">The original call might succeed, but the caller never gets a response.</span></span> <span data-ttu-id="89a35-123">Bei einer Wiederholung wird der Vorgang dann unter Umständen zweimal aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="89a35-123">If the caller retries, the operation may be invoked twice.</span></span> <span data-ttu-id="89a35-124">Grundsätzlich ist die Wiederholung von POST- oder PATCH-Methoden unsicher, da sie nicht unbedingt idempotent sind.</span><span class="sxs-lookup"><span data-stu-id="89a35-124">Generally, it's not safe to retry POST or PATCH methods, because these are not guaranteed to be idempotent.</span></span>

- <span data-ttu-id="89a35-125">**[Trennschalter:](../patterns/circuit-breaker.md)**</span><span class="sxs-lookup"><span data-stu-id="89a35-125">**[Circuit Breaker](../patterns/circuit-breaker.md)**.</span></span> <span data-ttu-id="89a35-126">Zu viele erfolglose Anforderungen können zu einem Engpass führen, wenn sich ausstehende Anforderungen in der Warteschlange ansammeln.</span><span class="sxs-lookup"><span data-stu-id="89a35-126">Too many failed requests can cause a bottleneck, as pending requests accumulate in the queue.</span></span> <span data-ttu-id="89a35-127">Diese blockierten Anforderungen können kritische Systemressourcen belegen, z.B. Arbeitsspeicher, Threads, Datenbankverbindungen usw., sodass es zu kaskadierenden Fehlern kommen kann.</span><span class="sxs-lookup"><span data-stu-id="89a35-127">These blocked requests might hold critical system resources such as memory, threads, database connections, and so on, which can cause cascading failures.</span></span> <span data-ttu-id="89a35-128">Mit einem Muster vom Typ „Trennschalter“ kann verhindert werden, dass ein Dienst wiederholt versucht, einen Vorgang mit geringen Erfolgsaussichten auszuführen.</span><span class="sxs-lookup"><span data-stu-id="89a35-128">The Circuit Breaker pattern can prevent a service from repeatedly trying an operation that is likely to fail.</span></span> 

<span data-ttu-id="89a35-129">**Lastenausgleich:**</span><span class="sxs-lookup"><span data-stu-id="89a35-129">**Load balancing**.</span></span> <span data-ttu-id="89a35-130">Wenn Dienst „A“ Dienst „B“ aufruft, muss die Anforderung eine aktive Instanz von Dienst „B“ erreichen.</span><span class="sxs-lookup"><span data-stu-id="89a35-130">When service "A" calls service "B", the request must reach a running instance of service "B".</span></span> <span data-ttu-id="89a35-131">In Kubernetes stellt der Ressourcentyp `Service` eine stabile IP-Adresse für eine Gruppe von Pods bereit.</span><span class="sxs-lookup"><span data-stu-id="89a35-131">In Kubernetes, the `Service` resource type provides a stable IP address for a group of pods.</span></span> <span data-ttu-id="89a35-132">An die IP-Adresse des Diensts gesendeter Netzwerkdatenverkehr wird über iptable-Regeln an einen Pod weitergeleitet.</span><span class="sxs-lookup"><span data-stu-id="89a35-132">Network traffic to the service's IP address gets forwarded to a pod by means of iptable rules.</span></span> <span data-ttu-id="89a35-133">Standardmäßig wird ein Pod nach dem Zufallsprinzip ausgewählt.</span><span class="sxs-lookup"><span data-stu-id="89a35-133">By default, a random pod is chosen.</span></span> <span data-ttu-id="89a35-134">Ein Dienstnetz (siehe weiter unten) bietet intelligentere Lastenausgleichsalgorithmen, die auf der ermittelten Wartezeit oder auf anderen Metriken basieren.</span><span class="sxs-lookup"><span data-stu-id="89a35-134">A service mesh (see below) can provide more intelligent load balancing algorithms based on observed latency or other metrics.</span></span>

<span data-ttu-id="89a35-135">**Verteilte Ablaufverfolgung:**</span><span class="sxs-lookup"><span data-stu-id="89a35-135">**Distributed tracing**.</span></span> <span data-ttu-id="89a35-136">Eine einzelne Transaktion kann mehrere Dienste umfassen.</span><span class="sxs-lookup"><span data-stu-id="89a35-136">A single transaction may span multiple services.</span></span> <span data-ttu-id="89a35-137">Dies kann die Überwachung der Gesamtleistung und der Integrität des Systems erschweren.</span><span class="sxs-lookup"><span data-stu-id="89a35-137">That can make it hard to monitor the overall performance and health of the system.</span></span> <span data-ttu-id="89a35-138">Selbst wenn jeder Dienst Protokolle und Metriken generiert, müssen diese irgendwie miteinander verknüpft werden, da sie sonst nur begrenzt hilfreich sind.</span><span class="sxs-lookup"><span data-stu-id="89a35-138">Even if every service generates logs and metrics, without some way to tie them together, they are of limited use.</span></span> <span data-ttu-id="89a35-139">Im Kapitel [Protokollierung und Überwachung](./logging-monitoring.md) finden Sie weitere Informationen zur verteilten Ablaufverfolgung, die hier der Vollständigkeit halber als Herausforderung erwähnt wird.</span><span class="sxs-lookup"><span data-stu-id="89a35-139">The chapter [Logging and monitoring](./logging-monitoring.md) talks more about distributed tracing, but we mention it here as a challenge.</span></span>

<span data-ttu-id="89a35-140">**Dienstversionsverwaltung:**</span><span class="sxs-lookup"><span data-stu-id="89a35-140">**Service versioning**.</span></span> <span data-ttu-id="89a35-141">Wenn ein Team eine neue Version eines Diensts bereitstellt, muss es darauf achten, dass dadurch keine anderen Dienste oder externen Clients beeinträchtigt werden, die von diesem Dienst abhängig sind.</span><span class="sxs-lookup"><span data-stu-id="89a35-141">When a team deploys a new version of a service, they must avoid breaking any other services or external clients that depend on it.</span></span> <span data-ttu-id="89a35-142">Darüber hinaus empfiehlt es sich unter Umständen, mehrere Versionen eines Diensts parallel auszuführen und Anforderungen an eine bestimmte Version weiterzuleiten.</span><span class="sxs-lookup"><span data-stu-id="89a35-142">In addition, you might want to run multiple versions of a service side-by-side, and route requests to a particular version.</span></span> <span data-ttu-id="89a35-143">Weitere Informationen zu diesem Thema finden Sie unter [API-Versionsverwaltung](./api-design.md#api-versioning).</span><span class="sxs-lookup"><span data-stu-id="89a35-143">See [API Versioning](./api-design.md#api-versioning) for more discussion of this issue.</span></span>

<span data-ttu-id="89a35-144">**TLS-Verschlüsselung und gegenseitige TLS-Authentifizierung:**</span><span class="sxs-lookup"><span data-stu-id="89a35-144">**TLS encryption and mutual TLS authentication**.</span></span> <span data-ttu-id="89a35-145">Aus Sicherheitsgründen kann es sinnvoll sein, Datenverkehr zwischen Diensten mit TLS zu verschlüsseln und Aufrufer mittels gegenseitiger TLS-Authentifizierung zu authentifizieren.</span><span class="sxs-lookup"><span data-stu-id="89a35-145">For security reasons, you may want to encrypt traffic between services with TLS, and use mutual TLS authentication to authenticate callers.</span></span>

## <a name="synchronous-versus-asynchronous-messaging"></a><span data-ttu-id="89a35-146">Gegenüberstellung von synchronem und asynchronem Messaging</span><span class="sxs-lookup"><span data-stu-id="89a35-146">Synchronous versus asynchronous messaging</span></span>

<span data-ttu-id="89a35-147">Für die Kommunikation mit anderen Microservices stehen zwei grundlegende Messagingmuster zur Verfügung.</span><span class="sxs-lookup"><span data-stu-id="89a35-147">There are two basic messaging patterns that microservices can use to communicate with other microservices.</span></span> 

1. <span data-ttu-id="89a35-148">Synchrone Kommunikation:</span><span class="sxs-lookup"><span data-stu-id="89a35-148">Synchronous communication.</span></span> <span data-ttu-id="89a35-149">Bei diesem Muster ruft ein Dienst unter Verwendung eines Protokolls wie HTTP oder gRPC eine von einem anderen Dienst verfügbar gemachte API auf.</span><span class="sxs-lookup"><span data-stu-id="89a35-149">In this pattern, a service calls an API that another service exposes, using a protocol such as HTTP or gRPC.</span></span> <span data-ttu-id="89a35-150">Diese Option ist ein synchrones Messagingmuster, da der Aufrufer auf eine Antwort des Empfängers wartet.</span><span class="sxs-lookup"><span data-stu-id="89a35-150">This option is a synchronous messaging pattern because the caller waits for a response from the receiver.</span></span> 

2. <span data-ttu-id="89a35-151">Asynchrone Nachrichtenübergabe:</span><span class="sxs-lookup"><span data-stu-id="89a35-151">Asynchronous message passing.</span></span> <span data-ttu-id="89a35-152">Bei diesem Muster sendet ein Dienst eine Nachricht, ohne auf eine Antwort zu warten, und die Nachricht wird asynchron von einem oder mehreren Diensten verarbeitet.</span><span class="sxs-lookup"><span data-stu-id="89a35-152">In this pattern, a service sends message without waiting for a response, and one or more services process the message asynchronously.</span></span>

<span data-ttu-id="89a35-153">Es ist wichtig, zwischen asynchronen E/A-Vorgängen und einem asynchronen Protokoll zu unterscheiden.</span><span class="sxs-lookup"><span data-stu-id="89a35-153">It's important to distinguish between asynchronous I/O and an asynchronous protocol.</span></span> <span data-ttu-id="89a35-154">Bei einem asynchronen E/A-Vorgang wird der aufrufende Thread während der Durchführung des E/A-Vorgangs nicht blockiert.</span><span class="sxs-lookup"><span data-stu-id="89a35-154">Asynchronous I/O means the calling thread is not blocked while the I/O completes.</span></span> <span data-ttu-id="89a35-155">Dies ist ein zwar wichtiger Leistungsaspekt, im Hinblick auf die Architektur aber ein Implementierungsdetail.</span><span class="sxs-lookup"><span data-stu-id="89a35-155">That's important for performance, but is an implementation detail in terms of the architecture.</span></span> <span data-ttu-id="89a35-156">Bei einem asynchronen Protokoll wartet der Absender nicht auf eine Antwort.</span><span class="sxs-lookup"><span data-stu-id="89a35-156">An asynchronous protocol means the sender doesn't wait for a response.</span></span> <span data-ttu-id="89a35-157">HTTP ist ein synchrones Protokoll, beim Senden einer Anforderung kann ein HTTP-Client aber einen asynchronen E/A-Vorgang verwenden.</span><span class="sxs-lookup"><span data-stu-id="89a35-157">HTTP is a synchronous protocol, even though an HTTP client may use asynchronous I/O when it sends a request.</span></span> 

<span data-ttu-id="89a35-158">Jedes Muster hat seine Vor- und Nachteile.</span><span class="sxs-lookup"><span data-stu-id="89a35-158">There are tradeoffs to each pattern.</span></span> <span data-ttu-id="89a35-159">Anforderung/Antwort ist ein leicht nachvollziehbares Muster, sodass das Entwerfen einer API möglicherweise natürlicher wirkt als das Entwerfen eines Messagingsystems.</span><span class="sxs-lookup"><span data-stu-id="89a35-159">Request/response is a well-understood paradigm, so designing an API may feel more natural than designing a messaging system.</span></span> <span data-ttu-id="89a35-160">Asynchrones Messaging hat jedoch einige Vorteile, die insbesondere in einer Microservices-Architektur hilfreich sein können:</span><span class="sxs-lookup"><span data-stu-id="89a35-160">However, asynchronous messaging has some advantages that can be very useful in a microservices architecture:</span></span>

- <span data-ttu-id="89a35-161">**Geringere Kopplung:**</span><span class="sxs-lookup"><span data-stu-id="89a35-161">**Reduced coupling**.</span></span> <span data-ttu-id="89a35-162">Der Absender der Nachricht benötigt keine Informationen zum Consumer.</span><span class="sxs-lookup"><span data-stu-id="89a35-162">The message sender does not need to know about the consumer.</span></span> 

- <span data-ttu-id="89a35-163">**Mehrere Abonnenten:**</span><span class="sxs-lookup"><span data-stu-id="89a35-163">**Multiple subscribers**.</span></span> <span data-ttu-id="89a35-164">Bei Verwendung eines Pub/Sub-Modells können mehrere Consumer Ereignisse über ein Abonnement empfangen.</span><span class="sxs-lookup"><span data-stu-id="89a35-164">Using a pub/sub model, multiple consumers can subscribe to receive events.</span></span> <span data-ttu-id="89a35-165">Weitere Informationen finden Sie unter [Ereignisgesteuerter Architekturstil](/azure/architecture/guide/architecture-styles/event-driven).</span><span class="sxs-lookup"><span data-stu-id="89a35-165">See [Event-driven architecture style](/azure/architecture/guide/architecture-styles/event-driven).</span></span>

- <span data-ttu-id="89a35-166">**Fehlerisolation:**</span><span class="sxs-lookup"><span data-stu-id="89a35-166">**Failure isolation**.</span></span> <span data-ttu-id="89a35-167">Wenn ein Consumer ausfällt, kann der Absender weiterhin Nachrichten senden.</span><span class="sxs-lookup"><span data-stu-id="89a35-167">If the consumer fails, the sender can still send messages.</span></span> <span data-ttu-id="89a35-168">Die Nachrichten werden abgeholt, wenn der Consumer wieder verfügbar ist.</span><span class="sxs-lookup"><span data-stu-id="89a35-168">The messages will be picked up when the consumer recovers.</span></span> <span data-ttu-id="89a35-169">Dies ist besonders in einer Microservices-Architektur von Vorteil, da jeder Dienst einen eigenen Lebenszyklus hat.</span><span class="sxs-lookup"><span data-stu-id="89a35-169">This ability is especially useful in a microservices architecture, because each service has its own lifecycle.</span></span> <span data-ttu-id="89a35-170">Ein Dienst kann jederzeit nicht mehr verfügbar sein oder durch eine neuere Version ersetzt werden.</span><span class="sxs-lookup"><span data-stu-id="89a35-170">A service could become unavailable or be replaced with a newer version at any given time.</span></span> <span data-ttu-id="89a35-171">Bei asynchronem Messaging sind vorübergehende Ausfälle kein Problem.</span><span class="sxs-lookup"><span data-stu-id="89a35-171">Asynchronous messaging can handle intermittent downtime.</span></span> <span data-ttu-id="89a35-172">Bei synchronen APIs muss der Downstreamdienst hingegen verfügbar sein, da der Vorgang ansonsten nicht erfolgreich ist.</span><span class="sxs-lookup"><span data-stu-id="89a35-172">Synchronous APIs, on the other hand, require the downstream service to be available or the operation fails.</span></span> 
 
- <span data-ttu-id="89a35-173">**Reaktionsfähigkeit:**</span><span class="sxs-lookup"><span data-stu-id="89a35-173">**Responsiveness**.</span></span> <span data-ttu-id="89a35-174">Ein Upstreamdienst kann schneller antworten, wenn er nicht auf Downstreamdienste wartet.</span><span class="sxs-lookup"><span data-stu-id="89a35-174">An upstream service can reply faster if it does not wait on downstream services.</span></span> <span data-ttu-id="89a35-175">Dies ist besonders in einer Microservices-Architektur nützlich.</span><span class="sxs-lookup"><span data-stu-id="89a35-175">This is especially useful in a microservices architecture.</span></span> <span data-ttu-id="89a35-176">Bei einer Kette von Dienstabhängigkeiten (Dienst A ruft Dienst B auf, der wiederum Dienst C aufruft, usw.) kann das Warten auf synchrone Aufrufe zu inakzeptablen Wartezeiten führen.</span><span class="sxs-lookup"><span data-stu-id="89a35-176">If there is a chain of service dependencies (service A calls B, which calls C, and so on), waiting on synchronous calls can add unacceptable amounts of latency.</span></span>

- <span data-ttu-id="89a35-177">**Belastungsausgleich:**</span><span class="sxs-lookup"><span data-stu-id="89a35-177">**Load leveling**.</span></span> <span data-ttu-id="89a35-178">Eine Warteschlange kann als Puffer für den Belastungsausgleich fungieren, sodass Empfänger Nachrichten jeweils mit ihrer eigenen Geschwindigkeit verarbeiten können.</span><span class="sxs-lookup"><span data-stu-id="89a35-178">A queue can act as a buffer to level the workload, so that receivers can process messages at their own rate.</span></span> 

- <span data-ttu-id="89a35-179">**Workflows:**</span><span class="sxs-lookup"><span data-stu-id="89a35-179">**Workflows**.</span></span> <span data-ttu-id="89a35-180">Ein Workflow kann mithilfe von Warteschlangen verwaltet werden, indem Sie die Nachricht nach jedem Workflowschritt mithilfe eines Prüfpunkts überprüfen.</span><span class="sxs-lookup"><span data-stu-id="89a35-180">Queues can be used to manage a workflow, by check-pointing the message after each step in the workflow.</span></span>

<span data-ttu-id="89a35-181">Die effektive Verwendung von asynchronem Messaging ist jedoch auch mit gewissen Herausforderungen verbunden.</span><span class="sxs-lookup"><span data-stu-id="89a35-181">However, there are also some challenges to using asynchronous messaging effectively.</span></span>

- <span data-ttu-id="89a35-182">**Kopplung an die Messaginginfrastruktur:**</span><span class="sxs-lookup"><span data-stu-id="89a35-182">**Coupling with the messaging infrastructure**.</span></span> <span data-ttu-id="89a35-183">Die Verwendung einer bestimmten Messaginginfrastruktur kann eine enge Kopplung an diese Infrastruktur zur Folge haben.</span><span class="sxs-lookup"><span data-stu-id="89a35-183">Using a particular messaging infrastructure may cause tight coupling with that infrastructure.</span></span> <span data-ttu-id="89a35-184">Dies erschwert ggf. den späteren Umstieg auf eine andere Messaginginfrastruktur.</span><span class="sxs-lookup"><span data-stu-id="89a35-184">It will be difficult to switch to another messaging infrastructure later.</span></span>

- <span data-ttu-id="89a35-185">**Wartezeit:**</span><span class="sxs-lookup"><span data-stu-id="89a35-185">**Latency**.</span></span> <span data-ttu-id="89a35-186">Bei einem Vorgang kann es zu einer hohen End-to-End-Wartezeit kommen, wenn sich Nachrichten in den entsprechenden Warteschlangen ansammeln.</span><span class="sxs-lookup"><span data-stu-id="89a35-186">End-to-end latency for an operation may become high if the message queues fill up.</span></span>  

- <span data-ttu-id="89a35-187">**Kosten:**</span><span class="sxs-lookup"><span data-stu-id="89a35-187">**Cost**.</span></span> <span data-ttu-id="89a35-188">Bei hohem Durchsatz können durch die Messaginginfrastruktur erhebliche Kosten entstehen.</span><span class="sxs-lookup"><span data-stu-id="89a35-188">At high throughputs, the monetary cost of the messaging infrastructure could be significant.</span></span>

- <span data-ttu-id="89a35-189">**Komplexität:**</span><span class="sxs-lookup"><span data-stu-id="89a35-189">**Complexity**.</span></span> <span data-ttu-id="89a35-190">Der Umgang mit asynchronem Messaging ist keine leichte Aufgabe.</span><span class="sxs-lookup"><span data-stu-id="89a35-190">Handling asynchronous messaging is not a trivial task.</span></span> <span data-ttu-id="89a35-191">So müssen Sie beispielsweise duplizierte Nachrichten behandeln – entweder mittels Deduplizierung oder durch Verwendung idempotenter Vorgänge.</span><span class="sxs-lookup"><span data-stu-id="89a35-191">For example, you must handle duplicated messages, either by de-duplicating or by making operations idempotent.</span></span> <span data-ttu-id="89a35-192">Auch ist es mit asynchronem Messaging nicht ganz einfach, eine Anforderung/Antwort-Semantik zu implementieren.</span><span class="sxs-lookup"><span data-stu-id="89a35-192">It's also hard to implement request-response semantics using asynchronous messaging.</span></span> <span data-ttu-id="89a35-193">Sie benötigen eine weitere Warteschlange zum Senden einer Antwort sowie eine Möglichkeit zum Korrelieren von Anforderungs- und Antwortnachrichten.</span><span class="sxs-lookup"><span data-stu-id="89a35-193">To send a response, you need another queue, plus a way to correlate request and response messages.</span></span>

- <span data-ttu-id="89a35-194">**Durchsatz:**</span><span class="sxs-lookup"><span data-stu-id="89a35-194">**Throughput**.</span></span> <span data-ttu-id="89a35-195">Wenn Nachrichten eine *Warteschlangensemantik* erfordern, kann sich die Warteschlange zu einem Engpass im System entwickeln.</span><span class="sxs-lookup"><span data-stu-id="89a35-195">If messages require *queue semantics*, the queue can become a bottleneck in the system.</span></span> <span data-ttu-id="89a35-196">Für jede Nachricht ist mindestens ein Vorgang zum Hinzufügen in die Warteschlange und ein Vorgang zum Entfernen aus der Warteschlange erforderlich.</span><span class="sxs-lookup"><span data-stu-id="89a35-196">Each message requires at least one queue operation and one dequeue operation.</span></span> <span data-ttu-id="89a35-197">Darüber hinaus wird für eine Warteschlangensemantik in der Regel eine Art von Sperre in der Messaginginfrastruktur benötigt.</span><span class="sxs-lookup"><span data-stu-id="89a35-197">Moreover, queue semantics generally require some kind of locking inside the messaging infrastructure.</span></span> <span data-ttu-id="89a35-198">Wenn es sich bei der Warteschlange um einen verwalteten Dienst handelt, ist unter Umständen mit einer höheren Wartezeit zu rechnen, da sich die Warteschlange außerhalb des virtuellen Netzwerks des Clusters befindet.</span><span class="sxs-lookup"><span data-stu-id="89a35-198">If the queue is a managed service, there may be additional latency, because the queue is external to the cluster's virtual network.</span></span> <span data-ttu-id="89a35-199">Als Gegenmaßnahme für diese Probleme können Sie Nachrichten zu Batches zusammenfassen. Dies macht den Code jedoch komplizierter.</span><span class="sxs-lookup"><span data-stu-id="89a35-199">You can mitigate these issues by batching messages, but that complicates the code.</span></span> <span data-ttu-id="89a35-200">Wenn die Nachrichten keine Warteschlangensemantik erfordern, können Sie anstelle einer Warteschlange ggf. einen *Stream* für Ereignisse verwenden.</span><span class="sxs-lookup"><span data-stu-id="89a35-200">If the messages don't require queue semantics, you might be able to use an event *stream* instead of a queue.</span></span> <span data-ttu-id="89a35-201">Weitere Informationen finden Sie unter [Ereignisgesteuerter Architekturstil](../guide/architecture-styles/event-driven.md).</span><span class="sxs-lookup"><span data-stu-id="89a35-201">For more information, see [Event-driven architectural style](../guide/architecture-styles/event-driven.md).</span></span>  

## <a name="drone-delivery-choosing-the-messaging-patterns"></a><span data-ttu-id="89a35-202">Drohnenlieferung: Auswählen des Messagingmusters</span><span class="sxs-lookup"><span data-stu-id="89a35-202">Drone Delivery: Choosing the messaging patterns</span></span>

<span data-ttu-id="89a35-203">Auf der Grundlage dieser Überlegungen hat das Entwicklungsteam folgende Designentscheidungen für die Drohnenlieferungsangwendung getroffen:</span><span class="sxs-lookup"><span data-stu-id="89a35-203">With these considerations in mind, the development team made the following design choices for the Drone Delivery application</span></span>

- <span data-ttu-id="89a35-204">Der Dienst „Ingestion“ (Erfassung) macht eine öffentliche REST-API verfügbar, die von Clientanwendungen zum Planen, Aktualisieren oder Stornieren von Lieferungen verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="89a35-204">The Ingestion service exposes a public REST API that client applications use to schedule, update, or cancel deliveries.</span></span>

- <span data-ttu-id="89a35-205">Der Erfassungsdienst verwendet Event Hubs, um asynchrone Nachrichten an den Dienst „Scheduler“ (Planung) zu senden.</span><span class="sxs-lookup"><span data-stu-id="89a35-205">The Ingestion service uses Event Hubs to send asynchronous messages to the Scheduler service.</span></span> <span data-ttu-id="89a35-206">Asynchrone Nachrichten sind erforderlich, um den für die Erfassung benötigten Belastungsausgleich zu implementieren.</span><span class="sxs-lookup"><span data-stu-id="89a35-206">Asynchronous messages are necessary to implement the load-leveling that is required for ingestion.</span></span> <span data-ttu-id="89a35-207">Ausführliche Informationen zur Interaktion der Dienste „Ingestion“ und „Scheduler“ finden Sie unter [Erfassung und Workflow][ingestion-workflow].</span><span class="sxs-lookup"><span data-stu-id="89a35-207">For details on how the Ingestion and Scheduler services interact, see [Ingestion and workflow][ingestion-workflow].</span></span>

- <span data-ttu-id="89a35-208">Die Dienste „Account“ (Konto), „Delivery“ (Lieferung), „Package“ (Paket), „Drone“ (Drohne) und „3rd Party Transport“ (Drittanbietertransport) machen jeweils interne REST-APIs verfügbar.</span><span class="sxs-lookup"><span data-stu-id="89a35-208">The Account, Delivery, Package, Drone, and Third-party Transport services all expose internal REST APIs.</span></span> <span data-ttu-id="89a35-209">Der Dienst „Scheduler“ ruft diese APIs auf, um eine Benutzeranforderung auszuführen.</span><span class="sxs-lookup"><span data-stu-id="89a35-209">The Scheduler service calls these APIs to carry out a user request.</span></span> <span data-ttu-id="89a35-210">Für die Verwendung synchroner APIs spricht unter anderem, dass der Dienst „Scheduler“ auf eine Antwort der einzelnen Downstreamdienste angewiesen ist.</span><span class="sxs-lookup"><span data-stu-id="89a35-210">One reason to use synchronous APIs is that the Scheduler needs to get a response from each of the downstream services.</span></span> <span data-ttu-id="89a35-211">Bei einem Fehler in einem der Downstreamdienste ist der gesamte Vorgang nicht erfolgreich.</span><span class="sxs-lookup"><span data-stu-id="89a35-211">A failure in any of the downstream services means the entire operation failed.</span></span> <span data-ttu-id="89a35-212">Das Aufrufen der Back-End-Dienste führt jedoch möglicherweise zu problematischen Wartezeiten.</span><span class="sxs-lookup"><span data-stu-id="89a35-212">However, a potential issue is the amount of latency that is introduced by calling the backend services.</span></span> 

- <span data-ttu-id="89a35-213">Sollte für einen Downstreamdienst ein dauerhafter Fehler vorliegen, muss die gesamte Transaktion als nicht erfolgreich gekennzeichnet werden.</span><span class="sxs-lookup"><span data-stu-id="89a35-213">If any downstream service has a non-transient failure, the entire transaction should be marked as failed.</span></span> <span data-ttu-id="89a35-214">In diesem Fall sendet der Dienst „Scheduler“ eine asynchrone Nachricht an den Supervisor, damit dieser kompensierende Transaktionen planen kann, wie im Kapitel [Erfassung und Workflow][ingestion-workflow] beschrieben.</span><span class="sxs-lookup"><span data-stu-id="89a35-214">To handle this case, the Scheduler service sends an asynchronous message to the Supervisor, so that the Supervisor can schedule compensating transactions, as described in the chapter [Ingestion and workflow][ingestion-workflow].</span></span>   

- <span data-ttu-id="89a35-215">Der Dienst „Delivery“ macht eine öffentliche API verfügbar, über die Clients den Status einer Lieferung abrufen können.</span><span class="sxs-lookup"><span data-stu-id="89a35-215">The Delivery service exposes a public API that clients can use to get the status of a delivery.</span></span> <span data-ttu-id="89a35-216">Im Kapitel [API-Gateway](./gateway.md) erfahren Sie, wie ein API-Gateway die zugrunde liegenden Dienste vor dem Client verbergen kann, damit der Client nicht wissen muss, von welchen Diensten welche APIs verfügbar gemacht werden.</span><span class="sxs-lookup"><span data-stu-id="89a35-216">In the chapter [API gateway](./gateway.md), we discuss how an API gateway can hide the underlying services from the client, so the client doesn't need to know which services expose which APIs.</span></span> 

- <span data-ttu-id="89a35-217">Wenn eine Drohne unterwegs ist, sendet der Dienst „Drone“ Ereignisse mit der aktuellen Position und dem Status der Drohne.</span><span class="sxs-lookup"><span data-stu-id="89a35-217">While a drone is in flight, the Drone service sends events that contain the drone's current location and status.</span></span> <span data-ttu-id="89a35-218">Der Dienst „Delivery“ lauscht auf diese Ereignisse, um den Status einer Lieferung nachzuverfolgen.</span><span class="sxs-lookup"><span data-stu-id="89a35-218">The Delivery service listens to these events in order to track the status of a delivery.</span></span>

- <span data-ttu-id="89a35-219">Bei einer Änderung des Lieferstatus sendet der Dienst „Delivery“ ein Lieferstatusereignis wie `DeliveryCreated` oder `DeliveryCompleted`.</span><span class="sxs-lookup"><span data-stu-id="89a35-219">When the status of a delivery changes, the Delivery service sends a delivery status event, such as `DeliveryCreated` or `DeliveryCompleted`.</span></span> <span data-ttu-id="89a35-220">Diese Ereignisse können von jedem beliebigen Dienst abonniert werden.</span><span class="sxs-lookup"><span data-stu-id="89a35-220">Any service can subscribe to these events.</span></span> <span data-ttu-id="89a35-221">Im aktuellen Entwurf ist der Dienst „Delivery“ der einzige Abonnent, später können jedoch noch weitere Abonnenten hinzukommen.</span><span class="sxs-lookup"><span data-stu-id="89a35-221">In the current design, the Delivery service is the only subscriber, but there might be other subscribers later.</span></span> <span data-ttu-id="89a35-222">So können die Ereignisse beispielsweise an einen Echtzeitanalysedienst übermittelt werden.</span><span class="sxs-lookup"><span data-stu-id="89a35-222">For example, the events might go to a real-time analytics service.</span></span> <span data-ttu-id="89a35-223">Da der Dienst „Scheduler“ nicht auf eine Antwort warten muss, hat das Hinzufügen weiterer Abonnenten keine Auswirkungen auf den Pfad des Hauptworkflows.</span><span class="sxs-lookup"><span data-stu-id="89a35-223">And because the Scheduler doesn't have to wait for a response, adding more subscribers doesn't affect the main workflow path.</span></span>

![](./images/drone-communication.png)

<span data-ttu-id="89a35-224">Beachten Sie, dass Lieferstatusereignisse von Drohnenpositionsereignissen abgeleitet werden.</span><span class="sxs-lookup"><span data-stu-id="89a35-224">Notice that delivery status events are derived from drone location events.</span></span> <span data-ttu-id="89a35-225">Wenn eine Drohne also beispielsweise einen Lieferort erreicht und ein Paket zustellt, übersetzt der Dienst „Delivery“ dies in ein DeliveryCompleted-Ereignis.</span><span class="sxs-lookup"><span data-stu-id="89a35-225">For example, when a drone reaches a delivery location and drops off a package, the Delivery service translates this into a DeliveryCompleted event.</span></span> <span data-ttu-id="89a35-226">Hierbei handelt es sich um ein Beispiel für domänenmodellorientiertes Denken.</span><span class="sxs-lookup"><span data-stu-id="89a35-226">This is an example of thinking in terms of domain models.</span></span> <span data-ttu-id="89a35-227">Die Drohnenverwaltung gehört, wie bereits beschrieben, zu einer separaten Kontextgrenze.</span><span class="sxs-lookup"><span data-stu-id="89a35-227">As described earlier, Drone Management belongs in a separate bounded context.</span></span> <span data-ttu-id="89a35-228">Die Drohnenereignisse geben Aufschluss über die physische Position einer Drohne.</span><span class="sxs-lookup"><span data-stu-id="89a35-228">The drone events convey the physical location of a drone.</span></span> <span data-ttu-id="89a35-229">Die Lieferereignisse stellen hingegen Änderungen beim Status einer Lieferung dar. Dabei handelt es sich um eine andere Geschäftseinheit.</span><span class="sxs-lookup"><span data-stu-id="89a35-229">The delivery events, on the other hand, represent changes in the status of a delivery, which is a different business entity.</span></span>

## <a name="using-a-service-mesh"></a><span data-ttu-id="89a35-230">Verwenden eines Dienstnetzes</span><span class="sxs-lookup"><span data-stu-id="89a35-230">Using a service mesh</span></span>

<span data-ttu-id="89a35-231">Ein *Dienstnetz* ist eine Softwareschicht für die Kommunikation zwischen Diensten.</span><span class="sxs-lookup"><span data-stu-id="89a35-231">A *service mesh* is a software layer that handles service-to-service communication.</span></span> <span data-ttu-id="89a35-232">Dienstnetze ermöglichen die Behandlung vieler Probleme aus dem vorherigen Abschnitt und verlagern die Zuständigkeit für diese Probleme von den Microservices auf eine gemeinsame Schicht.</span><span class="sxs-lookup"><span data-stu-id="89a35-232">Service meshes are designed to address many of the concerns listed in the previous section, and to move responsibility for these concerns away from the microservices themselves and into a shared layer.</span></span> <span data-ttu-id="89a35-233">Das Dienstnetz fungiert als Proxy, der die Netzwerkkommunikation zwischen Microservices im Cluster abfängt.</span><span class="sxs-lookup"><span data-stu-id="89a35-233">The service mesh acts as a proxy that intercepts network communication between microservices in the cluster.</span></span> 

> [!NOTE]
> <span data-ttu-id="89a35-234">Ein Dienstnetz ist ein Beispiel für das [Botschaftermuster](../patterns/ambassador.md) – ein Hilfsdienst, der Netzwerkanforderungen im Auftrag der Anwendung sendet.</span><span class="sxs-lookup"><span data-stu-id="89a35-234">Service mesh is an example of the [Ambassador pattern](../patterns/ambassador.md) &mdash; a helper service that sends network requests on behalf of the application.</span></span> 

<span data-ttu-id="89a35-235">Als Dienstnetzoptionen stehen in Kubernetes momentan hauptsächlich [linkerd](https://linkerd.io/) und [Istio](https://istio.io/) zur Verfügung.</span><span class="sxs-lookup"><span data-stu-id="89a35-235">Right now, the main options for a service mesh in Kubernetes are [linkerd](https://linkerd.io/) and [Istio](https://istio.io/).</span></span> <span data-ttu-id="89a35-236">Beide Technologien entwickeln sich rasant weiter.</span><span class="sxs-lookup"><span data-stu-id="89a35-236">Both of these technologies are evolving rapidly.</span></span> <span data-ttu-id="89a35-237">Als dieser Leitfaden erstellt wurde, war gerade die Istio-Version 0.2 aktuell. Es handelt sich also noch um eine sehr neue Technologie.</span><span class="sxs-lookup"><span data-stu-id="89a35-237">At the time we wrote this guide, the latest Istio release is 0.2, so it is still very new.</span></span> <span data-ttu-id="89a35-238">Linkerd und Istio haben jedoch unter anderem folgende Features gemeinsam:</span><span class="sxs-lookup"><span data-stu-id="89a35-238">However, some features that both linkerd and Istio have in common include:</span></span> 

- <span data-ttu-id="89a35-239">Lastenausgleich auf Sitzungsebene – basierend auf den ermittelten Wartezeiten oder der Anzahl ausstehender Anforderungen.</span><span class="sxs-lookup"><span data-stu-id="89a35-239">Load balancing at the session level, based on observed latencies or number of outstanding requests.</span></span> <span data-ttu-id="89a35-240">Dies kann die Leistung über den von Kubernetes bereitgestellten Layer-4-Lastenausgleich verbessern.</span><span class="sxs-lookup"><span data-stu-id="89a35-240">This can improve performance over the layer-4 load balancing that is provided by Kubernetes.</span></span> 

- <span data-ttu-id="89a35-241">Layer-7-Routing auf der Grundlage von URL-Pfad, Hostheader, API-Version oder anderen Regeln auf Anwendungsebene.</span><span class="sxs-lookup"><span data-stu-id="89a35-241">Layer-7 routing based on URL path, Host header, API version, or other application-level rules.</span></span>

- <span data-ttu-id="89a35-242">Wiederholung nicht erfolgreicher Anforderungen.</span><span class="sxs-lookup"><span data-stu-id="89a35-242">Retry of failed requests.</span></span> <span data-ttu-id="89a35-243">Ein Dienstnetz kann HTTP-Fehlercodes interpretieren und nicht erfolgreiche Anforderungen automatisch wiederholen.</span><span class="sxs-lookup"><span data-stu-id="89a35-243">A service mesh understands HTTP error codes, and can automatically retry failed requests.</span></span> <span data-ttu-id="89a35-244">Sie können die maximal zulässige Anzahl von Wiederholungen sowie ein Zeitlimit konfigurieren, um die maximale Wartezeit einzugrenzen.</span><span class="sxs-lookup"><span data-stu-id="89a35-244">You can configure that maximum number of retries, along with a timeout period in order to bound the maximum latency.</span></span> 

- <span data-ttu-id="89a35-245">Verbindungsunterbrechung.</span><span class="sxs-lookup"><span data-stu-id="89a35-245">Circuit breaking.</span></span> <span data-ttu-id="89a35-246">Falls Anforderungen bei einer Instanz kontinuierlich fehlschlagen, wird die Instanz vorübergehend als nicht verfügbar gekennzeichnet.</span><span class="sxs-lookup"><span data-stu-id="89a35-246">If an instance consistently fails requests, the service mesh will temporarily mark it as unavailable.</span></span> <span data-ttu-id="89a35-247">Nach einer Backoff-Zeit wird erneut versucht, die Instanz zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="89a35-247">After a backoff period, it will try the instance again.</span></span> <span data-ttu-id="89a35-248">Die Verbindungsunterbrechung kann auf der Grundlage verschiedener Kriterien (beispielsweise der Anzahl aufeinanderfolgender Fehler) konfiguriert werden.</span><span class="sxs-lookup"><span data-stu-id="89a35-248">You can configure the circuit breaker based on various criteria, such as the number of consecutive failures,</span></span>  

- <span data-ttu-id="89a35-249">Das Dienstnetz erfasst Metriken zu Aufrufen zwischen Diensten. Hierzu zählen beispielsweise das Anforderungsvolumen, die Wartezeit, Fehler- und Erfolgsraten sowie Antwortgrößen.</span><span class="sxs-lookup"><span data-stu-id="89a35-249">Service mesh captures metrics about interservice calls, such as the request volume, latency, error and success rates, and response sizes.</span></span> <span data-ttu-id="89a35-250">Das Dienstnetz ermöglicht zudem eine verteilte Ablaufverfolgung durch Hinzufügen von Korrelationsinformationen für jeden Hop in einer Anforderung.</span><span class="sxs-lookup"><span data-stu-id="89a35-250">The service mesh also enables distributed tracing by adding correlation information for each hop in a request.</span></span>

- <span data-ttu-id="89a35-251">Gegenseitige TLS-Authentifizierung für Aufrufe zwischen Diensten.</span><span class="sxs-lookup"><span data-stu-id="89a35-251">Mutual TLS Authentication for service-to-service calls.</span></span>

<span data-ttu-id="89a35-252">Benötigen Sie ein Dienstnetz?</span><span class="sxs-lookup"><span data-stu-id="89a35-252">Do you need a service mesh?</span></span> <span data-ttu-id="89a35-253">Der Zusatznutzen für verteilte Systeme ist sicherlich verlockend.</span><span class="sxs-lookup"><span data-stu-id="89a35-253">The value they add to a distributed system is certainly compelling.</span></span> <span data-ttu-id="89a35-254">Ohne Dienstnetz müssen Sie sich Gedanken über jede der weiter oben aufgeführten Herausforderungen machen.</span><span class="sxs-lookup"><span data-stu-id="89a35-254">If you don't have a service mesh, you will need to consider each of the challenges mentioned at the beginning of the chapter.</span></span> <span data-ttu-id="89a35-255">Probleme wie Wiederholung, Verbindungsunterbrechung und verteilte Ablaufverfolgung lassen sich zwar auch ohne Dienstnetz lösen, ein Dienstnetz verlagert diese Aspekte jedoch von den einzelnen Diensten auf eine dedizierte Schicht.</span><span class="sxs-lookup"><span data-stu-id="89a35-255">You can solve problems like retry, circuit breaker, and distributed tracing without a service mesh, but a service mesh moves these concerns out of the individual services and into a dedicated layer.</span></span> <span data-ttu-id="89a35-256">Auf der anderen Seite handelt es sich bei Dienstnetzen um eine relativ neue Technologie, die sich immer noch in der Entwicklung befindet.</span><span class="sxs-lookup"><span data-stu-id="89a35-256">On the other hand, service meshes are a relatively new technology that is still maturing.</span></span> <span data-ttu-id="89a35-257">Durch die Bereitstellung eines Dienstnetzes erhöht sich die Komplexität bei der Einrichtung und Konfiguration des Clusters.</span><span class="sxs-lookup"><span data-stu-id="89a35-257">Deploying a service mesh adds complexity to the setup and configuration of the cluster.</span></span> <span data-ttu-id="89a35-258">Unter Umständen wirkt sich die Bereitstellung auch auf die Leistung aus, da Anforderungen nun über den Dienstnetzproxy geleitet und auf jedem Knoten im Cluster zusätzliche Dienste ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="89a35-258">There may be performance implications, because requests now get routed through the service mesh proxy, and because extra services are now running on every node in the cluster.</span></span> <span data-ttu-id="89a35-259">Führen Sie daher umfassende Leistungs- und Auslastungstests durch, bevor Sie ein Dienstnetz in der Produktionsumgebung bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="89a35-259">You should do thorough performance and load testing before deploying a service mesh in production.</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="89a35-260">API-Design</span><span class="sxs-lookup"><span data-stu-id="89a35-260">API design</span></span>](./api-design.md)

<!-- links -->

[ingestion-workflow]: ./ingestion-workflow.md
