---
title: n-schichtige Anwendung mit SQL Server
description: Vorgehensweise zur Implementierung einer mehrschichtigen Architektur in Azure für Verfügbarkeit, Sicherheit, Skalierbarkeit und Verwaltbarkeit.
author: MikeWasson
ms.date: 11/12/2018
ms.openlocfilehash: 857b666ef8af8fec21d7a8a9756508344aa07acc
ms.sourcegitcommit: 9293350ab66fb5ed042ff363f7a76603bf68f568
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 11/13/2018
ms.locfileid: "51577122"
---
# <a name="windows-n-tier-application-on-azure-with-sql-server"></a><span data-ttu-id="6550a-103">n-schichtige Windows-Anwendung in Azure mit SQL Server</span><span class="sxs-lookup"><span data-stu-id="6550a-103">Windows N-tier application on Azure with SQL Server</span></span>

<span data-ttu-id="6550a-104">Diese Referenzarchitektur zeigt, wie Sie für eine n-schichtige Anwendung konfigurierte virtuelle Computer und ein entsprechendes virtuelles Netzwerk mit SQL Server unter Windows für die Datenebene bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="6550a-104">This reference architecture shows how to deploy VMs and a virtual network configured for an N-tier application, using SQL Server on Windows for the data tier.</span></span> [<span data-ttu-id="6550a-105">**So stellen Sie diese Lösung bereit**.</span><span class="sxs-lookup"><span data-stu-id="6550a-105">**Deploy this solution**.</span></span>](#deploy-the-solution) 

<span data-ttu-id="6550a-106">![[0]][0]</span><span class="sxs-lookup"><span data-stu-id="6550a-106">![[0]][0]</span></span>

<span data-ttu-id="6550a-107">*Laden Sie eine [Visio-Datei][visio-download] mit dieser Architektur herunter.*</span><span class="sxs-lookup"><span data-stu-id="6550a-107">*Download a [Visio file][visio-download] of this architecture.*</span></span>

## <a name="architecture"></a><span data-ttu-id="6550a-108">Architecture</span><span class="sxs-lookup"><span data-stu-id="6550a-108">Architecture</span></span> 

<span data-ttu-id="6550a-109">Die Architektur besteht aus den folgenden Komponenten:</span><span class="sxs-lookup"><span data-stu-id="6550a-109">The architecture has the following components:</span></span>

* <span data-ttu-id="6550a-110">**Ressourcengruppe:**</span><span class="sxs-lookup"><span data-stu-id="6550a-110">**Resource group.**</span></span> <span data-ttu-id="6550a-111">[Ressourcengruppen][resource-manager-overview] dienen zum Gruppieren von Ressourcen, damit sie nach Lebensdauer, Besitzer oder anderen Kriterien verwaltet werden können.</span><span class="sxs-lookup"><span data-stu-id="6550a-111">[Resource groups][resource-manager-overview] are used to group resources so they can be managed by lifetime, owner, or other criteria.</span></span>

* <span data-ttu-id="6550a-112">**Virtuelles Netzwerk (VNet) und Subnetze:**</span><span class="sxs-lookup"><span data-stu-id="6550a-112">**Virtual network (VNet) and subnets.**</span></span> <span data-ttu-id="6550a-113">Jede Azure-VM wird in einem virtuellen Netzwerk (VNET) bereitgestellt, das in Subnetze segmentiert werden kann.</span><span class="sxs-lookup"><span data-stu-id="6550a-113">Every Azure VM is deployed into a VNet that can be segmented into subnets.</span></span> <span data-ttu-id="6550a-114">Erstellen Sie für jede Schicht ein separates Subnetz.</span><span class="sxs-lookup"><span data-stu-id="6550a-114">Create a separate subnet for each tier.</span></span> 

* <span data-ttu-id="6550a-115">**Anwendungsgateway:**</span><span class="sxs-lookup"><span data-stu-id="6550a-115">**Application gateway**.</span></span> <span data-ttu-id="6550a-116">[Azure Application Gateway](/azure/application-gateway/) ist ein Load Balancer auf Schicht 7 (Anwendungsschicht).</span><span class="sxs-lookup"><span data-stu-id="6550a-116">[Azure Application Gateway](/azure/application-gateway/) is a layer 7 load balancer.</span></span> <span data-ttu-id="6550a-117">Bei dieser Architektur werden HTTP-Anforderungen an das Web-Front-End geleitet.</span><span class="sxs-lookup"><span data-stu-id="6550a-117">In this architecture, it routes HTTP requests to the web front end.</span></span> <span data-ttu-id="6550a-118">Mit Application Gateway wird auch eine [Web Application Firewall](/azure/application-gateway/waf-overview) (WAF) bereitgestellt, mit der die Anwendung vor häufig auftretenden Exploits und Sicherheitsrisiken geschützt wird.</span><span class="sxs-lookup"><span data-stu-id="6550a-118">Application Gateway also provides a [web application firewall](/azure/application-gateway/waf-overview) (WAF) that protects the application from common exploits and vulnerabilities.</span></span> 

* <span data-ttu-id="6550a-119">**NSGs:**</span><span class="sxs-lookup"><span data-stu-id="6550a-119">**NSGs.**</span></span> <span data-ttu-id="6550a-120">Verwenden Sie [Netzwerksicherheitsgruppen][nsg] (NSGs), um den Netzwerkdatenverkehr im VNET zu beschränken.</span><span class="sxs-lookup"><span data-stu-id="6550a-120">Use [network security groups][nsg] (NSGs) to restrict network traffic within the VNet.</span></span> <span data-ttu-id="6550a-121">In der hier gezeigten dreischichtigen Architektur akzeptiert die Datenbankschicht beispielsweise keinen Datenverkehr vom Web-Front-End, sondern nur von der Unternehmensschicht und dem Verwaltungssubnetz.</span><span class="sxs-lookup"><span data-stu-id="6550a-121">For example, in the three-tier architecture shown here, the database tier does not accept traffic from the web front end, only from the business tier and the management subnet.</span></span>

* <span data-ttu-id="6550a-122">**Azure DDoS Protection**.</span><span class="sxs-lookup"><span data-stu-id="6550a-122">**DDoS Protection**.</span></span> <span data-ttu-id="6550a-123">Obwohl die Azure-Plattform Schutz vor verteilten Denial-of-Service-Angriffen (DDoS) beinhaltet, empfehlen wir die Verwendung der Dienstebene [DDoS Protection Standard][ddos], die erweiterte Funktionen für die DDoS-Entschärfung bietet.</span><span class="sxs-lookup"><span data-stu-id="6550a-123">Although the Azure platform provides basic protection against distributed denial of service (DDoS) attacks, we recommend using [DDoS Protection Standard][ddos], which has enhanced DDoS mitigation features.</span></span> <span data-ttu-id="6550a-124">Weitere Informationen finden Sie unter [Sicherheitshinweise](#security-considerations).</span><span class="sxs-lookup"><span data-stu-id="6550a-124">See [Security considerations](#security-considerations).</span></span>

* <span data-ttu-id="6550a-125">**Virtuelle Computer:**</span><span class="sxs-lookup"><span data-stu-id="6550a-125">**Virtual machines**.</span></span> <span data-ttu-id="6550a-126">Empfehlungen zum Konfigurieren von virtuellen Computern finden Sie unter [Run a Windows VM on Azure](./windows-vm.md) (Ausführen eines virtuellen Windows-Computers in Azure) sowie unter [Run a Linux VM on Azure](./linux-vm.md) (Ausführen eines virtuellen Linux-Computers in Azure).</span><span class="sxs-lookup"><span data-stu-id="6550a-126">For recommendations on configuring VMs, see [Run a Windows VM on Azure](./windows-vm.md) and [Run a Linux VM on Azure](./linux-vm.md).</span></span>

* <span data-ttu-id="6550a-127">**Verfügbarkeitsgruppen:**</span><span class="sxs-lookup"><span data-stu-id="6550a-127">**Availability sets.**</span></span> <span data-ttu-id="6550a-128">Erstellen Sie eine [Verfügbarkeitsgruppe][azure-availability-sets] für jede Schicht, und stellen Sie mindestens zwei VMs in jeder Schicht bereit. Dadurch ist die VM für eine höhere [Vereinbarung zum Servicelevel (SLA)][vm-sla] qualifiziert.</span><span class="sxs-lookup"><span data-stu-id="6550a-128">Create an [availability set][azure-availability-sets] for each tier, and provision at least two VMs in each tier, which makes the VMs eligible for a higher [service level agreement (SLA)][vm-sla].</span></span>

* <span data-ttu-id="6550a-129">**Lastenausgleichsmodule:**</span><span class="sxs-lookup"><span data-stu-id="6550a-129">**Load balancers.**</span></span> <span data-ttu-id="6550a-130">Verwenden Sie [Azure Load Balancer][load-balancer] zum Verteilen von Netzwerkdatenverkehr von der Webebene auf die Geschäftsebene und von der Geschäftsebene an SQL Server.</span><span class="sxs-lookup"><span data-stu-id="6550a-130">Use [Azure Load Balancer][load-balancer] to distribute network traffic from the web tier to the business tier, and from the business tier to SQL Server.</span></span>

* <span data-ttu-id="6550a-131">**Öffentliche IP-Adresse:**</span><span class="sxs-lookup"><span data-stu-id="6550a-131">**Public IP address**.</span></span> <span data-ttu-id="6550a-132">Es ist eine öffentliche IP-Adresse erforderlich, damit die Anwendung Internetdatenverkehr empfangen kann.</span><span class="sxs-lookup"><span data-stu-id="6550a-132">A public IP address is needed for the application to receive Internet traffic.</span></span>

* <span data-ttu-id="6550a-133">**Jumpbox:**</span><span class="sxs-lookup"><span data-stu-id="6550a-133">**Jumpbox.**</span></span> <span data-ttu-id="6550a-134">Wird auch als [geschützter Host] bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="6550a-134">Also called a [bastion host].</span></span> <span data-ttu-id="6550a-135">Dies ist eine geschützte VM im Netzwerk, die von Administratoren zum Herstellen der Verbindung mit anderen VMs verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="6550a-135">A secure VM on the network that administrators use to connect to the other VMs.</span></span> <span data-ttu-id="6550a-136">Die Jumpbox verfügt über eine NSG, die Remotedatenverkehr nur von öffentlichen IP-Adressen zulässt, die in einer Liste mit sicheren Absendern aufgeführt sind.</span><span class="sxs-lookup"><span data-stu-id="6550a-136">The jumpbox has an NSG that allows remote traffic only from public IP addresses on a safe list.</span></span> <span data-ttu-id="6550a-137">Die NSG sollte Remotedesktop-Datenverkehr (RDP) zulassen.</span><span class="sxs-lookup"><span data-stu-id="6550a-137">The NSG should permit remote desktop (RDP) traffic.</span></span>

* <span data-ttu-id="6550a-138">**SQL Server Always On-Verfügbarkeitsgruppe:**</span><span class="sxs-lookup"><span data-stu-id="6550a-138">**SQL Server Always On Availability Group.**</span></span> <span data-ttu-id="6550a-139">Stellt Hochverfügbarkeit in der Datenschicht durch Replikation und Failover bereit.</span><span class="sxs-lookup"><span data-stu-id="6550a-139">Provides high availability at the data tier, by enabling replication and failover.</span></span> <span data-ttu-id="6550a-140">Verwendet WSFC-Technologie (Windows Server-Failovercluster) für Failover.</span><span class="sxs-lookup"><span data-stu-id="6550a-140">It uses Windows Server Failover Cluster (WSFC) technology for failover.</span></span>

* <span data-ttu-id="6550a-141">**AD DS-Server (Active Directory Domain Services):**</span><span class="sxs-lookup"><span data-stu-id="6550a-141">**Active Directory Domain Services (AD DS) Servers**.</span></span> <span data-ttu-id="6550a-142">Die Computerobjekte für den Failovercluster und die zugehörigen Clusterrollen werden in Active Directory Domain Services (AD DS) erstellt.</span><span class="sxs-lookup"><span data-stu-id="6550a-142">The computer objects for the failover cluster and its associated clustered roles are created in Active Directory Domain Services (AD DS).</span></span>

* <span data-ttu-id="6550a-143">**Cloudzeuge**.</span><span class="sxs-lookup"><span data-stu-id="6550a-143">**Cloud Witness**.</span></span> <span data-ttu-id="6550a-144">Bei einem Failovercluster muss mindestens die Hälfte der Knoten ausgeführt werden (Quorum).</span><span class="sxs-lookup"><span data-stu-id="6550a-144">A failover cluster requires more than half of its nodes to be running, which is known as having quorum.</span></span> <span data-ttu-id="6550a-145">Enthält der Cluster nur zwei Knoten, kann eine Netzwerkpartition dazu führen, dass sich beide Knoten als Masterknoten betrachten.</span><span class="sxs-lookup"><span data-stu-id="6550a-145">If the cluster has just two nodes, a network partition could cause each node to think it's the master node.</span></span> <span data-ttu-id="6550a-146">In diesem Fall benötigen Sie einen *Zeugen*, um den Konflikt zu lösen und ein Quorum festzulegen.</span><span class="sxs-lookup"><span data-stu-id="6550a-146">In that case, you need a *witness* to break ties and establish quorum.</span></span> <span data-ttu-id="6550a-147">Ein Zeuge ist eine Ressource (beispielsweise ein freigegebener Datenträger), der den Ausschlag für das Quorum gibt.</span><span class="sxs-lookup"><span data-stu-id="6550a-147">A witness is a resource such as a shared disk that can act as a tie breaker to establish quorum.</span></span> <span data-ttu-id="6550a-148">Ein Cloudzeuge ist ein Zeugentyp, der Azure Blob Storage nutzt.</span><span class="sxs-lookup"><span data-stu-id="6550a-148">Cloud Witness is a type of witness that uses Azure Blob Storage.</span></span> <span data-ttu-id="6550a-149">Weitere Informationen zum Konzept des Quorums finden Sie unter [Understanding cluster and pool quorum](/windows-server/storage/storage-spaces/understand-quorum) (Grundlegendes zu Cluster- und Poolquoren).</span><span class="sxs-lookup"><span data-stu-id="6550a-149">To learn more about the concept of quorum, see [Understanding cluster and pool quorum](/windows-server/storage/storage-spaces/understand-quorum).</span></span> <span data-ttu-id="6550a-150">Weitere Informationen zu Cloudzeugen finden Sie unter [Deploy a cloud witness for a Failover Cluster](/windows-server/failover-clustering/deploy-cloud-witness) (Bereitstellen eines Cloudzeugen für einen Failovercluster).</span><span class="sxs-lookup"><span data-stu-id="6550a-150">For more information about Cloud Witness, see [Deploy a Cloud Witness for a Failover Cluster](/windows-server/failover-clustering/deploy-cloud-witness).</span></span> 

* <span data-ttu-id="6550a-151">**Azure DNS:**</span><span class="sxs-lookup"><span data-stu-id="6550a-151">**Azure DNS**.</span></span> <span data-ttu-id="6550a-152">[Azure DNS][azure-dns] ist ein Hostingdienst für DNS-Domänen.</span><span class="sxs-lookup"><span data-stu-id="6550a-152">[Azure DNS][azure-dns] is a hosting service for DNS domains.</span></span> <span data-ttu-id="6550a-153">Er ermöglicht eine Namensauflösung mithilfe der Microsoft Azure-Infrastruktur.</span><span class="sxs-lookup"><span data-stu-id="6550a-153">It provides name resolution using Microsoft Azure infrastructure.</span></span> <span data-ttu-id="6550a-154">Durch das Hosten Ihrer Domänen in Azure können Sie Ihre DNS-Einträge mithilfe der gleichen Anmeldeinformationen, APIs, Tools und Abrechnung wie für die anderen Azure-Dienste verwalten.</span><span class="sxs-lookup"><span data-stu-id="6550a-154">By hosting your domains in Azure, you can manage your DNS records using the same credentials, APIs, tools, and billing as your other Azure services.</span></span>

## <a name="recommendations"></a><span data-ttu-id="6550a-155">Empfehlungen</span><span class="sxs-lookup"><span data-stu-id="6550a-155">Recommendations</span></span>

<span data-ttu-id="6550a-156">Ihre Anforderungen können von der hier beschriebenen Architektur abweichen.</span><span class="sxs-lookup"><span data-stu-id="6550a-156">Your requirements might differ from the architecture described here.</span></span> <span data-ttu-id="6550a-157">Verwenden Sie diese Empfehlungen als Startpunkt.</span><span class="sxs-lookup"><span data-stu-id="6550a-157">Use these recommendations as a starting point.</span></span> 

### <a name="vnet--subnets"></a><span data-ttu-id="6550a-158">VNET/Subnetze</span><span class="sxs-lookup"><span data-stu-id="6550a-158">VNet / Subnets</span></span>

<span data-ttu-id="6550a-159">Legen Sie bei der Erstellung des VNET fest, wie viele IP-Adressen Ihre Ressourcen in jedem Subnetz benötigen.</span><span class="sxs-lookup"><span data-stu-id="6550a-159">When you create the VNet, determine how many IP addresses your resources in each subnet require.</span></span> <span data-ttu-id="6550a-160">Geben Sie mithilfe der [CIDR] eine Subnetzmaske und einen VNET-Adressbereich an, der für die erforderlichen IP-Adressen groß genug ist.</span><span class="sxs-lookup"><span data-stu-id="6550a-160">Specify a subnet mask and a VNet address range large enough for the required IP addresses, using [CIDR] notation.</span></span> <span data-ttu-id="6550a-161">Verwenden Sie einen Adressraum, der in die standardmäßigen [privaten IP-Adressblöcke][private-ip-space] 10.0.0.0/8, 172.16.0.0/12 und 192.168.0.0/16 fällt.</span><span class="sxs-lookup"><span data-stu-id="6550a-161">Use an address space that falls within the standard [private IP address blocks][private-ip-space], which are 10.0.0.0/8, 172.16.0.0/12, and 192.168.0.0/16.</span></span>

<span data-ttu-id="6550a-162">Wählen Sie einen Adressbereich, der sich nicht mit Ihrem lokalen Netzwerk überschneidet, für den Fall, dass Sie später ein Gateway zwischen dem VNET und dem lokalen Netzwerk einrichten müssen.</span><span class="sxs-lookup"><span data-stu-id="6550a-162">Choose an address range that does not overlap with your on-premises network, in case you need to set up a gateway between the VNet and your on-premise network later.</span></span> <span data-ttu-id="6550a-163">Sobald Sie das VNET erstellt haben, können Sie den Adressbereich nicht mehr ändern.</span><span class="sxs-lookup"><span data-stu-id="6550a-163">Once you create the VNet, you can't change the address range.</span></span>

<span data-ttu-id="6550a-164">Entwerfen Sie Subnetze unter Berücksichtigung der Funktionalität und Sicherheitsanforderungen.</span><span class="sxs-lookup"><span data-stu-id="6550a-164">Design subnets with functionality and security requirements in mind.</span></span> <span data-ttu-id="6550a-165">Alle VMs innerhalb derselben Schicht oder Rolle sollten im selben Subnetz platziert werden, was eine Sicherheitsbegrenzung darstellen kann.</span><span class="sxs-lookup"><span data-stu-id="6550a-165">All VMs within the same tier or role should go into the same subnet, which can be a security boundary.</span></span> <span data-ttu-id="6550a-166">Weitere Informationen zum Entwerfen von VNETs und Subnetzen finden Sie unter [Planen und Entwerfen von Azure Virtual Networks][plan-network].</span><span class="sxs-lookup"><span data-stu-id="6550a-166">For more information about designing VNets and subnets, see [Plan and design Azure Virtual Networks][plan-network].</span></span>

### <a name="load-balancers"></a><span data-ttu-id="6550a-167">Load Balancer</span><span class="sxs-lookup"><span data-stu-id="6550a-167">Load balancers</span></span>

<span data-ttu-id="6550a-168">Machen Sie die VMs nicht direkt über das Internet verfügbar. Weisen Sie stattdessen jeder VM eine private IP-Adresse zu.</span><span class="sxs-lookup"><span data-stu-id="6550a-168">Don't expose the VMs directly to the Internet, but instead give each VM a private IP address.</span></span> <span data-ttu-id="6550a-169">Clients stellen über die öffentliche IP-Adresse eine Verbindung her, die dem Application Gateway zugeordnet ist.</span><span class="sxs-lookup"><span data-stu-id="6550a-169">Clients connect using the public IP address  associated with the Application Gateway.</span></span>

<span data-ttu-id="6550a-170">Definieren Sie Lastenausgleichsregeln, um Netzwerkdatenverkehr an die virtuellen Computer weiterzuleiten.</span><span class="sxs-lookup"><span data-stu-id="6550a-170">Define load balancer rules to direct network traffic to the VMs.</span></span> <span data-ttu-id="6550a-171">Um HTTP-Datenverkehr zuzulassen, ordnen Sie beispielsweise den Port 80 in der Front-End-Konfiguration dem Port 80 im Back-End-Adresspool zu.</span><span class="sxs-lookup"><span data-stu-id="6550a-171">For example, to enable HTTP traffic, map port 80 from the front-end configuration to port 80 on the back-end address pool.</span></span> <span data-ttu-id="6550a-172">Wenn ein Client eine HTTP-Anforderung an Port 80 sendet, wählt der Lastenausgleich mithilfe eines [Hashalgorithmus][load-balancer-hashing], der die Quell-IP-Adresse enthält, eine Back-End-IP-Adresse aus.</span><span class="sxs-lookup"><span data-stu-id="6550a-172">When a client sends an HTTP request to port 80, the load balancer selects a back-end IP address by using a [hashing algorithm][load-balancer-hashing] that includes the source IP address.</span></span> <span data-ttu-id="6550a-173">So werden Clientanforderungen auf alle VMs im Back-End-Adresspool verteilt.</span><span class="sxs-lookup"><span data-stu-id="6550a-173">Client requests are distributed across all the VMs in the back-end address pool.</span></span>

### <a name="network-security-groups"></a><span data-ttu-id="6550a-174">Netzwerksicherheitsgruppen</span><span class="sxs-lookup"><span data-stu-id="6550a-174">Network security groups</span></span>

<span data-ttu-id="6550a-175">Verwenden Sie NSG-Regeln, um den Datenverkehr zwischen den Schichten zu beschränken.</span><span class="sxs-lookup"><span data-stu-id="6550a-175">Use NSG rules to restrict traffic between tiers.</span></span> <span data-ttu-id="6550a-176">In der oben gezeigten dreischichtigen Architektur kommuniziert die Internetschicht nicht direkt mit der Datenbankschicht.</span><span class="sxs-lookup"><span data-stu-id="6550a-176">In the three-tier architecture shown above, the web tier does not communicate directly with the database tier.</span></span> <span data-ttu-id="6550a-177">Um dies zu erzwingen, sollte die Datenbankschicht eingehenden Datenverkehr aus dem Subnetz der Internetschicht blockieren.</span><span class="sxs-lookup"><span data-stu-id="6550a-177">To enforce this, the database tier should block incoming traffic from the web tier subnet.</span></span>  

1. <span data-ttu-id="6550a-178">Lehen Sie sämtlichen eingehenden Datenverkehr aus dem VNet ab.</span><span class="sxs-lookup"><span data-stu-id="6550a-178">Deny all inbound traffic from the VNet.</span></span> <span data-ttu-id="6550a-179">(Verwenden Sie den `VIRTUAL_NETWORK`-Tag in der Regel.)</span><span class="sxs-lookup"><span data-stu-id="6550a-179">(Use the `VIRTUAL_NETWORK` tag in the rule.)</span></span> 
2. <span data-ttu-id="6550a-180">Lassen Sie eingehenden Datenverkehr aus dem Subnetz der Unternehmensschicht zu.</span><span class="sxs-lookup"><span data-stu-id="6550a-180">Allow inbound traffic from the business tier subnet.</span></span>  
3. <span data-ttu-id="6550a-181">Lassen Sie eingehenden Datenverkehr aus dem Subnetz der Datenbankschicht zu.</span><span class="sxs-lookup"><span data-stu-id="6550a-181">Allow inbound traffic from the database tier subnet itself.</span></span> <span data-ttu-id="6550a-182">Diese Regel ermöglicht die Kommunikation zwischen den virtuellen Datenbankcomputern, die für die Replikation und das Failover der Datenbank erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="6550a-182">This rule allows communication between the database VMs, which is needed for database replication and failover.</span></span>
4. <span data-ttu-id="6550a-183">Lassen Sie RDP-Datenverkehr (Port 3389) aus dem Subnetz der Jumpbox zu.</span><span class="sxs-lookup"><span data-stu-id="6550a-183">Allow RDP traffic (port 3389) from the jumpbox subnet.</span></span> <span data-ttu-id="6550a-184">Diese Regel erlaubt Administratoren, über die Jumpbox eine Verbindung mit der Datenbankschicht herzustellen.</span><span class="sxs-lookup"><span data-stu-id="6550a-184">This rule lets administrators connect to the database tier from the jumpbox.</span></span>

<span data-ttu-id="6550a-185">Erstellen Sie die Regeln 2&ndash;4 mit einer höheren Priorität als die erste Regel, damit sie Vorrang haben.</span><span class="sxs-lookup"><span data-stu-id="6550a-185">Create rules 2 &ndash; 4 with higher priority than the first rule, so they override it.</span></span>


### <a name="sql-server-always-on-availability-groups"></a><span data-ttu-id="6550a-186">SQL Server Always On-Verfügbarkeitsgruppen</span><span class="sxs-lookup"><span data-stu-id="6550a-186">SQL Server Always On Availability Groups</span></span>

<span data-ttu-id="6550a-187">Um Hochverfügbarkeit von SQL Server zu erzielen, werden [AlwaysOn-Verfügbarkeitsgruppen][sql-alwayson] empfohlen.</span><span class="sxs-lookup"><span data-stu-id="6550a-187">We recommend [Always On Availability Groups][sql-alwayson] for SQL Server high availability.</span></span> <span data-ttu-id="6550a-188">Bei früheren Versionen als Windows Server 2016 erfordern AlwaysOn-Verfügbarkeitsgruppen einen Domänencontroller, und alle Knoten in der Verfügbarkeitsgruppe müssen sich in der gleichen AD-Domäne befinden.</span><span class="sxs-lookup"><span data-stu-id="6550a-188">Prior to Windows Server 2016, Always On Availability Groups require a domain controller, and all nodes in the availability group must be in the same AD domain.</span></span>

<span data-ttu-id="6550a-189">Andere Schichten stellen über einen [Verfügbarkeitsgruppenlistener][sql-alwayson-listeners] eine Verbindung mit der Datenbank her.</span><span class="sxs-lookup"><span data-stu-id="6550a-189">Other tiers connect to the database through an [availability group listener][sql-alwayson-listeners].</span></span> <span data-ttu-id="6550a-190">Mit dem Listener kann ein SQL-Client eine Verbindung herstellen, ohne den Namen der physischen SQL Server-Instanz zu kennen.</span><span class="sxs-lookup"><span data-stu-id="6550a-190">The listener enables a SQL client to connect without knowing the name of the physical instance of SQL Server.</span></span> <span data-ttu-id="6550a-191">VMs, die auf die Datenbank zugreifen, müssen Mitglied der Domäne sein.</span><span class="sxs-lookup"><span data-stu-id="6550a-191">VMs that access the database must be joined to the domain.</span></span> <span data-ttu-id="6550a-192">Der Client (in diesem Fall eine andere Schicht) verwendet DNS, um den Namen des virtuellen Netzwerks des Listeners in IP-Adressen aufzulösen.</span><span class="sxs-lookup"><span data-stu-id="6550a-192">The client (in this case, another tier) uses DNS to resolve the listener's virtual network name into IP addresses.</span></span>

<span data-ttu-id="6550a-193">Konfigurieren Sie die SQL Server-Always On-Verfügbarkeitsgruppe wie folgt:</span><span class="sxs-lookup"><span data-stu-id="6550a-193">Configure the SQL Server Always On Availability Group as follows:</span></span>

1. <span data-ttu-id="6550a-194">Erstellen Sie einen WSFC-Cluster (Windows Server Failover Clustering), eine SQL Server Always On-Verfügbarkeitsgruppe und ein primäres Replikat.</span><span class="sxs-lookup"><span data-stu-id="6550a-194">Create a Windows Server Failover Clustering (WSFC) cluster, a SQL Server Always On Availability Group, and a primary replica.</span></span> <span data-ttu-id="6550a-195">Weitere Informationen finden Sie unter [Erste Schritte mit Always On-Verfügbarkeitsgruppen (SQL Server)][sql-alwayson-getting-started].</span><span class="sxs-lookup"><span data-stu-id="6550a-195">For more information, see [Getting Started with Always On Availability Groups][sql-alwayson-getting-started].</span></span> 
2. <span data-ttu-id="6550a-196">Erstellen Sie ein internes Lastenausgleichsmodul mit einer statischen privaten IP-Adresse.</span><span class="sxs-lookup"><span data-stu-id="6550a-196">Create an internal load balancer with a static private IP address.</span></span>
3. <span data-ttu-id="6550a-197">Erstellen Sie einen Verfügbarkeitsgruppenlistener, und ordnen Sie den DNS-Namen des Listeners der IP-Adresse eines internen Lastenausgleichsmoduls zu.</span><span class="sxs-lookup"><span data-stu-id="6550a-197">Create an availability group listener, and map the listener's DNS name to the IP address of an internal load balancer.</span></span> 
4. <span data-ttu-id="6550a-198">Erstellen Sie eine Lastenausgleichsregel für den SQL Server-Überwachungsport (standardmäßig TCP-Port 1433).</span><span class="sxs-lookup"><span data-stu-id="6550a-198">Create a load balancer rule for the SQL Server listening port (TCP port 1433 by default).</span></span> <span data-ttu-id="6550a-199">Die Lastenausgleichsregel muss *Floating IP*, auch als „Direct Server Return“ bezeichnet, aktivieren.</span><span class="sxs-lookup"><span data-stu-id="6550a-199">The load balancer rule must enable *floating IP*, also called Direct Server Return.</span></span> <span data-ttu-id="6550a-200">Dies bewirkt, dass die VM direkt auf den Client antwortet, was eine direkte Verbindung mit dem primären Replikat ermöglicht.</span><span class="sxs-lookup"><span data-stu-id="6550a-200">This causes the VM to reply directly to the client, which enables a direct connection to the primary replica.</span></span>
  
   > [!NOTE]
   > <span data-ttu-id="6550a-201">Wenn die Floating IP aktiviert ist, muss die Portnummer des Front-Ends mit der des Back-Ends in der Lastenausgleichsregel übereinstimmen.</span><span class="sxs-lookup"><span data-stu-id="6550a-201">When floating IP is enabled, the front-end port number must be the same as the back-end port number in the load balancer rule.</span></span>
   > 
   > 

<span data-ttu-id="6550a-202">Wenn ein SQL-Client versucht, eine Verbindung herzustellen, leitet das Lastenausgleichsmodul die Verbindungsanforderung an das primäre Replikat weiter.</span><span class="sxs-lookup"><span data-stu-id="6550a-202">When a SQL client tries to connect, the load balancer routes the connection request to the primary replica.</span></span> <span data-ttu-id="6550a-203">Bei einem Failover zu einem anderen Replikat leitet der Lastenausgleich neue Anforderungen automatisch an ein neues primäres Replikat weiter.</span><span class="sxs-lookup"><span data-stu-id="6550a-203">If there is a failover to another replica, the load balancer automatically routes new requests to a new primary replica.</span></span> <span data-ttu-id="6550a-204">Weitere Informationen finden Sie unter [Konfigurieren eines ILB-Listeners für AlwaysOn-Verfügbarkeitsgruppen in Azure][sql-alwayson-ilb].</span><span class="sxs-lookup"><span data-stu-id="6550a-204">For more information, see [Configure an ILB listener for SQL Server Always On Availability Groups][sql-alwayson-ilb].</span></span>

<span data-ttu-id="6550a-205">Bei einem Failover werden bestehende Clientverbindungen geschlossen.</span><span class="sxs-lookup"><span data-stu-id="6550a-205">During a failover, existing client connections are closed.</span></span> <span data-ttu-id="6550a-206">Nachdem das Failover abgeschlossen ist, werden neue Verbindungen an das neue primäre Replikat weitergeleitet.</span><span class="sxs-lookup"><span data-stu-id="6550a-206">After the failover completes, new connections will be routed to the new primary replica.</span></span>

<span data-ttu-id="6550a-207">Wenn Ihre Anwendung deutlich mehr Lesezugriffe als Schreibzugriffe tätigt, können Sie einige der schreibgeschützten Abfragen in ein sekundäres Replikat auslagern.</span><span class="sxs-lookup"><span data-stu-id="6550a-207">If your application makes significantly more reads than writes, you can offload some of the read-only queries to a secondary replica.</span></span> <span data-ttu-id="6550a-208">Weitere Informationen finden Sie unter [Verwenden eines Listeners zum Herstellen einer Verbindung mit einem schreibgeschützten sekundären Replikat (schreibgeschütztes Routing)][sql-alwayson-read-only-routing].</span><span class="sxs-lookup"><span data-stu-id="6550a-208">See [Using a Listener to Connect to a Read-Only Secondary Replica (Read-Only Routing)][sql-alwayson-read-only-routing].</span></span>

<span data-ttu-id="6550a-209">Testen Sie Ihre Bereitstellung, indem Sie [ein manuelles Failover der Verfügbarkeitsgruppe erzwingen][sql-alwayson-force-failover].</span><span class="sxs-lookup"><span data-stu-id="6550a-209">Test your deployment by [forcing a manual failover][sql-alwayson-force-failover] of the availability group.</span></span>

### <a name="jumpbox"></a><span data-ttu-id="6550a-210">Jumpbox</span><span class="sxs-lookup"><span data-stu-id="6550a-210">Jumpbox</span></span>

<span data-ttu-id="6550a-211">Verweigern Sie den RDP-Zugriff (Remotedesktopprotokoll) über das öffentliche Internet auf die VMs, auf denen die Anwendungsworkload ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="6550a-211">Don't allow RDP access from the public Internet to the VMs that run the application workload.</span></span> <span data-ttu-id="6550a-212">Der gesamte RDP-Zugriff auf diese VMs muss stattdessen über die Jumpbox erfolgen.</span><span class="sxs-lookup"><span data-stu-id="6550a-212">Instead, all RDP access to these VMs must come through the jumpbox.</span></span> <span data-ttu-id="6550a-213">Ein Administrator meldet sich bei der Jumpbox und von der Jumpbox aus dann bei der anderen VM an.</span><span class="sxs-lookup"><span data-stu-id="6550a-213">An administrator logs into the jumpbox, and then logs into the other VM from the jumpbox.</span></span> <span data-ttu-id="6550a-214">Die Jumpbox lässt RDP-Datenverkehr aus dem Internet zu, jedoch nur von bekannten, sicheren IP-Adressen.</span><span class="sxs-lookup"><span data-stu-id="6550a-214">The jumpbox allows RDP traffic from the Internet, but only from known, safe IP addresses.</span></span>

<span data-ttu-id="6550a-215">Die Jumpbox hat sehr geringe Leistungsanforderungen. Wählen Sie daher einen virtuellen Computer mit geringer Größe.</span><span class="sxs-lookup"><span data-stu-id="6550a-215">The jumpbox has minimal performance requirements, so select a small VM size.</span></span> <span data-ttu-id="6550a-216">Erstellen Sie eine [öffentliche IP-Adresse] für die Jumpbox.</span><span class="sxs-lookup"><span data-stu-id="6550a-216">Create a [public IP address] for the jumpbox.</span></span> <span data-ttu-id="6550a-217">Platzieren Sie die Jumpbox in dasselbe VNET wie die anderen VMs, jedoch in ein separates Verwaltungssubnetz.</span><span class="sxs-lookup"><span data-stu-id="6550a-217">Place the jumpbox in the same VNet as the other VMs, but in a separate management subnet.</span></span>

<span data-ttu-id="6550a-218">Fügen Sie zum Schutz der Jumpbox eine NSG-Regel hinzu, die ausschließlich RDP-Verbindungen von einer sicheren Gruppe öffentlicher IP-Adressen zulässt.</span><span class="sxs-lookup"><span data-stu-id="6550a-218">To secure the jumpbox, add an NSG rule that allows RDP connections only from a safe set of public IP addresses.</span></span> <span data-ttu-id="6550a-219">Konfigurieren Sie die NSGs für die anderen Subnetze, um RDP-Datenverkehr aus dem Verwaltungssubnetz zuzulassen.</span><span class="sxs-lookup"><span data-stu-id="6550a-219">Configure the NSGs for the other subnets to allow RDP traffic from the management subnet.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="6550a-220">Überlegungen zur Skalierbarkeit</span><span class="sxs-lookup"><span data-stu-id="6550a-220">Scalability considerations</span></span>

<span data-ttu-id="6550a-221">Erwägen Sie für die Internet- und Unternehmensschichten die Verwendung von [VM-Skalierungsgruppen][vmss], anstatt separate VMs in einer Verfügbarkeitsgruppe bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="6550a-221">For the web and business tiers, consider using [virtual machine scale sets][vmss], instead of deploying separate VMs into an availability set.</span></span> <span data-ttu-id="6550a-222">Eine Skalierungsgruppe erleichtert die Bereitstellung und Verwaltung einer Gruppe identischer VMs und ermöglicht die automatische Skalierung der VMs auf der Grundlage von Leistungsmetriken.</span><span class="sxs-lookup"><span data-stu-id="6550a-222">A scale set makes it easy to deploy and manage a set of identical VMs, and autoscale the VMs based on performance metrics.</span></span> <span data-ttu-id="6550a-223">Mit zunehmender Last auf den virtuellen Computern werden dem Lastenausgleich automatisch zusätzliche virtuelle Computer hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="6550a-223">As the load on the VMs increases, additional VMs are automatically added to the load balancer.</span></span> <span data-ttu-id="6550a-224">Erwägen Sie die Verwendung von Skalierungsgruppen, wenn Sie VMs schnell horizontal hochskalieren müssen oder eine automatische Skalierung benötigen.</span><span class="sxs-lookup"><span data-stu-id="6550a-224">Consider scale sets if you need to quickly scale out VMs, or need to autoscale.</span></span>

<span data-ttu-id="6550a-225">Es gibt zwei grundlegende Methoden für das Konfigurieren von virtuellen Computern in einer Skalierungsgruppe:</span><span class="sxs-lookup"><span data-stu-id="6550a-225">There are two basic ways to configure VMs deployed in a scale set:</span></span>

- <span data-ttu-id="6550a-226">Verwenden Sie Erweiterungen, um die VM nach ihrer Bereitstellung zu konfigurieren.</span><span class="sxs-lookup"><span data-stu-id="6550a-226">Use extensions to configure the VM after it's deployed.</span></span> <span data-ttu-id="6550a-227">Bei diesem Ansatz dauert das Starten neuer VM-Instanzen länger als bei virtuellen Computern ohne Erweiterungen.</span><span class="sxs-lookup"><span data-stu-id="6550a-227">With this approach, new VM instances may take longer to start up than a VM with no extensions.</span></span>

- <span data-ttu-id="6550a-228">Stellen Sie einen [verwalteten Datenträger](/azure/storage/storage-managed-disks-overview) mit einem benutzerdefinierten Datenträgerimage bereit.</span><span class="sxs-lookup"><span data-stu-id="6550a-228">Deploy a [managed disk](/azure/storage/storage-managed-disks-overview) with a custom disk image.</span></span> <span data-ttu-id="6550a-229">Diese Option kann möglicherweise schneller bereitgestellt werden.</span><span class="sxs-lookup"><span data-stu-id="6550a-229">This option may be quicker to deploy.</span></span> <span data-ttu-id="6550a-230">Allerdings müssen Sie das Image auf dem neuesten Stand halten.</span><span class="sxs-lookup"><span data-stu-id="6550a-230">However, it requires you to keep the image up-to-date.</span></span>

<span data-ttu-id="6550a-231">Weitere Informationen finden Sie unter [Überlegungen zum Entwurf von Skalierungsgruppen][vmss-design].</span><span class="sxs-lookup"><span data-stu-id="6550a-231">For more information, see [Design considerations for scale sets][vmss-design].</span></span>

> [!TIP]
> <span data-ttu-id="6550a-232">Wenn Sie eine Lösung für die automatische Skalierung verwenden, testen Sie diese im Voraus mit Workloads auf Produktionsebene.</span><span class="sxs-lookup"><span data-stu-id="6550a-232">When using any autoscale solution, test it with production-level workloads well in advance.</span></span>

<span data-ttu-id="6550a-233">Jedes Azure-Abonnement verfügt über Standardeinschränkungen, zu denen auch eine maximale Anzahl von virtuellen Computern pro Region gehört.</span><span class="sxs-lookup"><span data-stu-id="6550a-233">Each Azure subscription has default limits in place, including a maximum number of VMs per region.</span></span> <span data-ttu-id="6550a-234">Sie können den Grenzwert erhöhen, indem Sie eine Supportanfrage einreichen.</span><span class="sxs-lookup"><span data-stu-id="6550a-234">You can increase the limit by filing a support request.</span></span> <span data-ttu-id="6550a-235">Weitere Informationen finden Sie unter [Grenzwerte für Azure-Abonnements, -Dienste und -Kontingente sowie allgemeine Beschränkungen][subscription-limits].</span><span class="sxs-lookup"><span data-stu-id="6550a-235">For more information, see [Azure subscription and service limits, quotas, and constraints][subscription-limits].</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="6550a-236">Überlegungen zur Verfügbarkeit</span><span class="sxs-lookup"><span data-stu-id="6550a-236">Availability considerations</span></span>

<span data-ttu-id="6550a-237">Wenn Sie keine VM-Skalierungsgruppen verwenden, platzieren Sie VMs für die gleiche Schicht in einer Verfügbarkeitsgruppe.</span><span class="sxs-lookup"><span data-stu-id="6550a-237">If you don't use virtual machine scale sets, put VMs for the same tier into an availability set.</span></span> <span data-ttu-id="6550a-238">Erstellen Sie zur Unterstützung der [Verfügbarkeits-SLA für Azure-VMs][vm-sla] mindestens zwei VMs in der Verfügbarkeitsgruppe.</span><span class="sxs-lookup"><span data-stu-id="6550a-238">Create at least two VMs in the availability set to support the [availability SLA for Azure VMs][vm-sla].</span></span> <span data-ttu-id="6550a-239">Weitere Informationen finden Sie unter [Verwalten der Verfügbarkeit virtueller Computer][availability-set].</span><span class="sxs-lookup"><span data-stu-id="6550a-239">For more information, see [Manage the availability of virtual machines][availability-set].</span></span> <span data-ttu-id="6550a-240">Skalierungsgruppen verwenden automatisch *Platzierungsgruppen*, die als eine implizite Verfügbarkeitsgruppe fungieren.</span><span class="sxs-lookup"><span data-stu-id="6550a-240">Scale sets automatically use *placement groups*, which act as an implicit availability set.</span></span>

<span data-ttu-id="6550a-241">Der Lastenausgleich verwendet [Integritätstests][health-probes] zur Überwachung der Verfügbarkeit von VM-Instanzen.</span><span class="sxs-lookup"><span data-stu-id="6550a-241">The load balancer uses [health probes][health-probes] to monitor the availability of VM instances.</span></span> <span data-ttu-id="6550a-242">Kann eine Instanz bei einem Test nicht innerhalb des jeweiligen Zeitlimits erreicht werden, beendet der Lastenausgleich das Senden von Datenverkehr an diese VM.</span><span class="sxs-lookup"><span data-stu-id="6550a-242">If a probe can't reach an instance within a timeout period, the load balancer stops sending traffic to that VM.</span></span> <span data-ttu-id="6550a-243">Der Lastenausgleich führt aber weiterhin Tests durch, und wenn der virtuelle Computer wieder erreichbar ist, sendet der Lastenausgleich auch wieder Datenverkehr an diese VM.</span><span class="sxs-lookup"><span data-stu-id="6550a-243">However, the load balancer will continue to probe, and if the VM becomes available again, the load balancer resumes sending traffic to that VM.</span></span>

<span data-ttu-id="6550a-244">Empfehlungen für Integritätstests durch den Lastenausgleich:</span><span class="sxs-lookup"><span data-stu-id="6550a-244">Here are some recommendations on load balancer health probes:</span></span>

* <span data-ttu-id="6550a-245">Die Tests können für HTTP oder TCP durchgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="6550a-245">Probes can test either HTTP or TCP.</span></span> <span data-ttu-id="6550a-246">Wenn auf Ihren virtuellen Computern ein HTTP-Server ausgeführt wird, erstellen Sie einen HTTP-Test.</span><span class="sxs-lookup"><span data-stu-id="6550a-246">If your VMs run an HTTP server, create an HTTP probe.</span></span> <span data-ttu-id="6550a-247">Erstellen Sie andernfalls einen TCP-Test.</span><span class="sxs-lookup"><span data-stu-id="6550a-247">Otherwise create a TCP probe.</span></span>
* <span data-ttu-id="6550a-248">Geben Sie für einen HTTP-Test den Pfad zu einem HTTP-Endpunkt an.</span><span class="sxs-lookup"><span data-stu-id="6550a-248">For an HTTP probe, specify the path to an HTTP endpoint.</span></span> <span data-ttu-id="6550a-249">Der Test überprüft, ob von diesem Pfad eine HTTP-200-Antwort empfangen wird.</span><span class="sxs-lookup"><span data-stu-id="6550a-249">The probe checks for an HTTP 200 response from this path.</span></span> <span data-ttu-id="6550a-250">Bei diesem Pfad kann es sich um den Stammpfad („/“) oder einen Endpunkt zur Integritätsüberwachung handeln, der benutzerdefinierte Logik zum Überprüfen der Integrität der Anwendung implementiert.</span><span class="sxs-lookup"><span data-stu-id="6550a-250">This path can be the root path ("/"), or a health-monitoring endpoint that implements some custom logic to check the health of the application.</span></span> <span data-ttu-id="6550a-251">Der Endpunkt muss anonyme HTTP-Anforderungen zulassen.</span><span class="sxs-lookup"><span data-stu-id="6550a-251">The endpoint must allow anonymous HTTP requests.</span></span>
* <span data-ttu-id="6550a-252">Der Test wird von einer [bekannten][health-probe-ip] IP-Adresse (168.63.129.16) gesendet.</span><span class="sxs-lookup"><span data-stu-id="6550a-252">The probe is sent from a [known IP address][health-probe-ip], 168.63.129.16.</span></span> <span data-ttu-id="6550a-253">Blockieren Sie den an oder von diese(r) IP-Adresse gesendeten Datenverkehr nicht in Firewallrichtlinien oder NSG-Regeln.</span><span class="sxs-lookup"><span data-stu-id="6550a-253">Don't block traffic to or from this IP address in any firewall policies or NSG rules.</span></span>
* <span data-ttu-id="6550a-254">Verwenden Sie die [Protokolle der Integritätstests][health-probe-log], um den Status der Integritätstests anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="6550a-254">Use [health probe logs][health-probe-log] to view the status of the health probes.</span></span> <span data-ttu-id="6550a-255">Aktivieren Sie die Protokollierung für jeden Lastenausgleich im Azure-Portal.</span><span class="sxs-lookup"><span data-stu-id="6550a-255">Enable logging in the Azure portal for each load balancer.</span></span> <span data-ttu-id="6550a-256">Die Protokolle werden in Azure Blob Storage geschrieben.</span><span class="sxs-lookup"><span data-stu-id="6550a-256">Logs are written to Azure Blob storage.</span></span> <span data-ttu-id="6550a-257">Die Protokolle zeigen, wie viele VMs aufgrund von fehlerhaften Testantworten keinen Netzwerkdatenverkehr empfangen.</span><span class="sxs-lookup"><span data-stu-id="6550a-257">The logs show how many VMs aren't getting network traffic because of failed probe responses.</span></span>

<span data-ttu-id="6550a-258">Wenn Sie eine höhere Verfügbarkeit benötigen, als die [Azure-SLA für VMs][vm-sla] bietet, replizieren Sie ggf. die Anwendung über zwei Regionen, und verwenden Sie den Azure Traffic Manager für das Failover.</span><span class="sxs-lookup"><span data-stu-id="6550a-258">If you need higher availability than the [Azure SLA for VMs][vm-sla] provides, consider replication the application across two regions, using Azure Traffic Manager for failover.</span></span> <span data-ttu-id="6550a-259">Weitere Informationen finden Sie unter [Multi-region N-tier application for high availability][multi-dc] (N-schichtige Anwendung in mehreren Regionen für Hochverfügbarkeit).</span><span class="sxs-lookup"><span data-stu-id="6550a-259">For more information, see [Multi-region N-tier application for high availability][multi-dc].</span></span>  

## <a name="security-considerations"></a><span data-ttu-id="6550a-260">Sicherheitshinweise</span><span class="sxs-lookup"><span data-stu-id="6550a-260">Security considerations</span></span>

<span data-ttu-id="6550a-261">Virtuelle Netzwerke stellen in Azure eine Isolationsbegrenzung für Datenverkehr dar.</span><span class="sxs-lookup"><span data-stu-id="6550a-261">Virtual networks are a traffic isolation boundary in Azure.</span></span> <span data-ttu-id="6550a-262">VMs in einem VNET können nicht direkt mit VMs in einem anderen VNET kommunizieren.</span><span class="sxs-lookup"><span data-stu-id="6550a-262">VMs in one VNet can't communicate directly with VMs in a different VNet.</span></span> <span data-ttu-id="6550a-263">VMs im selben VNET können miteinander kommunizieren, sofern Sie den Datenverkehr nicht durch die Erstellung von [Netzwerksicherheitsgruppen][nsg] (NSGs) beschränken.</span><span class="sxs-lookup"><span data-stu-id="6550a-263">VMs within the same VNet can communicate, unless you create [network security groups][nsg] (NSGs) to restrict traffic.</span></span> <span data-ttu-id="6550a-264">Weitere Informationen finden Sie unter [Microsoft Cloud Services und Netzwerksicherheit][network-security].</span><span class="sxs-lookup"><span data-stu-id="6550a-264">For more information, see [Microsoft cloud services and network security][network-security].</span></span>

<span data-ttu-id="6550a-265">**DMZ**.</span><span class="sxs-lookup"><span data-stu-id="6550a-265">**DMZ**.</span></span> <span data-ttu-id="6550a-266">Für die Erstellung einer DMZ zwischen dem Internet und dem virtuellen Azure-Netzwerk sollten Sie eventuell eine virtuelle Netzwerkappliance (Network Virtual Appliance, NVA) hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="6550a-266">Consider adding a network virtual appliance (NVA) to create a DMZ between the Internet and the Azure virtual network.</span></span> <span data-ttu-id="6550a-267">NVA ist ein Oberbegriff für eine virtuelle Appliance, die netzwerkbezogene Aufgaben wie Erstellung von Firewalls, Paketüberprüfung, Überwachung und benutzerdefiniertes Routing ausführen kann.</span><span class="sxs-lookup"><span data-stu-id="6550a-267">NVA is a generic term for a virtual appliance that can perform network-related tasks, such as firewall, packet inspection, auditing, and custom routing.</span></span> <span data-ttu-id="6550a-268">Weitere Informationen finden Sie unter [Implementieren einer DMZ zwischen Azure und dem Internet][dmz].</span><span class="sxs-lookup"><span data-stu-id="6550a-268">For more information, see [Implementing a DMZ between Azure and the Internet][dmz].</span></span>

<span data-ttu-id="6550a-269">**Verschlüsselung**.</span><span class="sxs-lookup"><span data-stu-id="6550a-269">**Encryption**.</span></span> <span data-ttu-id="6550a-270">Verschlüsseln Sie sensible ruhende Daten, und verwalten Sie die Datenbankverschlüsselungsschlüssel mithilfe von [Azure Key Vault][azure-key-vault].</span><span class="sxs-lookup"><span data-stu-id="6550a-270">Encrypt sensitive data at rest and use [Azure Key Vault][azure-key-vault] to manage the database encryption keys.</span></span> <span data-ttu-id="6550a-271">Key Vault kann Verschlüsselungsschlüssel in Hardwaresicherheitsmodulen (HSMs) speichern.</span><span class="sxs-lookup"><span data-stu-id="6550a-271">Key Vault can store encryption keys in hardware security modules (HSMs).</span></span> <span data-ttu-id="6550a-272">Weitere Informationen finden Sie unter [Konfigurieren der Azure Key Vault-Integration für SQL Server auf virtuellen Azure-Computern (Resource Manager)][sql-keyvault].</span><span class="sxs-lookup"><span data-stu-id="6550a-272">For more information, see [Configure Azure Key Vault Integration for SQL Server on Azure VMs][sql-keyvault].</span></span> <span data-ttu-id="6550a-273">Es empfiehlt sich außerdem, Anwendungsgeheimnisse wie Datenbankverbindungszeichenfolgen in Key Vault zu speichern.</span><span class="sxs-lookup"><span data-stu-id="6550a-273">It's also recommended to store application secrets, such as database connection strings, in Key Vault.</span></span>

<span data-ttu-id="6550a-274">**DDoS Protection**.</span><span class="sxs-lookup"><span data-stu-id="6550a-274">**DDoS protection**.</span></span> <span data-ttu-id="6550a-275">Die Azure-Plattform stellt DDoS Protection Basic-Schutz standardmäßig bereit.</span><span class="sxs-lookup"><span data-stu-id="6550a-275">The Azure platform provides basic DDoS protection by default.</span></span> <span data-ttu-id="6550a-276">Dieser Basisschutz ist dafür ausgelegt, die Azure-Infrastruktur als Ganzes zu schützen.</span><span class="sxs-lookup"><span data-stu-id="6550a-276">This basic protection is targeted at protecting the Azure infrastructure as a whole.</span></span> <span data-ttu-id="6550a-277">Obwohl der DDoS Protection Basic-Schutz automatisch aktiviert ist, empfehlen wir die Verwendung von [DDoS Protection Standard][ddos].</span><span class="sxs-lookup"><span data-stu-id="6550a-277">Although basic DDoS protection is automatically enabled, we recommend using [DDoS Protection Standard][ddos].</span></span> <span data-ttu-id="6550a-278">DDoS Protection Standard wendet basierend auf den Mustern des Netzwerkdatenverkehrs Ihrer Anwendung eine adaptive Optimierung an, um Bedrohungen zu erkennen.</span><span class="sxs-lookup"><span data-stu-id="6550a-278">Standard protection uses adaptive tuning, based on your application's network traffic patterns, to detect threats.</span></span> <span data-ttu-id="6550a-279">Dadurch können DDoS-Angriffe entschärft werden, die von den infrastrukturweiten DDoS-Richtlinien möglicherweise nicht erkannt werden.</span><span class="sxs-lookup"><span data-stu-id="6550a-279">This allows it to apply mitigations against DDoS attacks that might go unnoticed by the infrastructure-wide DDoS policies.</span></span> <span data-ttu-id="6550a-280">DDoS Protection Standard stellt über Azure Monitor auch Warnungen, Telemetrie und Analysen bereit.</span><span class="sxs-lookup"><span data-stu-id="6550a-280">Standard protection also provides alerting, telemetry, and analytics through Azure Monitor.</span></span> <span data-ttu-id="6550a-281">Weitere Informationen finden Sie unter [Azure DDoS Protection – empfohlene Methoden und Referenzarchitekturen][ddos-best-practices].</span><span class="sxs-lookup"><span data-stu-id="6550a-281">For more information, see [Azure DDoS Protection: Best practices and reference architectures][ddos-best-practices].</span></span>

## <a name="deploy-the-solution"></a><span data-ttu-id="6550a-282">Bereitstellen der Lösung</span><span class="sxs-lookup"><span data-stu-id="6550a-282">Deploy the solution</span></span>

<span data-ttu-id="6550a-283">Eine Bereitstellung für diese Referenzarchitektur ist auf [GitHub][github-folder] verfügbar.</span><span class="sxs-lookup"><span data-stu-id="6550a-283">A deployment for this reference architecture is available on [GitHub][github-folder].</span></span> <span data-ttu-id="6550a-284">Die gesamte Bereitstellung, die die Ausführung der Skripts zum Konfigurieren von Active Directory Domain Services (AD DS), des Windows Server-Failoverclusters und der SQL Server-Verfügbarkeitsgruppe umfasst, kann bis zu zwei Stunden dauern.</span><span class="sxs-lookup"><span data-stu-id="6550a-284">The entire deployment can take up to two hours, which includes running the scripts to configure AD DS, the Windows Server failover cluster, and the SQL Server availability group.</span></span>

### <a name="prerequisites"></a><span data-ttu-id="6550a-285">Voraussetzungen</span><span class="sxs-lookup"><span data-stu-id="6550a-285">Prerequisites</span></span>

[!INCLUDE [ref-arch-prerequisites.md](../../../includes/ref-arch-prerequisites.md)]

### <a name="deploy-the-solution"></a><span data-ttu-id="6550a-286">Bereitstellen der Lösung</span><span class="sxs-lookup"><span data-stu-id="6550a-286">Deploy the solution</span></span>

1. <span data-ttu-id="6550a-287">Führen Sie den folgenden Befehl aus, um eine Ressourcengruppe zu erstellen:</span><span class="sxs-lookup"><span data-stu-id="6550a-287">Run the following command to create a resource group.</span></span>

    ```bash
    az group create --location <location> --name <resource-group-name>
    ```

2. <span data-ttu-id="6550a-288">Führen Sie den folgenden Befehl aus, um ein Speicherkonto für den Cloudzeugen zu erstellen:</span><span class="sxs-lookup"><span data-stu-id="6550a-288">Run the following command to create a Storage account for the Cloud Witness.</span></span>

    ```bash
    az storage account create --location <location> \
      --name <storage-account-name> \
      --resource-group <resource-group-name> \
      --sku Standard_LRS
    ```

3. <span data-ttu-id="6550a-289">Navigieren Sie zum Ordner `virtual-machines\n-tier-windows` des GitHub-Repositorys für Referenzarchitekturen.</span><span class="sxs-lookup"><span data-stu-id="6550a-289">Navigate to the `virtual-machines\n-tier-windows` folder of the reference architectures GitHub repository.</span></span>

4. <span data-ttu-id="6550a-290">Öffnen Sie die Datei `n-tier-windows.json` .</span><span class="sxs-lookup"><span data-stu-id="6550a-290">Open the `n-tier-windows.json` file.</span></span> 

5. <span data-ttu-id="6550a-291">Suchen Sie nach allen Instanzen von „witnessStorageBlobEndPoint“, und ersetzen Sie den Platzhaltertext durch den Namen des Speicherkontos aus Schritt 2.</span><span class="sxs-lookup"><span data-stu-id="6550a-291">Search for all instances of "witnessStorageBlobEndPoint" and replace the placeholder text with the name of the Storage account from step 2.</span></span>

    ```json
    "witnessStorageBlobEndPoint": "https://[replace-with-storageaccountname].blob.core.windows.net",
    ```

6. <span data-ttu-id="6550a-292">Führen Sie den folgenden Befehl aus, um die Kontoschlüssel für das Speicherkonto aufzulisten:</span><span class="sxs-lookup"><span data-stu-id="6550a-292">Run the following command to list the account keys for the storage account.</span></span>

    ```bash
    az storage account keys list \
      --account-name <storage-account-name> \
      --resource-group <resource-group-name>
    ```

    <span data-ttu-id="6550a-293">Die Ausgabe sollte wie im folgenden Beispiel aussehen.</span><span class="sxs-lookup"><span data-stu-id="6550a-293">The output should look like the following.</span></span> <span data-ttu-id="6550a-294">Kopieren Sie den Wert von `key1`.</span><span class="sxs-lookup"><span data-stu-id="6550a-294">Copy the value of `key1`.</span></span>

    ```json
    [
    {
        "keyName": "key1",
        "permissions": "Full",
        "value": "..."
    },
    {
        "keyName": "key2",
        "permissions": "Full",
        "value": "..."
    }
    ]
    ```

7. <span data-ttu-id="6550a-295">Suchen Sie in der Datei `n-tier-windows.json` nach allen Instanzen von „witnessStorageAccountKey“, und fügen Sie den Kontoschlüssel ein.</span><span class="sxs-lookup"><span data-stu-id="6550a-295">In the `n-tier-windows.json` file, search for all instances of "witnessStorageAccountKey" and paste in the account key.</span></span>

    ```json
    "witnessStorageAccountKey": "[replace-with-storagekey]"
    ```

8. <span data-ttu-id="6550a-296">Suchen Sie in der Datei `n-tier-windows.json` nach allen Vorkommen von `[replace-with-password]` und `[replace-with-sql-password]`, und ersetzen Sie sie durch ein sicheres Kennwort.</span><span class="sxs-lookup"><span data-stu-id="6550a-296">In the `n-tier-windows.json` file, search for all instances of `[replace-with-password]` and `[replace-with-sql-password]` replace them with a strong password.</span></span> <span data-ttu-id="6550a-297">Speichern Sie die Datei .</span><span class="sxs-lookup"><span data-stu-id="6550a-297">Save the file.</span></span>

    > [!NOTE]
    > <span data-ttu-id="6550a-298">Wenn Sie den Administratorbenutzernamen ändern, müssen Sie auch die `extensions`-Blöcke in der JSON-Datei aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="6550a-298">If you change the adminstrator user name, you must also update the `extensions` blocks in the JSON file.</span></span> 

9. <span data-ttu-id="6550a-299">Führen Sie den folgenden Befehl aus, um die Architektur bereitzustellen:</span><span class="sxs-lookup"><span data-stu-id="6550a-299">Run the following command to deploy the architecture.</span></span>

    ```bash
    azbb -s <your subscription_id> -g <resource_group_name> -l <location> -p n-tier-windows.json --deploy
    ```

<span data-ttu-id="6550a-300">Weitere Informationen zum Bereitstellen dieser Beispielreferenzarchitektur mithilfe von Azure-Bausteinen finden Sie im [GitHub-Repository][git].</span><span class="sxs-lookup"><span data-stu-id="6550a-300">For more information on deploying this sample reference architecture using Azure Building Blocks, visit the [GitHub repository][git].</span></span>


<!-- links -->
[dmz]: ../dmz/secure-vnet-dmz.md
[multi-dc]: multi-region-sql-server.md
[n-tier]: n-tier.md
[azure-availability-sets]: /azure/virtual-machines/virtual-machines-windows-manage-availability#configure-each-application-tier-into-separate-availability-sets
[azure-dns]: /azure/dns/dns-overview
[azure-key-vault]: https://azure.microsoft.com/services/key-vault
[geschützter Host]: https://en.wikipedia.org/wiki/Bastion_host
[bastion host]: https://en.wikipedia.org/wiki/Bastion_host
[CIDR]: https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing
[cidr]: https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing
[ddos]: /azure/virtual-network/ddos-protection-overview
[ddos-best-practices]: /azure/security/azure-ddos-best-practices
[git]: https://github.com/mspnp/template-building-blocks
[github-folder]: https://github.com/mspnp/reference-architectures/tree/master/virtual-machines/n-tier-windows
[nsg]: /azure/virtual-network/virtual-networks-nsg
[plan-network]: /azure/virtual-network/virtual-network-vnet-plan-design-arm
[private-ip-space]: https://en.wikipedia.org/wiki/Private_network#Private_IPv4_address_spaces
[öffentliche IP-Adresse]: /azure/virtual-network/virtual-network-ip-addresses-overview-arm
[public IP address]: /azure/virtual-network/virtual-network-ip-addresses-overview-arm
[sql-alwayson]: https://msdn.microsoft.com/library/hh510230.aspx
[sql-alwayson-force-failover]: https://msdn.microsoft.com/library/ff877957.aspx
[sql-alwayson-getting-started]: https://msdn.microsoft.com/library/gg509118.aspx
[sql-alwayson-ilb]: /azure/virtual-machines/windows/sql/virtual-machines-windows-portal-sql-alwayson-int-listener
[sql-alwayson-listeners]: https://msdn.microsoft.com/library/hh213417.aspx
[sql-alwayson-read-only-routing]: https://technet.microsoft.com/library/hh213417.aspx#ConnectToSecondary
[sql-keyvault]: /azure/virtual-machines/virtual-machines-windows-ps-sql-keyvault
[vm-sla]: https://azure.microsoft.com/support/legal/sla/virtual-machines
[vnet faq]: /azure/virtual-network/virtual-networks-faq
[wsfc-whats-new]: https://technet.microsoft.com/windows-server-docs/failover-clustering/whats-new-in-failover-clustering
[visio-download]: https://archcenter.blob.core.windows.net/cdn/vm-reference-architectures.vsdx
[0]: ./images/n-tier-sql-server.png "n-schichtige Architektur mit Microsoft Azure"
[resource-manager-overview]: /azure/azure-resource-manager/resource-group-overview 
[vmss]: /azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview
[load-balancer]: /azure/load-balancer/
[load-balancer-hashing]: /azure/load-balancer/load-balancer-overview#load-balancer-features
[vmss-design]: /azure/virtual-machine-scale-sets/virtual-machine-scale-sets-design-overview
[subscription-limits]: /azure/azure-subscription-service-limits
[availability-set]: /azure/virtual-machines/virtual-machines-windows-manage-availability
[health-probes]: /azure/load-balancer/load-balancer-overview#load-balancer-features
[health-probe-log]: /azure/load-balancer/load-balancer-monitor-log
[health-probe-ip]: /azure/virtual-network/virtual-networks-nsg#special-rules
[network-security]: /azure/best-practices-network-security
