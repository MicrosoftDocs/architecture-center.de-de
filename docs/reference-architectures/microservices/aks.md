---
title: Microservicearchitektur in Azure Kubernetes Service (AKS)
description: Bereitstellen einer Microservicearchitektur in Azure Kubernetes Service (AKS)
author: MikeWasson
ms.date: 12/10/2018
ms.topic: reference-architecture
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: microservices
ms.openlocfilehash: ac7ab8b8dd154999a05dc531e41b0994f66ddf10
ms.sourcegitcommit: 700a4f6ce61b1ebe68e227fc57443e49282e35aa
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 02/07/2019
ms.locfileid: "55887402"
---
# <a name="microservices-architecture-on-azure-kubernetes-service-aks"></a><span data-ttu-id="6b327-103">Microservicearchitektur in Azure Kubernetes Service (AKS)</span><span class="sxs-lookup"><span data-stu-id="6b327-103">Microservices architecture on Azure Kubernetes Service (AKS)</span></span>

<span data-ttu-id="6b327-104">In dieser Referenzarchitektur wird veranschaulicht, wie eine Microserviceanwendung für Azure Kubernetes Service (AKS) bereitgestellt wird.</span><span class="sxs-lookup"><span data-stu-id="6b327-104">This reference architectures shows a microservices application deployed to Azure Kubernetes Service (AKS).</span></span> <span data-ttu-id="6b327-105">Es wird eine einfache AKS-Konfiguration beschrieben, die als Ausgangspunkt für die meisten Bereitstellungen dienen kann.</span><span class="sxs-lookup"><span data-stu-id="6b327-105">It shows a basic AKS configuration that can be the starting point for most deployments.</span></span> <span data-ttu-id="6b327-106">Anspruchsvollere Optionen, z.B. erweiterte Netzwerkoptionen, werden in einer separaten Referenzarchitektur beschrieben.</span><span class="sxs-lookup"><span data-stu-id="6b327-106">More advanced options, including advanced networking options, will be covered in a separate reference architecture.</span></span>

<span data-ttu-id="6b327-107">In diesem Artikel werden Kubernetes-Grundkenntnisse vorausgesetzt.</span><span class="sxs-lookup"><span data-stu-id="6b327-107">This article assumes basic knowledge of Kubernetes.</span></span> <span data-ttu-id="6b327-108">Es geht hauptsächlich um die Infrastruktur- und DevOps-Aspekte bei der Ausführung einer Microservicearchitektur für AKS.</span><span class="sxs-lookup"><span data-stu-id="6b327-108">The article focuses mainly on the infrastructure and DevOps considerations of running a microservices architecture on AKS.</span></span> <span data-ttu-id="6b327-109">Eine Anleitung zum Entwerfen von Microservices aus Sicht eines domänengesteuerten Entwurfs (Domain-Driven Design, DDD) finden Sie unter [Entwerfen, Erstellen und Betreiben von Microservices in Azure](/azure/architecture/microservices).</span><span class="sxs-lookup"><span data-stu-id="6b327-109">For guidance on how to design microservices from a Domain Driven Design (DDD) perspective, see [Designing, building, and operating microservices on Azure](/azure/architecture/microservices).</span></span>

> [!NOTE]
> <span data-ttu-id="6b327-110">Wir arbeiten an einer Referenzimplementierung (RI) für diesen Artikel, die voraussichtlich Anfang 2019 veröffentlicht wird.</span><span class="sxs-lookup"><span data-stu-id="6b327-110">We are working on a reference implementation (RI) to accompany this article, which we expect to publish in early 2019.</span></span> <span data-ttu-id="6b327-111">Dieser Artikel wird dann aktualisiert, damit er die bewährten Methoden dieser Referenzimplementierung enthält.</span><span class="sxs-lookup"><span data-stu-id="6b327-111">This article will be updated to incorporate additional best practices from that RI.</span></span>

![AKS-Referenzarchitektur](./_images/aks.png)

## <a name="architecture"></a><span data-ttu-id="6b327-113">Architecture</span><span class="sxs-lookup"><span data-stu-id="6b327-113">Architecture</span></span>

<span data-ttu-id="6b327-114">Die Architektur umfasst die folgenden Komponenten.</span><span class="sxs-lookup"><span data-stu-id="6b327-114">The architecture consists of the following components.</span></span>

<span data-ttu-id="6b327-115">**Azure Kubernetes Service** (AKS):</span><span class="sxs-lookup"><span data-stu-id="6b327-115">**Azure Kubernetes Service** (AKS).</span></span> <span data-ttu-id="6b327-116">AKS ist ein Azure-Dienst, mit dem ein verwalteter Kubernetes-Cluster bereitgestellt wird.</span><span class="sxs-lookup"><span data-stu-id="6b327-116">AKS is an Azure service that deploys a managed Kubernetes cluster.</span></span> 

<span data-ttu-id="6b327-117">**Kubernetes-Cluster**:</span><span class="sxs-lookup"><span data-stu-id="6b327-117">**Kubernetes cluster**.</span></span> <span data-ttu-id="6b327-118">AKS ist für die Bereitstellung des Kubernetes-Clusters und die Verwaltung der Kubernetes-Masterkomponenten zuständig.</span><span class="sxs-lookup"><span data-stu-id="6b327-118">AKS is responsible for deploying the Kubernetes cluster and for managing the Kubernetes masters.</span></span> <span data-ttu-id="6b327-119">Sie verwalten nur die Agent-Knoten.</span><span class="sxs-lookup"><span data-stu-id="6b327-119">You only manage the agent nodes.</span></span>

<span data-ttu-id="6b327-120">**Virtuelles Netzwerk**.</span><span class="sxs-lookup"><span data-stu-id="6b327-120">**Virtual network**.</span></span> <span data-ttu-id="6b327-121">Standardmäßig erstellt AKS ein virtuelles Netzwerk, in dem die Agent-Knoten bereitgestellt werden können.</span><span class="sxs-lookup"><span data-stu-id="6b327-121">By default, AKS creates a virtual network to deploy the agent nodes into.</span></span> <span data-ttu-id="6b327-122">Bei anspruchsvolleren Szenarien können Sie zuerst das virtuelle Netzwerk erstellen, damit Sie Dinge wie die Konfiguration der Subnetze, lokale Konnektivität und IP-Adressierung steuern können.</span><span class="sxs-lookup"><span data-stu-id="6b327-122">For more advanced scenarios, you can create the virtual network first, which lets you control things like how the subnets are configured, on-premises connectivity, and IP addressing.</span></span> <span data-ttu-id="6b327-123">Weitere Informationen finden Sie unter [Konfigurieren von erweiterten Netzwerken in Azure Kubernetes Service (AKS)](/azure/aks/configure-advanced-networking).</span><span class="sxs-lookup"><span data-stu-id="6b327-123">For more information, see [Configure advanced networking in Azure Kubernetes Service (AKS)](/azure/aks/configure-advanced-networking).</span></span>

<span data-ttu-id="6b327-124">**Eingang**:</span><span class="sxs-lookup"><span data-stu-id="6b327-124">**Ingress**.</span></span> <span data-ttu-id="6b327-125">Mit einem Eingang werden HTTP(S)-Routen für Dienste im Cluster verfügbar gemacht.</span><span class="sxs-lookup"><span data-stu-id="6b327-125">An ingress exposes HTTP(S) routes to services inside the cluster.</span></span> <span data-ttu-id="6b327-126">Weitere Informationen finden Sie unten im Abschnitt [API-Gateway](#api-gateway).</span><span class="sxs-lookup"><span data-stu-id="6b327-126">For more information, see the section [API Gateway](#api-gateway) below.</span></span>

<span data-ttu-id="6b327-127">**Externe Datenspeicher**:</span><span class="sxs-lookup"><span data-stu-id="6b327-127">**External data stores**.</span></span> <span data-ttu-id="6b327-128">Microservices sind normalerweise zustandslos und schreiben den Status in externe Datenspeicher, z.B. Azure SQL-Datenbank oder Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="6b327-128">Microservices are typically stateless and write state to external data stores, such as Azure SQL Database or Cosmos DB.</span></span>

<span data-ttu-id="6b327-129">**Azure Active Directory:**</span><span class="sxs-lookup"><span data-stu-id="6b327-129">**Azure Active Directory**.</span></span> <span data-ttu-id="6b327-130">AKS nutzt eine Azure AD-Identität (Azure Active Directory), um andere Azure-Ressourcen, z.B. Azure Load Balancers, zu erstellen und zu verwalten.</span><span class="sxs-lookup"><span data-stu-id="6b327-130">AKS uses an Azure Active Directory (Azure AD) identity to create and manage other Azure resources such as Azure load balancers.</span></span> <span data-ttu-id="6b327-131">Azure AD wird auch für die Benutzerauthentifizierung in Clientanwendungen empfohlen.</span><span class="sxs-lookup"><span data-stu-id="6b327-131">Azure AD is also recommended for user authentication in client applications.</span></span>

<span data-ttu-id="6b327-132">**Azure Container Registry**:</span><span class="sxs-lookup"><span data-stu-id="6b327-132">**Azure Container Registry**.</span></span> <span data-ttu-id="6b327-133">Verwenden Sie Container Registry zum Speichern von privaten Docker-Images, die im Cluster bereitgestellt werden.</span><span class="sxs-lookup"><span data-stu-id="6b327-133">Use Container Registry to store private Docker images, which are deployed to the cluster.</span></span> <span data-ttu-id="6b327-134">AKS kann die Authentifizierung mit Container Registry durchführen, indem die eigene Azure AD-Identität verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="6b327-134">AKS can authenticate with Container Registry using its Azure AD identity.</span></span> <span data-ttu-id="6b327-135">Beachten Sie hierbei, dass Azure Container Registry für AKS nicht zwingend erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="6b327-135">Note that AKS does not require Azure Container Registry.</span></span> <span data-ttu-id="6b327-136">Sie können auch andere Containerregistrierungen nutzen, z.B. Docker-Hub.</span><span class="sxs-lookup"><span data-stu-id="6b327-136">You can use other container registries, such as Docker Hub.</span></span>

<span data-ttu-id="6b327-137">**Azure Pipelines**.</span><span class="sxs-lookup"><span data-stu-id="6b327-137">**Azure Pipelines**.</span></span> <span data-ttu-id="6b327-138">Pipelines ist Teil von Azure DevOps Services und führt automatisierte Build-, Test- und Bereitstellungsvorgänge durch.</span><span class="sxs-lookup"><span data-stu-id="6b327-138">Pipelines is part of Azure DevOps Services and runs automated builds, tests, and deployments.</span></span> <span data-ttu-id="6b327-139">Sie können auch CI/CD-Lösungen von Drittanbietern, z.B. Jenkins, verwenden.</span><span class="sxs-lookup"><span data-stu-id="6b327-139">You can also use third-party CI/CD solutions such as Jenkins.</span></span> 

<span data-ttu-id="6b327-140">**Helm**:</span><span class="sxs-lookup"><span data-stu-id="6b327-140">**Helm**.</span></span> <span data-ttu-id="6b327-141">Helm ist ein Paket-Manager für Kubernetes und ermöglicht das Bündeln von Kubernetes-Objekten als Einheit, die Sie veröffentlichen, bereitstellen, mit einer Versionsangabe versehen und aktualisieren können.</span><span class="sxs-lookup"><span data-stu-id="6b327-141">Helm is as a package manager for Kubernetes &mdash; a way to bundle Kubernetes objects into a single unit that you can publish, deploy, version, and update.</span></span>

<span data-ttu-id="6b327-142">**Azure Monitor**:</span><span class="sxs-lookup"><span data-stu-id="6b327-142">**Azure Monitor**.</span></span> <span data-ttu-id="6b327-143">Azure Monitor erfasst Metriken und Protokolle und speichert diese Elemente. Beispiele hierfür sind Plattformmetriken für die Azure-Dienste in der Lösung und Anwendungstelemetrie.</span><span class="sxs-lookup"><span data-stu-id="6b327-143">Azure Monitor collects and stores metrics and logs, including platform metrics for the Azure services in the solution and application telemetry.</span></span> <span data-ttu-id="6b327-144">Nutzen Sie diese Daten zum Überwachen der Anwendung, Einrichten von Warnungen und Dashboards und Durchführen von Analysen der Grundursache von Fehlern.</span><span class="sxs-lookup"><span data-stu-id="6b327-144">Use this data to monitor the application, set up alerts and dashboards, and perform root cause analysis of failures.</span></span> <span data-ttu-id="6b327-145">Azure Monitor wird mit AKS integriert, um Metriken von Controllern, Knoten und Containern sowie aus Containerprotokollen und Knotenprotokollen zu erfassen.</span><span class="sxs-lookup"><span data-stu-id="6b327-145">Azure Monitor integrates with AKS to collect metrics from controllers, nodes, and containers, as well as container logs and master node logs.</span></span>

## <a name="design-considerations"></a><span data-ttu-id="6b327-146">Überlegungen zum Entwurf</span><span class="sxs-lookup"><span data-stu-id="6b327-146">Design considerations</span></span>

<span data-ttu-id="6b327-147">In dieser Referenzarchitektur geht es zwar um Microservicearchitekturen, aber ein Großteil der empfohlenen Methoden gilt auch für andere Workloads, die unter AKS ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="6b327-147">This reference architecture is focused on microservices architectures, although many of the recommended practices will apply to other workloads running on AKS.</span></span>

### <a name="microservices"></a><span data-ttu-id="6b327-148">Microservices</span><span class="sxs-lookup"><span data-stu-id="6b327-148">Microservices</span></span>

<span data-ttu-id="6b327-149">Das Kubernetes Service-Objekt ist eine natürliche Möglichkeit zum Modellieren von Microservices in Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="6b327-149">The Kubernetes Service object is a natural way to model microservices in Kubernetes.</span></span> <span data-ttu-id="6b327-150">Ein Microservice ist eine lose gekoppelte, unabhängig bereitstellbare Codeeinheit.</span><span class="sxs-lookup"><span data-stu-id="6b327-150">A microservice is a loosely coupled, independently deployable unit of code.</span></span> <span data-ttu-id="6b327-151">Microservices kommunizieren normalerweise über gut definierte APIs und können per Dienstermittlung ermittelt werden.</span><span class="sxs-lookup"><span data-stu-id="6b327-151">Microservices typically communicate through well-defined APIs, and are discoverable through some form of service discovery.</span></span> <span data-ttu-id="6b327-152">Mit dem Kubernetes Service-Objekt werden Funktionen bereitgestellt, die die folgenden Anforderungen erfüllen:</span><span class="sxs-lookup"><span data-stu-id="6b327-152">The Kubernetes Service object provides a set of capabilities that match these requirements:</span></span>

- <span data-ttu-id="6b327-153">IP-Adresse.</span><span class="sxs-lookup"><span data-stu-id="6b327-153">IP address.</span></span> <span data-ttu-id="6b327-154">Das Kubernetes Service-Objekt umfasst eine statische interne IP-Adresse für eine Gruppe von Pods (ReplicaSet).</span><span class="sxs-lookup"><span data-stu-id="6b327-154">The Service object provides a static internal IP address for a group of pods (ReplicaSet).</span></span> <span data-ttu-id="6b327-155">Wenn Pods erstellt oder verschoben werden, ist der Dienst über diese interne IP-Adresse immer erreichbar.</span><span class="sxs-lookup"><span data-stu-id="6b327-155">As pods are created or moved around, the service is always reachable at this internal IP address.</span></span>

- <span data-ttu-id="6b327-156">Lastenausgleich.</span><span class="sxs-lookup"><span data-stu-id="6b327-156">Load balancing.</span></span> <span data-ttu-id="6b327-157">Für den Datenverkehr, der an die IP-Adresse des Diensts gesendet wird, wird ein Lastenausgleich auf die Pods durchgeführt.</span><span class="sxs-lookup"><span data-stu-id="6b327-157">Traffic sent to the service's IP address is load balanced to the pods.</span></span> 

- <span data-ttu-id="6b327-158">Dienstermittlung:</span><span class="sxs-lookup"><span data-stu-id="6b327-158">Service discovery.</span></span> <span data-ttu-id="6b327-159">Diensten werden vom Kubernetes-DNS-Dienst interne DNS-Einträge zugewiesen.</span><span class="sxs-lookup"><span data-stu-id="6b327-159">Services are assigned internal DNS entries by the Kubernetes DNS service.</span></span> <span data-ttu-id="6b327-160">Dies bedeutet, dass das API-Gateway mit dem DNS-Namen einen Back-End-Dienst aufrufen kann.</span><span class="sxs-lookup"><span data-stu-id="6b327-160">That means the API gateway can call a backend service using the DNS name.</span></span> <span data-ttu-id="6b327-161">Derselbe Mechanismus kann auch für die Kommunikation von Dienst zu Dienst verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="6b327-161">The same mechanism can be used for service-to-service communication.</span></span> <span data-ttu-id="6b327-162">Die DNS-Einträge sind nach Namespace organisiert. Wenn Ihre Namespaces also den Kontextgrenzen entsprechen, wird der DNS-Name für einen Dienst automatisch der Anwendungsdomäne zugeordnet.</span><span class="sxs-lookup"><span data-stu-id="6b327-162">The DNS entries are organized by namespace, so if your namespaces correspond to bounded contexts, then the DNS name for a service will map naturally to the application domain.</span></span>

<span data-ttu-id="6b327-163">Im folgenden Diagramm ist die konzeptionelle Beziehung zwischen Diensten und Pods dargestellt.</span><span class="sxs-lookup"><span data-stu-id="6b327-163">The following diagram show the conceptual relation between services and pods.</span></span> <span data-ttu-id="6b327-164">Die eigentliche Zuordnung zu Endpunkt-IP-Adressen und -ports wird mit kube-proxy, dem Kubernetes-Netzwerkproxy, durchgeführt.</span><span class="sxs-lookup"><span data-stu-id="6b327-164">The actual mapping to endpoint IP addresses and ports is done by kube-proxy, the Kubernetes network proxy.</span></span>

![Dienste und Pods](./_images/aks-services.png)

### <a name="api-gateway"></a><span data-ttu-id="6b327-166">API Gateway</span><span class="sxs-lookup"><span data-stu-id="6b327-166">API Gateway</span></span>

<span data-ttu-id="6b327-167">Ein *API-Gateway* ist ein Gateway, das zwischen externen Clients und den Microservices angeordnet ist.</span><span class="sxs-lookup"><span data-stu-id="6b327-167">An *API gateway* is a gateway that sits between external clients and the microservices.</span></span> <span data-ttu-id="6b327-168">Es fungiert als Reverseproxy und leitet Anforderungen von Clients an Microservices weiter.</span><span class="sxs-lookup"><span data-stu-id="6b327-168">It acts as a reverse proxy, routing requests from clients to microservices.</span></span> <span data-ttu-id="6b327-169">Darüber hinaus kann es verschiedene übergreifende Aufgaben wie Authentifizierung, SSL-Beendigung und Ratenbegrenzung übernehmen.</span><span class="sxs-lookup"><span data-stu-id="6b327-169">It may also perform various cross-cutting tasks such as authentication, SSL termination, and rate limiting.</span></span> 

<span data-ttu-id="6b327-170">Die von einem Gateway bereitgestellte Funktionalität kann wie folgt gruppiert werden:</span><span class="sxs-lookup"><span data-stu-id="6b327-170">Functionality provided by a gateway can be grouped as follows:</span></span>

- <span data-ttu-id="6b327-171">[Gatewayrouting](../../patterns/gateway-routing.md): Dient zum Weiterleiten von Clientanforderungen an die richtigen Back-End-Dienste.</span><span class="sxs-lookup"><span data-stu-id="6b327-171">[Gateway Routing](../../patterns/gateway-routing.md): Routing client requests to the right backend services.</span></span> <span data-ttu-id="6b327-172">Es stellt einen einzelnen Endpunkt für Clients bereit und trägt zur Entkopplung von Clients und Diensten bei.</span><span class="sxs-lookup"><span data-stu-id="6b327-172">This provides a single endpoint for clients, and helps to decouple clients from services.</span></span>

- <span data-ttu-id="6b327-173">[Gatewayaggregation](../../patterns/gateway-aggregation.md): Dient zum Aggregieren mehrerer Anforderungen in einer einzelnen Anforderung, um umfangreiche Interaktionen („Chattiness“) zwischen dem Client und dem Back-End zu verringern.</span><span class="sxs-lookup"><span data-stu-id="6b327-173">[Gateway Aggregation](../../patterns/gateway-aggregation.md): Aggregation of multiple requests into a single request, to reduce chattiness between the client and the backend.</span></span>

- <span data-ttu-id="6b327-174">[Gatewayabladung:](../../patterns/gateway-offloading.md)</span><span class="sxs-lookup"><span data-stu-id="6b327-174">[Gateway Offloading](../../patterns/gateway-offloading.md).</span></span> <span data-ttu-id="6b327-175">Ein Gateway kann Funktionalität für die Back-End-Dienste abladen, z.B. SSL-Beendigung, Authentifizierung, IP-Whitelisting oder Clientratenbegrenzung (Drosselung).</span><span class="sxs-lookup"><span data-stu-id="6b327-175">A gateway can offload functionality from the backend services, such as SSL termination, authentication, IP whitelisting, or client rate limiting (throttling).</span></span>

<span data-ttu-id="6b327-176">API-Gateways sind ein allgemeines [Microserviceentwurfsmuster](https://microservices.io/patterns/apigateway.html).</span><span class="sxs-lookup"><span data-stu-id="6b327-176">API gateways are a general [microservices design pattern](https://microservices.io/patterns/apigateway.html).</span></span> <span data-ttu-id="6b327-177">Sie können mit unterschiedlichen Technologien implementiert werden.</span><span class="sxs-lookup"><span data-stu-id="6b327-177">They can be implemented using a number of different technologies.</span></span> <span data-ttu-id="6b327-178">Die häufigste Implementierung ist wahrscheinlich die Bereitstellung eines Edgerouters oder Reverseproxys, z.B. Nginx, HAProxy oder Traefik, im Cluster.</span><span class="sxs-lookup"><span data-stu-id="6b327-178">Probably the most common implementation is to deploy an edge router or reverse proxy, such as Nginx, HAProxy, or Traefik, inside the cluster.</span></span> 

<span data-ttu-id="6b327-179">Andere Optionen sind:</span><span class="sxs-lookup"><span data-stu-id="6b327-179">Other options include:</span></span>

- <span data-ttu-id="6b327-180">Azure Application Gateway bzw. Azure API Management, wobei es sich jeweils um verwaltete Dienste handelt, die sich außerhalb des Clusters befinden.</span><span class="sxs-lookup"><span data-stu-id="6b327-180">Azure Application Gateway and/or Azure API-Management, which are both managed services that reside outside of the cluster.</span></span> <span data-ttu-id="6b327-181">Ein Application Gateway-Eingangscontroller befindet sich derzeit in der Betaphase.</span><span class="sxs-lookup"><span data-stu-id="6b327-181">An Application Gateway Ingress Controller is currently in beta.</span></span>

- <span data-ttu-id="6b327-182">Azure-Funktionsproxys:</span><span class="sxs-lookup"><span data-stu-id="6b327-182">Azure Functions Proxies.</span></span> <span data-ttu-id="6b327-183">Mit Proxys können Anforderungen und Antworten geändert und Anforderungen basierend auf der URL weitergeleitet werden.</span><span class="sxs-lookup"><span data-stu-id="6b327-183">Proxies can modify requests and responses and route requests based on URL.</span></span>

<span data-ttu-id="6b327-184">Mit dem Kubernetes-Ressourcentyp **Eingang** werden die Konfigurationseinstellungen für einen Proxyserver abstrahiert.</span><span class="sxs-lookup"><span data-stu-id="6b327-184">The Kubernetes **Ingress** resource type abstracts the configuration settings for a proxy server.</span></span> <span data-ttu-id="6b327-185">Dies funktioniert in Verbindung mit einem Eingangscontroller, der die zugrunde liegende Implementierung des Eingangs bereitstellt.</span><span class="sxs-lookup"><span data-stu-id="6b327-185">It works in conjunction with an ingress controller, which provides the underlying implementation of the Ingress.</span></span> <span data-ttu-id="6b327-186">Es gibt Eingangscontroller für Nginx, HAProxy, Traefik und Application Gateway (Vorschauversion) usw.</span><span class="sxs-lookup"><span data-stu-id="6b327-186">There are ingress controllers for Nginx, HAProxy, Traefik, and Application Gateway (preview), among others.</span></span>

<span data-ttu-id="6b327-187">Der Eingangscontroller führt die Konfiguration des Proxyservers durch.</span><span class="sxs-lookup"><span data-stu-id="6b327-187">The ingress controller handles configuring the proxy server.</span></span> <span data-ttu-id="6b327-188">Häufig sind hierfür komplexe Konfigurationsdateien erforderlich, deren Optimierung schwierig sein kann, wenn Sie kein Experte sind. Der Eingangscontroller stellt also eine willkommene Abstraktion dar.</span><span class="sxs-lookup"><span data-stu-id="6b327-188">Often these require complex configuration files, which can be hard to tune if you aren't an expert, so the ingress controller is a nice abstraction.</span></span> <span data-ttu-id="6b327-189">Außerdem hat der Eingangscontroller Zugriff auf die Kubernetes-API, damit er intelligente Entscheidungen zum Routing und Lastenausgleich treffen kann.</span><span class="sxs-lookup"><span data-stu-id="6b327-189">In addition, the Ingress Controller has access to the Kubernetes API, so it can make intelligent decisions about routing and load balancing.</span></span> <span data-ttu-id="6b327-190">Mit dem Nginx-Eingangscontroller wird beispielsweise der Netzwerkproxy „kube-proxy“ umgangen.</span><span class="sxs-lookup"><span data-stu-id="6b327-190">For example, the Nginx ingress controller bypasses the kube-proxy network proxy.</span></span>

<span data-ttu-id="6b327-191">Falls Sie dagegen die vollständige Kontrolle über die Einstellungen haben müssen, können Sie diese Abstraktion auch umgehen und den Proxyserver manuell konfigurieren.</span><span class="sxs-lookup"><span data-stu-id="6b327-191">On the other hand, if you need complete control over the settings, you may want to bypass this abstraction and configure the proxy server manually.</span></span> 

<span data-ttu-id="6b327-192">Ein Reverseproxyserver ist ein potenzieller Engpass oder Single Point of Failure. Stellen Sie daher immer mindestens zwei Replikate bereit, um eine hohe Verfügbarkeit zu gewährleisten.</span><span class="sxs-lookup"><span data-stu-id="6b327-192">A reverse proxy server is a potential bottleneck or single point of failure, so always deploy at least two replicas for high availability.</span></span>

### <a name="data-storage"></a><span data-ttu-id="6b327-193">Datenspeicher</span><span class="sxs-lookup"><span data-stu-id="6b327-193">Data storage</span></span>

<span data-ttu-id="6b327-194">In einer Microservicearchitektur sollten Datenspeicher nicht für Dienste gemeinsam genutzt werden.</span><span class="sxs-lookup"><span data-stu-id="6b327-194">In a microservices architecture, services should not share data storage.</span></span> <span data-ttu-id="6b327-195">Für jeden Dienst sollten die eigenen privaten Daten in einem separaten logischen Speicher enthalten sein, um versteckte Abhängigkeiten zwischen Diensten zu vermeiden.</span><span class="sxs-lookup"><span data-stu-id="6b327-195">Each service should own its own private data in a separate logical storage, to avoid hidden dependencies among services.</span></span> <span data-ttu-id="6b327-196">Der Grund ist die Vermeidung einer unbeabsichtigten Kopplung von Diensten, die entstehen kann, wenn Dienste die gleichen zugrunde liegenden Datenschemas nutzen.</span><span class="sxs-lookup"><span data-stu-id="6b327-196">The reason is to avoid unintentional coupling between services, which can happen when services share the same underlying data schemas.</span></span> <span data-ttu-id="6b327-197">Wenn Dienste ihre eigenen Datenspeicher nutzen, können Sie zudem jeweils den richtigen Datenspeicher für ihre speziellen Anforderungen verwenden.</span><span class="sxs-lookup"><span data-stu-id="6b327-197">Also, when services manage their own data stores, they can use the right data store for their particular requirements.</span></span> <span data-ttu-id="6b327-198">Weitere Informationen finden Sie unter [Entwerfen von Microservices: Überlegungen zu Daten](/azure/architecture/microservices/data-considerations).</span><span class="sxs-lookup"><span data-stu-id="6b327-198">For more information, see [Designing microservices: Data considerations](/azure/architecture/microservices/data-considerations).</span></span>

<span data-ttu-id="6b327-199">Vermeiden Sie das Speichern von persistenten Daten in einem lokalen Clusterspeicher, weil die Daten dann an den Knoten gebunden sind.</span><span class="sxs-lookup"><span data-stu-id="6b327-199">Avoid storing persistent data in local cluster storage, because that ties the data to the node.</span></span> <span data-ttu-id="6b327-200">Alternative:</span><span class="sxs-lookup"><span data-stu-id="6b327-200">Instead,</span></span> 

- <span data-ttu-id="6b327-201">Verwenden Sie einen externen Dienst, z.B. Azure SQL-Datenbank oder Cosmos DB. *ODER*</span><span class="sxs-lookup"><span data-stu-id="6b327-201">Use an external service such as Azure SQL Database or Cosmos DB, *or*</span></span>

- <span data-ttu-id="6b327-202">Stellen Sie mit Azure Disks oder Azure Files ein persistentes Volume bereit.</span><span class="sxs-lookup"><span data-stu-id="6b327-202">Mount a persistent volume using Azure Disks or Azure Files.</span></span> <span data-ttu-id="6b327-203">Nutzen Sie Azure Files, wenn dasselbe Volume gemeinsam von mehreren Pods genutzt werden soll.</span><span class="sxs-lookup"><span data-stu-id="6b327-203">Use Azure Files if the same volume needs to be shared by multiple pods.</span></span>

### <a name="namespaces"></a><span data-ttu-id="6b327-204">Namespaces</span><span class="sxs-lookup"><span data-stu-id="6b327-204">Namespaces</span></span>

<span data-ttu-id="6b327-205">Verwenden Sie Namespaces, um Dienste im Cluster zu organisieren.</span><span class="sxs-lookup"><span data-stu-id="6b327-205">Use namespaces to organize services within the cluster.</span></span> <span data-ttu-id="6b327-206">Jedes Objekt in einem Kubernetes-Cluster gehört zu einem Namespace.</span><span class="sxs-lookup"><span data-stu-id="6b327-206">Every object in a Kubernetes cluster belongs to a namespace.</span></span> <span data-ttu-id="6b327-207">Wenn Sie ein neues Objekt erstellen, geht es standardmäßig in den Namespace `default` ein.</span><span class="sxs-lookup"><span data-stu-id="6b327-207">By default, when you create a new object, it goes into the `default` namespace.</span></span> <span data-ttu-id="6b327-208">Es ist aber eine gute Vorgehensweise, aussagekräftigere Namespaces zu erstellen, damit die Ressourcen im Cluster besser organisiert werden können.</span><span class="sxs-lookup"><span data-stu-id="6b327-208">But it's a good practice to create namespaces that are more descriptive to help organize the resources in the cluster.</span></span>

<span data-ttu-id="6b327-209">Zunächst einmal tragen Namespaces zur Verhinderung von Namenskonflikten bei.</span><span class="sxs-lookup"><span data-stu-id="6b327-209">First, namespaces help prevent naming collisions.</span></span> <span data-ttu-id="6b327-210">Wenn mehrere Teams Microservices in demselben Cluster bereitstellen und ggf. Hunderte von Microservices vorhanden sind, wird die Verwaltung schwierig, falls alle in demselben Namespace enthalten sind.</span><span class="sxs-lookup"><span data-stu-id="6b327-210">When multiple teams deploy microservices into the same cluster, with possibly hundreds of microservices, it gets hard to manage if they all go into the same namespace.</span></span> <span data-ttu-id="6b327-211">Darüber hinaus haben Sie mit Namespaces folgende Möglichkeiten:</span><span class="sxs-lookup"><span data-stu-id="6b327-211">In addition, namespaces allow you to:</span></span>

- <span data-ttu-id="6b327-212">Wenden Sie Ressourceneinschränkungen auf einen Namespace an, damit die Gesamtzahl der Pods, die diesem Namespace zugewiesen sind, das Ressourcenkontingent des Namespace nicht überschreiten kann.</span><span class="sxs-lookup"><span data-stu-id="6b327-212">Apply resource constraints to a namespace, so that the total set of pods assigned to that namespace cannot exceed the resource quota of the namespace.</span></span>

- <span data-ttu-id="6b327-213">Wenden Sie Richtlinien auf Namespaceebene an, z.B. rollenbasierte Zugriffssteuerung und Sicherheitsrichtlinien.</span><span class="sxs-lookup"><span data-stu-id="6b327-213">Apply policies at the namespace level, including RBAC and security policies.</span></span>

<span data-ttu-id="6b327-214">Für eine Microservicearchitektur kann erwägt werden, die Microservices anhand von Kontextgrenzen zu organisieren und für jede Kontextgrenze Namespaces zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="6b327-214">For a microservices architecture, considering organizing the microservices into bounded contexts, and creating namespaces for each bounded context.</span></span> <span data-ttu-id="6b327-215">Beispielsweise können alle Microservices, die sich auf die Kontextgrenze „Auftragserfüllung“ beziehen, in demselben Namespace angeordnet werden.</span><span class="sxs-lookup"><span data-stu-id="6b327-215">For example, all microservices related to the "Order Fulfillment" bounded context could go into the same namespace.</span></span> <span data-ttu-id="6b327-216">Alternativ hierzu können Sie auch einen Namespace für jedes Entwicklungsteam erstellen.</span><span class="sxs-lookup"><span data-stu-id="6b327-216">Alternatively, create a namespace for each development team.</span></span>

<span data-ttu-id="6b327-217">Ordnen Sie Hilfsdienste in einem separaten Namespace an.</span><span class="sxs-lookup"><span data-stu-id="6b327-217">Place utility services into their own separate namespace.</span></span> <span data-ttu-id="6b327-218">Beispielsweise können Sie Elasticsearch oder Prometheus für die Clusterüberwachung oder auch Tiller für Helm bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="6b327-218">For example, you might deploy Elasticsearch or Prometheus for cluster monitoring, or Tiller for Helm.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="6b327-219">Überlegungen zur Skalierbarkeit</span><span class="sxs-lookup"><span data-stu-id="6b327-219">Scalability considerations</span></span>

<span data-ttu-id="6b327-220">Für Kubernetes wird die horizontale Skalierung auf zwei Ebenen unterstützt:</span><span class="sxs-lookup"><span data-stu-id="6b327-220">Kubernetes supports scale-out at two levels:</span></span>

- <span data-ttu-id="6b327-221">Skalieren Sie die Anzahl von Pods, die einer Bereitstellung zugeordnet sind.</span><span class="sxs-lookup"><span data-stu-id="6b327-221">Scale the number of pods allocated to a deployment.</span></span>
- <span data-ttu-id="6b327-222">Skalieren Sie die Knoten im Cluster, um die gesamten Computeressourcen zu erhöhen, die für den Cluster verfügbar sind.</span><span class="sxs-lookup"><span data-stu-id="6b327-222">Scale the nodes in the cluster, to increase the total compute resources available to the cluster.</span></span>

<span data-ttu-id="6b327-223">Sie können Pods und Knoten zwar manuell horizontal hochskalieren, aber wir empfehlen Ihnen die Verwendung der automatischen Skalierung. So kann die Wahrscheinlichkeit verringert werden, dass es für Dienste bei hoher Belastung zu einem Ressourcenmangel kommt.</span><span class="sxs-lookup"><span data-stu-id="6b327-223">Although you can scale out pods and nodes manually, we recommend using autoscaling, to minimize the chance that services will become resource starved under high load.</span></span> <span data-ttu-id="6b327-224">Bei einer Strategie für die automatische Skalierung müssen sowohl Pods als auch Knoten berücksichtigt werden.</span><span class="sxs-lookup"><span data-stu-id="6b327-224">An autoscaling strategy must take both pods and nodes into account.</span></span> <span data-ttu-id="6b327-225">Wenn Sie nur die Pods horizontal hochskalieren, erreichen Sie schließlich die Ressourcengrenzwerte der Knoten.</span><span class="sxs-lookup"><span data-stu-id="6b327-225">If you just scale out the pods, eventually you will reach the resource limits of the nodes.</span></span> 

### <a name="pod-autoscaling"></a><span data-ttu-id="6b327-226">Automatische Skalierung von Pods</span><span class="sxs-lookup"><span data-stu-id="6b327-226">Pod autoscaling</span></span>

<span data-ttu-id="6b327-227">Bei der „horizontalen automatischen Podskalierung“ (Horizontal Pod Autoscaler, HPA) werden Pods basierend auf beobachteten CPU-, Arbeitsspeicher- oder benutzerdefinierten Metriken skaliert.</span><span class="sxs-lookup"><span data-stu-id="6b327-227">The Horizontal Pod Autoscaler (HPA) scales pods based on observed CPU, memory, or custom metrics.</span></span> <span data-ttu-id="6b327-228">Zum Konfigurieren der horizontalen Skalierung von Pods geben Sie eine Zielmetrik (z.B. 70% der CPU) und die minimale und maximale Anzahl von Replikaten an.</span><span class="sxs-lookup"><span data-stu-id="6b327-228">To configure horizontal pod scaling, you specify a target metric (for example, 70% of CPU), and the minimum and maximum number of replicas.</span></span> <span data-ttu-id="6b327-229">Sie sollten für Ihre Dienste einen Auslastungstest durchführen, um diese Zahlen abzuleiten.</span><span class="sxs-lookup"><span data-stu-id="6b327-229">You should load test your services to derive these numbers.</span></span>

<span data-ttu-id="6b327-230">Ein Nebeneffekt der automatischen Skalierung ist, dass Pods häufiger erstellt oder ausgeschlossen werden können, wenn Ereignisse mit horizontalem Hoch- und Herunterskalieren eintreten.</span><span class="sxs-lookup"><span data-stu-id="6b327-230">A side-effect of autoscaling is that pods may be created or evicted more frequently, as scale-out and scale-in events happen.</span></span> <span data-ttu-id="6b327-231">Gehen Sie wie folgt vor, um die Auswirkungen zu entschärfen:</span><span class="sxs-lookup"><span data-stu-id="6b327-231">To mitigate the effects of this:</span></span>

- <span data-ttu-id="6b327-232">Verwenden Sie Bereitschaftstests, um Kubernetes mitzuteilen, wann ein neuer Pod Datenverkehr akzeptieren kann.</span><span class="sxs-lookup"><span data-stu-id="6b327-232">Use readiness probes to let Kubernetes know when a new pod is ready to accept traffic.</span></span>
- <span data-ttu-id="6b327-233">Nutzen Sie Budgets für die Unterbrechung von Pods, um einzuschränken, wie viele Pods gleichzeitig aus einem Dienst ausgeschlossen werden können.</span><span class="sxs-lookup"><span data-stu-id="6b327-233">Use pod disruption budgets to limit how many pods can be evicted from a service at a time.</span></span>

### <a name="cluster-autoscaling"></a><span data-ttu-id="6b327-234">Automatische Skalierung von Clustern</span><span class="sxs-lookup"><span data-stu-id="6b327-234">Cluster autoscaling</span></span>

<span data-ttu-id="6b327-235">Mit der automatischen Skalierung von Clustern wird die Anzahl von Knoten skaliert.</span><span class="sxs-lookup"><span data-stu-id="6b327-235">The cluster autoscaler scales the number of nodes.</span></span> <span data-ttu-id="6b327-236">Falls Pods aufgrund von Ressourceneinschränkungen nicht geplant werden können, stellt die automatische Skalierung des Clusters mehr Knoten bereit.</span><span class="sxs-lookup"><span data-stu-id="6b327-236">If pods can't be scheduled because of resource constraints, the cluster autoscaler will provision more nodes.</span></span>  <span data-ttu-id="6b327-237">(Hinweis: Die Integration zwischen AKS und der automatischen Skalierung des Clusters befindet sich derzeit in der Vorschauphase.)</span><span class="sxs-lookup"><span data-stu-id="6b327-237">(Note: Integration between AKS and the cluster autoscaler is currently in preview.)</span></span>

<span data-ttu-id="6b327-238">Während bei HPA auf die tatsächlich genutzten Ressourcen oder andere Metriken ausgeführter Pods geachtet wird, werden bei der automatischen Skalierung des Clusters Knoten für Pods bereitgestellt, die noch nicht geplant sind.</span><span class="sxs-lookup"><span data-stu-id="6b327-238">Whereas HPA looks at actual resources consumed or other metrics from running pods, the cluster autoscaler is provisioning nodes for pods that aren't scheduled yet.</span></span> <span data-ttu-id="6b327-239">Aus diesem Grund werden die angeforderten Ressourcen untersucht, die in der Kubernetes-Podspezifikation für eine Bereitstellung angegeben sind.</span><span class="sxs-lookup"><span data-stu-id="6b327-239">Therefore, it looks at the requested resources, as specified in the Kubernetes pod spec for a deployment.</span></span> <span data-ttu-id="6b327-240">Verwenden Sie Auslastungstests, um diese Werte zu optimieren.</span><span class="sxs-lookup"><span data-stu-id="6b327-240">Use load testing to fine-tune these values.</span></span>

<span data-ttu-id="6b327-241">Da Sie die VM-Größe nach dem Erstellen des Clusters nicht mehr ändern können, sollten Sie zunächst eine Kapazitätsplanung durchführen. Hierbei können Sie eine geeignete VM-Größe für die Agent-Knoten wählen, die beim Erstellen des Clusters verwendet werden soll.</span><span class="sxs-lookup"><span data-stu-id="6b327-241">You can't change the VM size after you create the cluster, so you should do some initial capacity planning to choose an appropriate VM size for the agent nodes when you create the cluster.</span></span> 

## <a name="availability-considerations"></a><span data-ttu-id="6b327-242">Überlegungen zur Verfügbarkeit</span><span class="sxs-lookup"><span data-stu-id="6b327-242">Availability considerations</span></span>

### <a name="health-probes"></a><span data-ttu-id="6b327-243">Integritätstests</span><span class="sxs-lookup"><span data-stu-id="6b327-243">Health probes</span></span>

<span data-ttu-id="6b327-244">Mit Kubernetes werden zwei Arten von Integritätstest definiert, die von einem Pod verfügbar gemacht werden können:</span><span class="sxs-lookup"><span data-stu-id="6b327-244">Kubernetes defines two types of health probe that a pod can expose:</span></span>

- <span data-ttu-id="6b327-245">Bereitschaftstest: Teilt Kubernetes mit, ob der Pod für das Akzeptieren von Anforderungen bereit ist.</span><span class="sxs-lookup"><span data-stu-id="6b327-245">Readiness probe: Tells Kubernetes whether the pod is ready to accept requests.</span></span>

- <span data-ttu-id="6b327-246">Livetest: Teilt Kubernetes mit, ob ein Pod entfernt und eine neue Instanz gestartet werden soll.</span><span class="sxs-lookup"><span data-stu-id="6b327-246">Liveness probe: Tells Kubernetes whether a pod should be removed and a new instance started.</span></span>

<span data-ttu-id="6b327-247">Im Hinblick auf Tests ist es hilfreich, sich daran zu erinnern, wie ein Dienst in Kubernetes funktioniert.</span><span class="sxs-lookup"><span data-stu-id="6b327-247">When thinking about probes, it's useful to recall how a service works in Kubernetes.</span></span> <span data-ttu-id="6b327-248">Ein Dienst verfügt über eine Bezeichnungsauswahl, mit der eine Gruppe von (null oder mehr) Pods abgeglichen werden kann.</span><span class="sxs-lookup"><span data-stu-id="6b327-248">A service has a label selector that matches a set of (zero or more) pods.</span></span> <span data-ttu-id="6b327-249">Kubernetes führt für den Datenverkehr einen Lastenausgleich auf die Pods durch, die die Auswahlkriterien erfüllen.</span><span class="sxs-lookup"><span data-stu-id="6b327-249">Kubernetes load balances traffic to the pods that match the selector.</span></span> <span data-ttu-id="6b327-250">Nur Pods, die erfolgreich gestartet wurden und fehlerfrei sind, erhalten Datenverkehr.</span><span class="sxs-lookup"><span data-stu-id="6b327-250">Only pods that started successfully and are healthy receive traffic.</span></span> <span data-ttu-id="6b327-251">Falls ein Container abstürzt, nimmt Kubernetes den Pod außer Betrieb und plant einen Ersatz.</span><span class="sxs-lookup"><span data-stu-id="6b327-251">If a container crashes, Kubernetes kills the pod and schedules a replacement.</span></span>

<span data-ttu-id="6b327-252">Es kann vorkommen, dass ein Pod noch nicht für den Empfang von Datenverkehr bereit ist, obwohl er erfolgreich gestartet wurde.</span><span class="sxs-lookup"><span data-stu-id="6b327-252">Sometimes, a pod may not be ready to receive traffic, even though the pod started successfully.</span></span> <span data-ttu-id="6b327-253">Beispielsweise werden Initialisierungsaufgaben durchgeführt, bei denen die im Container ausgeführte Anwendung Dinge in den Arbeitsspeicher lädt oder Konfigurationsdaten liest.</span><span class="sxs-lookup"><span data-stu-id="6b327-253">For example, there may be initialization tasks, where the application running in the container loads things into memory or reads configuration data.</span></span> <span data-ttu-id="6b327-254">Definieren Sie einen Bereitschaftstest, um anzugeben, dass ein Pod fehlerfrei, aber noch nicht für den Empfang von Datenverkehr bereit ist.</span><span class="sxs-lookup"><span data-stu-id="6b327-254">To indicate that a pod is healthy but not ready to receive traffic, define a readiness probe.</span></span> 

<span data-ttu-id="6b327-255">Livetests werden verwendet, wenn ein Pod noch ausgeführt wird, aber fehlerhaft ist und recycelt werden sollte.</span><span class="sxs-lookup"><span data-stu-id="6b327-255">Liveness probes handle the case where a pod is still running, but is unhealthy and should be recycled.</span></span> <span data-ttu-id="6b327-256">Angenommen, ein Container stellt HTTP-Anforderungen bereit, hängt aber aus irgendeinem Grund.</span><span class="sxs-lookup"><span data-stu-id="6b327-256">For example, suppose that a container is serving HTTP requests but hangs for some reason.</span></span> <span data-ttu-id="6b327-257">Der Container stürzt nicht ab, stellt aber keine Anforderungen mehr bereit.</span><span class="sxs-lookup"><span data-stu-id="6b327-257">The container doesn't crash, but it has stopped serving any requests.</span></span> <span data-ttu-id="6b327-258">Wenn Sie einen HTTP-Livetest definieren, antwortet der Test nicht mehr, und Kubernetes erhält die Information, dass der Pod neu gestartet werden muss.</span><span class="sxs-lookup"><span data-stu-id="6b327-258">If you define an HTTP liveness probe, the probe will stop responding and that informs Kubernetes to restart the pod.</span></span>

<span data-ttu-id="6b327-259">Hier sind einige Aspekte angegeben, die beim Entwerfen von Tests berücksichtigt werden sollten:</span><span class="sxs-lookup"><span data-stu-id="6b327-259">Here are some considerations when designing probes:</span></span>

- <span data-ttu-id="6b327-260">Falls Ihr Code über eine lange Startdauer verfügt, besteht die Gefahr, dass bei einem Livetest ein Fehler gemeldet wird, bevor der Startvorgang abgeschlossen ist.</span><span class="sxs-lookup"><span data-stu-id="6b327-260">If your code has a long startup time, there is a danger that a liveness probe will report failure before the startup completes.</span></span> <span data-ttu-id="6b327-261">Verwenden Sie die Einstellung „initialDelaySeconds“, mit der der Start des Tests verzögert wird, um dies zu verhindern.</span><span class="sxs-lookup"><span data-stu-id="6b327-261">To prevent this, use the initialDelaySeconds setting, which delays the probe from starting.</span></span>

- <span data-ttu-id="6b327-262">Ein Livetest stellt nur dann eine Hilfe dar, wenn ein Neustart des Pods wahrscheinlich ist, um den fehlerfreien Zustand wiederherzustellen.</span><span class="sxs-lookup"><span data-stu-id="6b327-262">A liveness probe doesn't help unless restarting the pod is likely to restore it to a healthy state.</span></span> <span data-ttu-id="6b327-263">Sie können einen Livetest als Maßnahme gegen Speicherverluste oder unerwartete Deadlocks verwenden, aber es hat keinen Zweck, einen Pod neu zu starten, für den sofort wieder ein Fehler auftritt.</span><span class="sxs-lookup"><span data-stu-id="6b327-263">You can use a liveness probe to mitigate against memory leaks or unexpected deadlocks, but there's no point in restarting a pod that's going to immediately fail again.</span></span>

- <span data-ttu-id="6b327-264">In einigen Fällen werden Bereitschaftstests genutzt, um abhängige Dienste zu überprüfen.</span><span class="sxs-lookup"><span data-stu-id="6b327-264">Sometimes readiness probes are used to check dependent services.</span></span> <span data-ttu-id="6b327-265">Wenn für einen Pod beispielsweise eine Abhängigkeit von einer Datenbank besteht, kann mit dem Livetest ggf. die Datenbankverbindung überprüft werden.</span><span class="sxs-lookup"><span data-stu-id="6b327-265">For example, if a pod has a dependency on a database, the liveness probe might check the database connection.</span></span> <span data-ttu-id="6b327-266">Dieser Ansatz kann aber zu unerwarteten Problemen führen.</span><span class="sxs-lookup"><span data-stu-id="6b327-266">However, this approach can create unexpected problems.</span></span> <span data-ttu-id="6b327-267">Unter Umständen ist ein externer Dienst aus einem bestimmten Grund vorübergehend nicht verfügbar.</span><span class="sxs-lookup"><span data-stu-id="6b327-267">An external service might be temporarily unavailable for some reason.</span></span> <span data-ttu-id="6b327-268">Dies führt dazu, dass der Bereitschaftstest für alle Pods Ihres Diensts fehlschlägt, sodass alle aus dem Lastenausgleich entfernt werden und es im weiteren Verlauf zu kaskadierenden Fehlern kommt.</span><span class="sxs-lookup"><span data-stu-id="6b327-268">That will cause the readiness probe to fail for all the pods in your service, causing all of them to be removed from load balancing, and thus creating cascading failures upstream.</span></span> <span data-ttu-id="6b327-269">Ein besserer Ansatz ist die Implementierung einer Verarbeitungswiederholung in Ihrem Dienst, damit Ihr Dienst nach vorübergehenden Fehlern korrekt wiederhergestellt werden kann.</span><span class="sxs-lookup"><span data-stu-id="6b327-269">A better approach is to implement retry handling within your service, so that your service can recover correctly from transient failures.</span></span>

### <a name="resource-constraints"></a><span data-ttu-id="6b327-270">Ressourceneinschränkungen</span><span class="sxs-lookup"><span data-stu-id="6b327-270">Resource constraints</span></span>

<span data-ttu-id="6b327-271">Ressourcenkonflikte können sich auf die Verfügbarkeit eines Diensts auswirken.</span><span class="sxs-lookup"><span data-stu-id="6b327-271">Resource contention can affect the availability of a service.</span></span> <span data-ttu-id="6b327-272">Definieren Sie Ressourceneinschränkungen für Container, damit ein einzelner Container die Clusterressourcen (Arbeitsspeicher und CPU) nicht überlasten kann.</span><span class="sxs-lookup"><span data-stu-id="6b327-272">Define resource constraints for containers, so that a single container cannot overwhelm the cluster resources (memory and CPU).</span></span> <span data-ttu-id="6b327-273">Für andere Ressourcen, bei denen es sich nicht um Container handelt, z.B. Threads oder Netzwerkverbindungen, können Sie das [Bulkhead-Muster](/azure/architecture/patterns/bulkhead) (Trennwandmuster) verwenden, um Ressourcen zu isolieren.</span><span class="sxs-lookup"><span data-stu-id="6b327-273">For non-container resources, such as threads or network connections, consider using the [Bulkhead Pattern](/azure/architecture/patterns/bulkhead) to isolate resources.</span></span>

<span data-ttu-id="6b327-274">Nutzen Sie Ressourcenkontingente, um die Gesamtzahl der Ressourcen, die für einen Namespace zulässig sind, zu begrenzen.</span><span class="sxs-lookup"><span data-stu-id="6b327-274">Use resource quotas to limit the total resources allowed for a namespace.</span></span> <span data-ttu-id="6b327-275">Auf diese Weise kann das Front-End die Back-End-Dienste für Ressourcen blockieren (oder umgekehrt).</span><span class="sxs-lookup"><span data-stu-id="6b327-275">That way, the front end can't starve the backend services for resources or vice-versa.</span></span>

## <a name="security-considerations"></a><span data-ttu-id="6b327-276">Sicherheitshinweise</span><span class="sxs-lookup"><span data-stu-id="6b327-276">Security considerations</span></span>

### <a name="role-based-access-control-rbac"></a><span data-ttu-id="6b327-277">Rollenbasierte Zugriffssteuerung (Role Based Access Control, RBAC)</span><span class="sxs-lookup"><span data-stu-id="6b327-277">Role based access control (RBAC)</span></span>

<span data-ttu-id="6b327-278">Kubernetes und Azure verfügen jeweils über Mechanismen für die rollenbasierte Zugriffssteuerung (RBAC):</span><span class="sxs-lookup"><span data-stu-id="6b327-278">Kubernetes and Azure both have mechanisms for role-based access control (RBAC):</span></span>

- <span data-ttu-id="6b327-279">Mit der rollenbasierten Zugriffssteuerung von Azure wird der Zugriff auf Ressourcen in Azure gesteuert, z.B. auch die Möglichkeit zum Erstellen neuer Azure-Ressourcen.</span><span class="sxs-lookup"><span data-stu-id="6b327-279">Azure RBAC controls access to resources in Azure, including the ability to create new Azure resources.</span></span> <span data-ttu-id="6b327-280">Berechtigungen können Benutzern, Gruppen oder Dienstprinzipalen zugewiesen werden.</span><span class="sxs-lookup"><span data-stu-id="6b327-280">Permissions can be assigned to users, groups, or service principals.</span></span> <span data-ttu-id="6b327-281">(Ein Dienstprinzipal ist eine Sicherheitsidentität, die von Anwendungen verwendet wird.)</span><span class="sxs-lookup"><span data-stu-id="6b327-281">(A service principal is a security identity used by applications.)</span></span>

- <span data-ttu-id="6b327-282">Mit der rollenbasierten Zugriffssteuerung von Kubernetes werden die Berechtigungen für die Kubernetes-API gesteuert.</span><span class="sxs-lookup"><span data-stu-id="6b327-282">Kubernetes RBAC controls permissions to the Kubernetes API.</span></span> <span data-ttu-id="6b327-283">Beispielsweise sind das Erstellen und Auflisten von Pods Aktionen, die per RBAC für einen Benutzer autorisiert (oder abgelehnt) werden können.</span><span class="sxs-lookup"><span data-stu-id="6b327-283">For example, creating pods and listing pods are actions that can be authorized (or denied) to a user through RBAC.</span></span> <span data-ttu-id="6b327-284">Zum Zuweisen von Kubernetes-Berechtigungen zu Benutzern erstellen Sie *Rollen* und *Rollenbindungen*:</span><span class="sxs-lookup"><span data-stu-id="6b327-284">To assign Kubernetes permissions to users, you create *roles* and *role bindings*:</span></span>

  - <span data-ttu-id="6b327-285">Eine Rolle ist ein Satz mit Berechtigungen, die innerhalb eines Namespace gelten.</span><span class="sxs-lookup"><span data-stu-id="6b327-285">A Role is a set of permissions that apply within a namespace.</span></span> <span data-ttu-id="6b327-286">Berechtigungen werden in Form von Verben (abrufen, aktualisieren, erstellen, löschen) für Ressourcen (Pods, Bereitstellungen usw.) definiert.</span><span class="sxs-lookup"><span data-stu-id="6b327-286">Permissions are defined as verbs (get, update, create, delete) on resources (pods, deployments, etc.).</span></span>

  - <span data-ttu-id="6b327-287">Mit einer Rollenbindung (RoleBinding) werden Benutzer oder Gruppen einer Rolle zugewiesen.</span><span class="sxs-lookup"><span data-stu-id="6b327-287">A RoleBinding assigns users or groups to a Role.</span></span>

  - <span data-ttu-id="6b327-288">Es ist auch ein ClusterRole-Objekt vorhanden. Dies ähnelt einer Rolle, gilt aber für den gesamten Cluster übergreifend für alle Namespaces.</span><span class="sxs-lookup"><span data-stu-id="6b327-288">There is also a ClusterRole object, which is like a Role but applies to the entire cluster, across all namespaces.</span></span> <span data-ttu-id="6b327-289">Erstellen Sie eine Clusterrollenbindung (ClusterRoleBinding), um Benutzer oder Gruppen einer Clusterrolle (ClusterRole) zuzuweisen.</span><span class="sxs-lookup"><span data-stu-id="6b327-289">To assign users or groups to a ClusterRole, create a ClusterRoleBinding.</span></span>

<span data-ttu-id="6b327-290">AKS integriert diese beiden RBAC-Mechanismen.</span><span class="sxs-lookup"><span data-stu-id="6b327-290">AKS integrates these two RBAC mechanisms.</span></span> <span data-ttu-id="6b327-291">Beim Erstellen eines AKS-Clusters können Sie diesen so konfigurieren, dass für die Benutzerauthentifizierung Azure AD verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="6b327-291">When you create an AKS cluster, you can configure it to use Azure AD for user authentication.</span></span> <span data-ttu-id="6b327-292">Ausführliche Informationen zur Einrichtung finden Sie unter [Integrieren von Azure Active Directory in Azure Kubernetes Service](/azure/aks/aad-integration).</span><span class="sxs-lookup"><span data-stu-id="6b327-292">For details on how to set this up, see [Integrate Azure Active Directory with Azure Kubernetes Service](/azure/aks/aad-integration).</span></span>

<span data-ttu-id="6b327-293">Nachdem dies konfiguriert wurde, muss sich ein Benutzer, der Zugriff auf die Kubernetes-API erhalten möchte (z.B. über kubectl), mit seinen Azure AD-Anmeldeinformationen anmelden.</span><span class="sxs-lookup"><span data-stu-id="6b327-293">Once this is configured, a user who wants to access the Kubernetes API (for example, through kubectl) must sign in using their Azure AD credentials.</span></span>

<span data-ttu-id="6b327-294">Standardmäßig hat ein Azure AD-Benutzer keinen Zugriff auf den Cluster.</span><span class="sxs-lookup"><span data-stu-id="6b327-294">By default, an Azure AD user has no access to the cluster.</span></span> <span data-ttu-id="6b327-295">Zum Gewähren des Zugriffs erstellt der Clusteradministrator Rollenbindungen (RoleBindings), die sich auf Azure AD-Benutzer oder -Gruppen beziehen.</span><span class="sxs-lookup"><span data-stu-id="6b327-295">To grant access, the cluster administrator creates RoleBindings that refer to Azure AD users or groups.</span></span> <span data-ttu-id="6b327-296">Es tritt ein Fehler auf, wenn ein Benutzer nicht über die Berechtigungen für einen bestimmten Vorgang verfügt.</span><span class="sxs-lookup"><span data-stu-id="6b327-296">If a user doesn't have permissions for a particular operation, it will fail.</span></span>

<span data-ttu-id="6b327-297">Dies wirft folgende Frage auf: Wenn Benutzer standardmäßig keinen Zugriff haben, wie verfügt der Clusteradministrator dann überhaupt über die Berechtigung zum Erstellen der Rollenbindungen?</span><span class="sxs-lookup"><span data-stu-id="6b327-297">If users have no access by default, how does the cluster admin have permission to create the role bindings in the first place?</span></span> <span data-ttu-id="6b327-298">Ein AKS-Cluster weist zwei Arten von Anmeldeinformationen auf, mit denen der Kubernetes-API-Server aufgerufen wird: Clusterbenutzer und Clusteradministrator. Mit den Anmeldeinformationen für den Clusteradministrator wird Vollzugriff auf den Cluster gewährt.</span><span class="sxs-lookup"><span data-stu-id="6b327-298">An AKS cluster actually has two types of credentials for calling the Kubernetes API server: cluster user and cluster admin. The cluster admin credentials grant full access to the cluster.</span></span> <span data-ttu-id="6b327-299">Mit dem Azure CLI-Befehl `az aks get-credentials --admin` werden die Anmeldeinformationen des Clusteradministrators heruntergeladen und in Ihrer kubeconfig-Datei gespeichert.</span><span class="sxs-lookup"><span data-stu-id="6b327-299">The Azure CLI command `az aks get-credentials --admin` downloads the cluster admin credentials and saves them into your kubeconfig file.</span></span> <span data-ttu-id="6b327-300">Der Clusteradministrator kann diese kubeconfig-Datei zum Erstellen von Rollen und Rollenbindungen verwenden.</span><span class="sxs-lookup"><span data-stu-id="6b327-300">The cluster administrator can use this kubeconfig to create roles and role bindings.</span></span>

<span data-ttu-id="6b327-301">Da die Anmeldeinformationen des Clusteradministrators mit umfassenden Berechtigungen verbunden sind, können Sie Azure RBAC verwenden, um den Zugriff zu beschränken:</span><span class="sxs-lookup"><span data-stu-id="6b327-301">Because the cluster admin credentials are so powerful, use Azure RBAC to restrict access to them:</span></span>

- <span data-ttu-id="6b327-302">Die „Administratorrolle für Azure Kubernetes Service-Cluster“ verfügt über die Berechtigung zum Herunterladen der Anmeldeinformationen für den Clusteradministrator.</span><span class="sxs-lookup"><span data-stu-id="6b327-302">The "Azure Kubernetes Service Cluster Admin Role" has permission to download the cluster admin credentials.</span></span> <span data-ttu-id="6b327-303">Dieser Rolle sollten nur Clusteradministratoren zugewiesen werden.</span><span class="sxs-lookup"><span data-stu-id="6b327-303">Only cluster administrators should be assigned to this role.</span></span>

- <span data-ttu-id="6b327-304">Die „Benutzerrolle für Azure Kubernetes Service-Cluster“ verfügt über die Berechtigung zum Herunterladen der Anmeldeinformationen für den Clusterbenutzer.</span><span class="sxs-lookup"><span data-stu-id="6b327-304">The "Azure Kubernetes Service Cluster User Role" has permission to download the cluster user credentials.</span></span> <span data-ttu-id="6b327-305">Benutzer ohne Administratorrechte können dieser Rolle zugewiesen werden.</span><span class="sxs-lookup"><span data-stu-id="6b327-305">Non-admin users can be assigned to this role.</span></span> <span data-ttu-id="6b327-306">Mit dieser Rolle werden keine besonderen Berechtigungen für Kubernetes-Ressourcen im Cluster gewährt. Einem Benutzer wird lediglich die Berechtigung gewährt, eine Verbindung mit dem API-Server herzustellen.</span><span class="sxs-lookup"><span data-stu-id="6b327-306">This role does not give any particular permissions on Kubernetes resources inside the cluster &mdash; it just allows a user to connect to the API server.</span></span> 

<span data-ttu-id="6b327-307">Beachten Sie beim Definieren Ihrer RBAC-Richtlinien (sowohl für Kubernetes als auch für Azure) die Rollen in Ihrer Organisation:</span><span class="sxs-lookup"><span data-stu-id="6b327-307">When you define your RBAC policies (both Kubernetes and Azure), think about the roles in your organization:</span></span>

- <span data-ttu-id="6b327-308">Wer kann einen AKS-Cluster erstellen oder löschen und die Administratoranmeldeinformationen herunterladen?</span><span class="sxs-lookup"><span data-stu-id="6b327-308">Who can create or delete an AKS cluster and download the admin credentials?</span></span>
- <span data-ttu-id="6b327-309">Wer kann einen Cluster verwalten?</span><span class="sxs-lookup"><span data-stu-id="6b327-309">Who can administer a cluster?</span></span>
- <span data-ttu-id="6b327-310">Wer kann Ressourcen innerhalb eines Namespace erstellen oder aktualisieren?</span><span class="sxs-lookup"><span data-stu-id="6b327-310">Who can create or update resources within a namespace?</span></span>

<span data-ttu-id="6b327-311">Es ist eine bewährte Vorgehensweise, den Bereich für Kubernetes-RBAC-Berechtigungen basierend auf dem Namespace festzulegen, indem „Roles“ und „RoleBindings“ verwendet werden (anstatt „ClusterRoles“ und „ClusterRoleBindings“).</span><span class="sxs-lookup"><span data-stu-id="6b327-311">It's a good practice to scope Kubernetes RBAC permissions by namespace, using Roles and RoleBindings, rather than ClusterRoles and ClusterRoleBindings.</span></span>

<span data-ttu-id="6b327-312">Abschließend muss die Frage beantwortet werden, über welche Berechtigungen der AKS-Cluster für die Erstellung und Verwaltung von Azure-Ressourcen verfügt, z.B. Lastenausgleichsmodule, Netzwerke oder Speicher.</span><span class="sxs-lookup"><span data-stu-id="6b327-312">Finally, there is the question of what permissions the AKS cluster has to create and manage Azure resources, such as load balancers, networking, or storage.</span></span> <span data-ttu-id="6b327-313">Für die Authentifizierung gegenüber Azure-APIs nutzt der Cluster einen Azure AD-Dienstprinzipal.</span><span class="sxs-lookup"><span data-stu-id="6b327-313">To authenticate itself with Azure APIs, the cluster uses an Azure AD service principal.</span></span> <span data-ttu-id="6b327-314">Falls Sie beim Erstellen des Clusters keinen Dienstprinzipal angeben, wird automatisch einer erstellt.</span><span class="sxs-lookup"><span data-stu-id="6b327-314">If you don't specify a service principal when you create the cluster, one is created automatically.</span></span> <span data-ttu-id="6b327-315">Es ist aber eine gute Vorgehensweise in Bezug auf die Sicherheit, zuerst den Dienstprinzipal zu erstellen und ihm die RBAC-Mindestberechtigungen zuzuweisen.</span><span class="sxs-lookup"><span data-stu-id="6b327-315">However, it's a good security practice to create the service principal first and assign the minimal RBAC permissions to it.</span></span> <span data-ttu-id="6b327-316">Weitere Informationen finden Sie unter [Dienstprinzipale mit Azure Kubernetes Service (AKS)](/azure/aks/kubernetes-service-principal).</span><span class="sxs-lookup"><span data-stu-id="6b327-316">For more information, see [Service principals with Azure Kubernetes Service](/azure/aks/kubernetes-service-principal).</span></span>

### <a name="secrets-management-and-application-credentials"></a><span data-ttu-id="6b327-317">Geheimnisverwaltung und Anwendungsanmeldeinformationen</span><span class="sxs-lookup"><span data-stu-id="6b327-317">Secrets management and application credentials</span></span>

<span data-ttu-id="6b327-318">Anwendungen und Dienste benötigen häufig Anmeldeinformationen, mit denen sie sich an externen Diensten, z.B. Azure Storage oder SQL-Datenbank, anmelden können.</span><span class="sxs-lookup"><span data-stu-id="6b327-318">Applications and services often need credentials that allow them to connect to external services such as Azure Storage or SQL Database.</span></span> <span data-ttu-id="6b327-319">Die Herausforderung besteht darin, diese Anmeldeinformationen sicher aufzubewahren und vor der Offenlegung zu schützen.</span><span class="sxs-lookup"><span data-stu-id="6b327-319">The challenge is to keep these credentials safe and not leak them.</span></span> 

<span data-ttu-id="6b327-320">Für Azure-Ressourcen besteht eine Option darin, verwaltete Identitäten zu nutzen.</span><span class="sxs-lookup"><span data-stu-id="6b327-320">For Azure resources, one option is to use managed identities.</span></span> <span data-ttu-id="6b327-321">Die Idee bei einer verwalteten Identität ist, dass für eine Anwendung oder einen Dienst eine Identität in Azure AD gespeichert ist, die zum Authentifizieren gegenüber einem Azure-Dienst verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="6b327-321">The idea of a managed identity is that an application or service has an identity stored in Azure AD, and uses this identity to authenticate with an Azure service.</span></span> <span data-ttu-id="6b327-322">Für die Anwendung oder den Dienst wird in Azure AD ein Dienstprinzipal erstellt, und für die Authentifizierung werden OAuth 2.0-Token verwendet.</span><span class="sxs-lookup"><span data-stu-id="6b327-322">The application or service has a Service Principal created for it in Azure AD, and authenticates using OAuth 2.0 tokens.</span></span> <span data-ttu-id="6b327-323">Der ausführende Prozess ruft eine localhost-Adresse auf, um das Token abzurufen.</span><span class="sxs-lookup"><span data-stu-id="6b327-323">The executing process calls a localhost address to get the token.</span></span> <span data-ttu-id="6b327-324">Auf diese Weise müssen Sie keine Kennwörter oder Verbindungszeichenfolgen speichern.</span><span class="sxs-lookup"><span data-stu-id="6b327-324">That way, you don't need to store any passwords or connection strings.</span></span> <span data-ttu-id="6b327-325">Sie können verwaltete Identitäten in AKS nutzen, indem Sie den einzelnen Pods über das Projekt [aad-pod-identity](https://github.com/Azure/aad-pod-identity) Identitäten zuweisen.</span><span class="sxs-lookup"><span data-stu-id="6b327-325">You can use managed identities in AKS by assigning identities to individual pods, using the [aad-pod-identity](https://github.com/Azure/aad-pod-identity) project.</span></span>

<span data-ttu-id="6b327-326">Derzeit unterstützen nicht alle Azure-Dienste die Authentifizierung mit verwalteten Identitäten.</span><span class="sxs-lookup"><span data-stu-id="6b327-326">Currently, not all Azure services support authentication using managed identities.</span></span> <span data-ttu-id="6b327-327">Eine Liste finden Sie unter [Azure-Dienste, die die Azure AD-Authentifizierung unterstützen](/azure/active-directory/managed-identities-azure-resources/services-support-msi).</span><span class="sxs-lookup"><span data-stu-id="6b327-327">For a list, see [Azure services that support Azure AD authentication](/azure/active-directory/managed-identities-azure-resources/services-support-msi).</span></span>

<span data-ttu-id="6b327-328">Auch bei verwalteten Identitäten müssen Sie wahrscheinlich einige Anmeldeinformationen oder anderen Anwendungsgeheimnisse speichern, z.B. für Azure-Dienste, die keine verwalteten Identitäten unterstützen, Drittanbieterdienste, API-Schlüssel usw.</span><span class="sxs-lookup"><span data-stu-id="6b327-328">Even with managed identities, you'll probably need to store some credentials or other application secrets, whether for Azure services that don't support managed identities, third-party services, API keys, and so on.</span></span> <span data-ttu-id="6b327-329">Hier sind einige Optionen für die sichere Speicherung von Geheimnissen angegeben:</span><span class="sxs-lookup"><span data-stu-id="6b327-329">Here are some options for storing secrets securely:</span></span>

- <span data-ttu-id="6b327-330">Azure Key Vault:</span><span class="sxs-lookup"><span data-stu-id="6b327-330">Azure Key Vault.</span></span> <span data-ttu-id="6b327-331">In AKS können Sie ein oder mehrere Geheimnisse aus Key Vault als Volume bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="6b327-331">In AKS, you can mount one or more secrets from Key Vault as a volume.</span></span> <span data-ttu-id="6b327-332">Das Volume liest die Geheimnisse aus Key Vault aus.</span><span class="sxs-lookup"><span data-stu-id="6b327-332">The volume reads the secrets from Key Vault.</span></span> <span data-ttu-id="6b327-333">Der Pod kann die Geheimnisse dann wie ein reguläres Volume lesen.</span><span class="sxs-lookup"><span data-stu-id="6b327-333">The pod can then read the secrets just like a regular volume.</span></span> <span data-ttu-id="6b327-334">Weitere Informationen finden Sie unter dem Projekt [Kubernetes-KeyVault-FlexVolume](https://github.com/Azure/kubernetes-keyvault-flexvol) auf GitHub.</span><span class="sxs-lookup"><span data-stu-id="6b327-334">For more information, see the [Kubernetes-KeyVault-FlexVolume](https://github.com/Azure/kubernetes-keyvault-flexvol) project on GitHub.</span></span>

    <span data-ttu-id="6b327-335">Der Pod authentifiziert sich selbst entweder mit einer Pod-Identität (oben beschrieben) oder mit einem Azure AD-Dienstprinzipal und einem geheimen Clientschlüssel.</span><span class="sxs-lookup"><span data-stu-id="6b327-335">The pod authenticates itself by using either a pod identity (described above) or by using an Azure AD Service Principal along with a client secret.</span></span> <span data-ttu-id="6b327-336">Die Verwendung von Pod-Identitäten wird empfohlen, da der geheime Clientschlüssel in diesem Fall nicht benötigt wird.</span><span class="sxs-lookup"><span data-stu-id="6b327-336">Using pod identities is recommended because the client secret isn't needed in that case.</span></span> 

- <span data-ttu-id="6b327-337">HashiCorp Vault:</span><span class="sxs-lookup"><span data-stu-id="6b327-337">HashiCorp Vault.</span></span> <span data-ttu-id="6b327-338">Kubernetes-Anwendungen können sich auch per HashiCorp authentifizieren, indem sie verwaltete Azure AD-Identitäten verwenden.</span><span class="sxs-lookup"><span data-stu-id="6b327-338">Kubernetes applications can authenticate with HashiCorp Vault using Azure AD managed identities.</span></span> <span data-ttu-id="6b327-339">Weitere Informationen finden Sie unter [HashiCorp Vault speaks Azure Active Directory](https://open.microsoft.com/2018/04/10/scaling-tips-hashicorp-vault-azure-active-directory/) (HashiCorp Vault spricht Azure Active Directory).</span><span class="sxs-lookup"><span data-stu-id="6b327-339">See [HashiCorp Vault speaks Azure Active Directory](https://open.microsoft.com/2018/04/10/scaling-tips-hashicorp-vault-azure-active-directory/).</span></span> <span data-ttu-id="6b327-340">Sie können Vault selbst für Kubernetes bereitstellen, aber es wird empfohlen, die Anwendung nicht in Ihrem Anwendungscluster, sondern in einem separaten dedizierten Cluster auszuführen.</span><span class="sxs-lookup"><span data-stu-id="6b327-340">You can deploy Vault itself to Kubernetes, but it's recommend to run it in a separate dedicated cluster from your application cluster.</span></span> 

- <span data-ttu-id="6b327-341">Kubernetes-Geheimnisse:</span><span class="sxs-lookup"><span data-stu-id="6b327-341">Kubernetes secrets.</span></span> <span data-ttu-id="6b327-342">Eine weitere Option ist einfach die Nutzung von Kubernetes-Geheimnissen.</span><span class="sxs-lookup"><span data-stu-id="6b327-342">Another option is simply to use Kubernetes secrets.</span></span> <span data-ttu-id="6b327-343">Diese Option ist am einfachsten zu konfigurieren, aber es sind auch einige Herausforderungen zu bewältigen.</span><span class="sxs-lookup"><span data-stu-id="6b327-343">This option is the easiest to configure but has some challenges.</span></span> <span data-ttu-id="6b327-344">Die Geheimnisse werden in „etcd“ gespeichert, wobei es sich um einen verteilten Schlüssel-Wert-Speicher handelt.</span><span class="sxs-lookup"><span data-stu-id="6b327-344">Secrets are stored in etcd, which is a distributed key-value store.</span></span> <span data-ttu-id="6b327-345">Bei AKS [wird etcd im ruhenden Zustand verschlüsselt](https://github.com/Azure/kubernetes-kms#azure-kubernetes-service-aks).</span><span class="sxs-lookup"><span data-stu-id="6b327-345">AKS [encrypts etcd at rest](https://github.com/Azure/kubernetes-kms#azure-kubernetes-service-aks).</span></span> <span data-ttu-id="6b327-346">Microsoft verwaltet die Verschlüsselungsschlüssel.</span><span class="sxs-lookup"><span data-stu-id="6b327-346">Microsoft manages the encryption keys.</span></span>

<span data-ttu-id="6b327-347">Die Nutzung eines Systems wie HashiCorp Vault oder Azure Key Vault hat mehrere Vorteile, z.B.:</span><span class="sxs-lookup"><span data-stu-id="6b327-347">Using a system like HashiCorp Vault or Azure Key Vault provides several advantages, such as:</span></span>

- <span data-ttu-id="6b327-348">Zentralisierte Steuerung der Geheimnisse</span><span class="sxs-lookup"><span data-stu-id="6b327-348">Centralized control of secrets.</span></span>
- <span data-ttu-id="6b327-349">Sicherheit, dass alle Geheimnisse im Ruhezustand verschlüsselt sind</span><span class="sxs-lookup"><span data-stu-id="6b327-349">Ensuring that all secrets are encrypted at rest.</span></span>
- <span data-ttu-id="6b327-350">Zentrale Schlüsselverwaltung</span><span class="sxs-lookup"><span data-stu-id="6b327-350">Centralized key management.</span></span>
- <span data-ttu-id="6b327-351">Zugriffssteuerung für Geheimnisse</span><span class="sxs-lookup"><span data-stu-id="6b327-351">Access control of secrets.</span></span>
- <span data-ttu-id="6b327-352">Überwachung</span><span class="sxs-lookup"><span data-stu-id="6b327-352">Auditing</span></span>

### <a name="pod-and-container-security"></a><span data-ttu-id="6b327-353">Pod- und Containersicherheit</span><span class="sxs-lookup"><span data-stu-id="6b327-353">Pod and container security</span></span>

<span data-ttu-id="6b327-354">Dies ist keine vollständige Liste, aber hier sind einige empfohlene Vorgehensweisen zum Schützen Ihrer Pods und Container angegeben:</span><span class="sxs-lookup"><span data-stu-id="6b327-354">This list is certainly not exhaustive, but here are some recommended practices for securing your pods and containers:</span></span> 

<span data-ttu-id="6b327-355">Führen Sie Container nicht im privilegierten Modus aus.</span><span class="sxs-lookup"><span data-stu-id="6b327-355">Don't run containers in privileged mode.</span></span> <span data-ttu-id="6b327-356">Im privilegierten Modus hat ein Container Zugriff auf alle Geräte auf dem Host.</span><span class="sxs-lookup"><span data-stu-id="6b327-356">Privileged mode gives a container access to all devices on the host.</span></span> <span data-ttu-id="6b327-357">Sie können eine Pod-Sicherheitsrichtlinie festlegen, um die Ausführung im privilegierten Modus für Container zu unterbinden.</span><span class="sxs-lookup"><span data-stu-id="6b327-357">You can set Pod Security Policy to disallow containers from running in privileged mode.</span></span> 

<span data-ttu-id="6b327-358">Vermeiden Sie nach Möglichkeit die Ausführung von Prozessen als Root-Benutzer innerhalb von Containern.</span><span class="sxs-lookup"><span data-stu-id="6b327-358">When possible, avoid running processes as root inside containers.</span></span> <span data-ttu-id="6b327-359">Container bieten aus Sicherheitssicht keine vollständige Isolation, und es ist besser, einen Containerprozess als nicht privilegierter Benutzer auszuführen.</span><span class="sxs-lookup"><span data-stu-id="6b327-359">Containers do not provide complete isolation from a security standpoint, so it's better to run a container process as a non-privileged user.</span></span> 

<span data-ttu-id="6b327-360">Speichern Sie Images in einer vertrauenswürdigen privaten Registrierung, z.B. Azure Container Registry oder Docker Trusted Registry.</span><span class="sxs-lookup"><span data-stu-id="6b327-360">Store images in a trusted private registry, such as Azure Container Registry or Docker Trusted Registry.</span></span> <span data-ttu-id="6b327-361">Verwenden Sie in Kubernetes einen Webhook für die Aufnahmeüberprüfung, um sicherzustellen, dass Pods Images nur aus der vertrauenswürdigen Registrierung per Pullvorgang abrufen können.</span><span class="sxs-lookup"><span data-stu-id="6b327-361">Use a validating admission webhook in Kubernetes to ensure that pods can only pull images from the trusted registry.</span></span>

<span data-ttu-id="6b327-362">Scannen Sie Images auf bekannte Sicherheitsrisiken, indem Sie Scanlösungen wie Twistlock oder Aqua verwenden, die über den Azure Marketplace erhältlich sind.</span><span class="sxs-lookup"><span data-stu-id="6b327-362">Scan images for known vulnerabilities, using a scanning solution such as Twistlock and Aqua, which are available through the Azure Marketplace.</span></span>

<span data-ttu-id="6b327-363">Automatisieren Sie das Patchen der Images mit ACR Tasks, einem Feature von Azure Container Registry.</span><span class="sxs-lookup"><span data-stu-id="6b327-363">Automate image patching using ACR Tasks, a feature of Azure Container Registry.</span></span> <span data-ttu-id="6b327-364">Ein Containerimage besteht aus verschiedenen Ebenen.</span><span class="sxs-lookup"><span data-stu-id="6b327-364">A container image is built up from layers.</span></span> <span data-ttu-id="6b327-365">Die Basisebenen enthalten das Betriebssystemimage und die Anwendungsframework-Images, z.B. ASP.NET Core oder Node.js.</span><span class="sxs-lookup"><span data-stu-id="6b327-365">The base layers include the OS image and application framework images, such as ASP.NET Core or Node.js.</span></span> <span data-ttu-id="6b327-366">Die Erstellung der Basisimages ist den Anwendungsentwicklern normalerweise vorgeschaltet, und die Verwaltung wird von anderen Projektbeteiligten durchgeführt.</span><span class="sxs-lookup"><span data-stu-id="6b327-366">The base images are typically created upstream from the application developers, and are maintained by other project maintainers.</span></span> <span data-ttu-id="6b327-367">Wenn diese Images vorher gepatcht werden, ist es wichtig, dass Sie Ihre eigenen Images aktualisieren, testen und erneut bereitstellen, damit keine bekannten Sicherheitsrisiken bestehen.</span><span class="sxs-lookup"><span data-stu-id="6b327-367">When these images are patched upstream, it's important to update, test, and redeploy your own images, so that you don't leave any known security vulnerabilities.</span></span> <span data-ttu-id="6b327-368">ACR Tasks kann zum Automatisieren dieses Prozesses beitragen.</span><span class="sxs-lookup"><span data-stu-id="6b327-368">ACR Tasks can help to automate this process.</span></span>

## <a name="deployment-cicd-considerations"></a><span data-ttu-id="6b327-369">Bereitstellungsaspekte (CI/CD)</span><span class="sxs-lookup"><span data-stu-id="6b327-369">Deployment (CI/CD) considerations</span></span>

<span data-ttu-id="6b327-370">Hier sind einige Ziele eines stabilen CI/CD-Prozesses für eine Microservicearchitektur aufgeführt:</span><span class="sxs-lookup"><span data-stu-id="6b327-370">Here are some goals of a robust CI/CD process for a microservices architecture:</span></span>

- <span data-ttu-id="6b327-371">Jedes Team kann die eigenen Dienste unabhängig erstellen und bereitstellen, ohne dass andere Teams hierdurch beeinträchtigt oder gestört werden.</span><span class="sxs-lookup"><span data-stu-id="6b327-371">Each team can build and deploy the services that it owns independently, without affecting or disrupting other teams.</span></span>

- <span data-ttu-id="6b327-372">Bevor eine neue Version eines Diensts für die Produktion bereitgestellt wird, wird sie zunächst zur Überprüfung in Umgebungen für die Entwicklung, Tests und Qualitätssicherung bereitgestellt.</span><span class="sxs-lookup"><span data-stu-id="6b327-372">Before a new version of a service is deployed to production, it gets deployed to dev/test/QA environments for validation.</span></span> <span data-ttu-id="6b327-373">Jede Phase verfügt über so genannte „Quality Gates“.</span><span class="sxs-lookup"><span data-stu-id="6b327-373">Quality gates are enforced at each stage.</span></span>

- <span data-ttu-id="6b327-374">Eine neue Version eines Diensts kann parallel zur vorherigen Version bereitgestellt werden.</span><span class="sxs-lookup"><span data-stu-id="6b327-374">A new version of a service can be deployed side-by-side with the previous version.</span></span>

- <span data-ttu-id="6b327-375">Es sind ausreichende Richtlinien für die Zugriffssteuerung vorhanden.</span><span class="sxs-lookup"><span data-stu-id="6b327-375">Sufficient access control policies are in place.</span></span>

- <span data-ttu-id="6b327-376">Sie können den Containerimages vertrauen, die für die Produktion bereitgestellt werden.</span><span class="sxs-lookup"><span data-stu-id="6b327-376">You can trust the container images that are deployed to production.</span></span>

### <a name="isolation-of-environments"></a><span data-ttu-id="6b327-377">Isolation von Umgebungen</span><span class="sxs-lookup"><span data-stu-id="6b327-377">Isolation of environments</span></span>

<span data-ttu-id="6b327-378">Sie verfügen über mehrere Umgebungen, in denen Sie Dienste bereitstellen, z.B. Entwicklung, Feuerprobe, Integrationstests, Auslastungstests und schließlich Produktion.</span><span class="sxs-lookup"><span data-stu-id="6b327-378">You will have multiple environments where you deploy services, including environments for development, smoke testing, integration testing, load testing, and finally production.</span></span> <span data-ttu-id="6b327-379">Für diese Umgebungen ist ein gewisses Maß an Isolation erforderlich.</span><span class="sxs-lookup"><span data-stu-id="6b327-379">These environments need some level of isolation.</span></span> <span data-ttu-id="6b327-380">In Kubernetes haben Sie die Wahl zwischen physischer Isolation und logischer Isolation.</span><span class="sxs-lookup"><span data-stu-id="6b327-380">In Kubernetes, you have a choice between physical isolation and logical isolation.</span></span> <span data-ttu-id="6b327-381">Physische Isolation bedeutet, dass die Bereitstellung in separaten Clustern erfolgt.</span><span class="sxs-lookup"><span data-stu-id="6b327-381">Physical isolation means deploying to separate clusters.</span></span> <span data-ttu-id="6b327-382">Bei der logischen Isolation werden wie oben beschrieben Namespaces und Richtlinien verwendet.</span><span class="sxs-lookup"><span data-stu-id="6b327-382">Logical isolation makes use of namespaces and policies, as described earlier.</span></span>

<span data-ttu-id="6b327-383">Unsere Empfehlung lautet, einen dedizierten Produktionscluster mit einem zusätzlichen separaten Cluster für Ihre Entwicklungs- und Testumgebungen zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="6b327-383">Our recommendation is to create a dedicated production cluster along with a separate cluster for your dev/test environments.</span></span> <span data-ttu-id="6b327-384">Verwenden Sie die logische Isolation, um Umgebungen im Entwicklungs-/Testcluster zu trennen.</span><span class="sxs-lookup"><span data-stu-id="6b327-384">Use logical isolation to separate environments within the dev/test cluster.</span></span> <span data-ttu-id="6b327-385">Im Entwicklungs-/Testcluster bereitgestellte Dienste sollten niemals Zugriff auf Datenspeicher haben, in denen sich Geschäftsdaten befinden.</span><span class="sxs-lookup"><span data-stu-id="6b327-385">Services deployed to the dev/test cluster should never have access to data stores that hold business data.</span></span> 

### <a name="helm"></a><span data-ttu-id="6b327-386">Helm</span><span class="sxs-lookup"><span data-stu-id="6b327-386">Helm</span></span>

<span data-ttu-id="6b327-387">Erwägen Sie die Verwendung von Helm zum Erstellen und Bereitstellen von Diensten.</span><span class="sxs-lookup"><span data-stu-id="6b327-387">Consider using Helm to manage building and deploying services.</span></span> <span data-ttu-id="6b327-388">Einige Features von Helm für CI/CD sind:</span><span class="sxs-lookup"><span data-stu-id="6b327-388">Some of the features of Helm that help with CI/CD include:</span></span>

- <span data-ttu-id="6b327-389">Organisieren aller Kubernetes-Objekte für einen bestimmten Microservice in einem gemeinsamen Helm-Diagramm</span><span class="sxs-lookup"><span data-stu-id="6b327-389">Organizing all of the Kubernetes objects for a particular microservice into a single Helm chart.</span></span>
- <span data-ttu-id="6b327-390">Bereitstellen des Diagramms als einzelnen Helm-Befehl, anstatt einer Reihe von kubectl-Befehlen</span><span class="sxs-lookup"><span data-stu-id="6b327-390">Deploying the chart as a single helm command, rather than a series of kubectl commands.</span></span>
- <span data-ttu-id="6b327-391">Nachverfolgen von Updates und Revisionen per semantischer Versionierung und möglicher Rollback auf eine vorherige Version</span><span class="sxs-lookup"><span data-stu-id="6b327-391">Tracking updates and revisions, using semantic versioning, along with the ability to roll back to a previous version.</span></span>
- <span data-ttu-id="6b327-392">Verwenden von Vorlagen zur Vermeidung von doppelten Informationen, z.B. Bezeichnungen und Selektoren, über viele Dateien hinweg</span><span class="sxs-lookup"><span data-stu-id="6b327-392">The use of templates to avoid duplicating information, such as labels and selectors, across many files.</span></span>
- <span data-ttu-id="6b327-393">Verwalten von Abhängigkeiten zwischen Diagrammen</span><span class="sxs-lookup"><span data-stu-id="6b327-393">Managing dependencies between charts.</span></span>
- <span data-ttu-id="6b327-394">Veröffentlichen von Diagrammen in einem Helm-Repository, z.B. Azure Container Registry, und Integrieren in die Buildpipeline</span><span class="sxs-lookup"><span data-stu-id="6b327-394">Publishing charts to a Helm repository, such as Azure Container Registry, and integrating them with the build pipeline.</span></span>

<span data-ttu-id="6b327-395">Weitere Informationen zur Verwendung von Container Registry als Helm-Repository finden Sie unter [Verwenden Sie Azure Container Registry als Helm-Repository für Ihre Anwendungsdiagramme](/azure/container-registry/container-registry-helm-repos).</span><span class="sxs-lookup"><span data-stu-id="6b327-395">For more information about using Container Registry as a Helm repository, see [Use Azure Container Registry as a Helm repository for your application charts](/azure/container-registry/container-registry-helm-repos).</span></span>

### <a name="cicd-workflow"></a><span data-ttu-id="6b327-396">CI/CD-Workflow</span><span class="sxs-lookup"><span data-stu-id="6b327-396">CI/CD workflow</span></span>

<span data-ttu-id="6b327-397">Vor dem Erstellen eines CI/CD-Workflows müssen Sie sich darüber im Klaren sein, wie die Codebasis strukturiert sein und verwaltet werden soll.</span><span class="sxs-lookup"><span data-stu-id="6b327-397">Before creating a CI/CD workflow, you must know how the code base will be structured and managed.</span></span>

- <span data-ttu-id="6b327-398">Arbeiten die Teams in separaten Repositorys oder in einem „Monorepo“ (einzelnen Repository)?</span><span class="sxs-lookup"><span data-stu-id="6b327-398">Do teams work in separate respositories or in a monorepo (single respository)?</span></span>
- <span data-ttu-id="6b327-399">Wie sieht Ihre Strategie für das „Branchen“ aus?</span><span class="sxs-lookup"><span data-stu-id="6b327-399">What is your branching strategy?</span></span>
- <span data-ttu-id="6b327-400">Wer kann Code per Pushvorgang in die Produktion übertragen?</span><span class="sxs-lookup"><span data-stu-id="6b327-400">Who can push code to production?</span></span> <span data-ttu-id="6b327-401">Ist eine Release Manager-Rolle vorhanden?</span><span class="sxs-lookup"><span data-stu-id="6b327-401">Is there a release manager role?</span></span>

<span data-ttu-id="6b327-402">Die Beliebtheit des Monorepo-Ansatzes ist gestiegen, aber beide Ansätze haben sowohl Vor- als auch Nachteile.</span><span class="sxs-lookup"><span data-stu-id="6b327-402">The monorepo approach has been gaining favor but there are advantages and disadvantages to both.</span></span>

| &nbsp; | <span data-ttu-id="6b327-403">Monorepo</span><span class="sxs-lookup"><span data-stu-id="6b327-403">Monorepo</span></span> | <span data-ttu-id="6b327-404">Mehrere Repositorys</span><span class="sxs-lookup"><span data-stu-id="6b327-404">Multiple repos</span></span> |
|--------|----------|----------------|
| <span data-ttu-id="6b327-405">**Vorteile**</span><span class="sxs-lookup"><span data-stu-id="6b327-405">**Advantages**</span></span> | <span data-ttu-id="6b327-406">Codefreigabe</span><span class="sxs-lookup"><span data-stu-id="6b327-406">Code sharing</span></span><br/><span data-ttu-id="6b327-407">Einfacheres Standardisieren von Code und Tools</span><span class="sxs-lookup"><span data-stu-id="6b327-407">Easier to standardize code and tooling</span></span><br/><span data-ttu-id="6b327-408">Einfacheres Umgestalten von Code</span><span class="sxs-lookup"><span data-stu-id="6b327-408">Easier to refactor code</span></span><br/><span data-ttu-id="6b327-409">Auffindbarkeit: Zentrale Codeansicht</span><span class="sxs-lookup"><span data-stu-id="6b327-409">Discoverability - single view of the code</span></span><br/> | <span data-ttu-id="6b327-410">Eindeutige Eigentümerschaft pro Team</span><span class="sxs-lookup"><span data-stu-id="6b327-410">Clear ownership per team</span></span><br/><span data-ttu-id="6b327-411">Potenziell weniger Zusammenführungskonflikte</span><span class="sxs-lookup"><span data-stu-id="6b327-411">Potentially fewer merge conflicts</span></span><br/><span data-ttu-id="6b327-412">Unterstützung bei der Durchsetzung der Entkopplung von Microservices</span><span class="sxs-lookup"><span data-stu-id="6b327-412">Helps to enforce decoupling of microservices</span></span> |
| <span data-ttu-id="6b327-413">**Herausforderungen**</span><span class="sxs-lookup"><span data-stu-id="6b327-413">**Challenges**</span></span> | <span data-ttu-id="6b327-414">Änderungen an freigegebenem Code können sich auf mehrere Microservices auswirken</span><span class="sxs-lookup"><span data-stu-id="6b327-414">Changes to shared code can affect multiple microservices</span></span><br/><span data-ttu-id="6b327-415">Höheres Potenzial für Zusammenführungskonflikte</span><span class="sxs-lookup"><span data-stu-id="6b327-415">Greater potential for merge conflicts</span></span><br/><span data-ttu-id="6b327-416">Tools müssen auf große Codebasis skaliert werden</span><span class="sxs-lookup"><span data-stu-id="6b327-416">Tooling must scale to a large code base</span></span><br/><span data-ttu-id="6b327-417">Zugriffssteuerung</span><span class="sxs-lookup"><span data-stu-id="6b327-417">Access control</span></span><br/><span data-ttu-id="6b327-418">Komplexerer Bereitstellungsprozess</span><span class="sxs-lookup"><span data-stu-id="6b327-418">More complex deployment process</span></span> | <span data-ttu-id="6b327-419">Schwierigere Codefreigabe</span><span class="sxs-lookup"><span data-stu-id="6b327-419">Harder to share code</span></span><br/><span data-ttu-id="6b327-420">Schwierigeres Durchsetzen von Codierungsstandards</span><span class="sxs-lookup"><span data-stu-id="6b327-420">Harder to enforce coding standards</span></span><br/><span data-ttu-id="6b327-421">Verwaltung von Abhängigkeiten</span><span class="sxs-lookup"><span data-stu-id="6b327-421">Dependency management</span></span><br/><span data-ttu-id="6b327-422">Diffuse Codebasis, schlechte Auffindbarkeit</span><span class="sxs-lookup"><span data-stu-id="6b327-422">Diffuse code base, poor discoverability</span></span><br/><span data-ttu-id="6b327-423">Mangel an freigegebener Infrastruktur</span><span class="sxs-lookup"><span data-stu-id="6b327-423">Lack of shared infrastructure</span></span>

<span data-ttu-id="6b327-424">In diesem Abschnitt wird ein möglicher CI/CD-Workflow veranschaulicht, der auf den folgenden Annahmen basiert:</span><span class="sxs-lookup"><span data-stu-id="6b327-424">In this section, we present a possible CI/CD workflow, based on the following assumptions:</span></span>

- <span data-ttu-id="6b327-425">Für das Coderepository wird der Monorepo-Ansatz genutzt, und die Ordner sind nach Microservice organisiert.</span><span class="sxs-lookup"><span data-stu-id="6b327-425">The code repository is monorepo, with folders organized by microservice.</span></span>
- <span data-ttu-id="6b327-426">Die Branchstrategie des Teams basiert auf der [Trunk-basierten Entwicklung](https://trunkbaseddevelopment.com/).</span><span class="sxs-lookup"><span data-stu-id="6b327-426">The team's branching strategy is based on [trunk-based development](https://trunkbaseddevelopment.com/).</span></span>
- <span data-ttu-id="6b327-427">Das Team nutzt [Azure Pipelines](/azure/devops/pipelines), um den CI/CD-Prozess auszuführen.</span><span class="sxs-lookup"><span data-stu-id="6b327-427">The team uses [Azure Pipelines](/azure/devops/pipelines) to run the CI/CD process.</span></span>
- <span data-ttu-id="6b327-428">Das Team verwendet [Namespaces](/azure/container-registry/container-registry-best-practices#repository-namespaces) in Azure Container Registry, um Images, die bereits für die Produktion genehmigt wurden, von den noch in der Testphase befindlichen Images zu isolieren.</span><span class="sxs-lookup"><span data-stu-id="6b327-428">The team uses [namespaces](/azure/container-registry/container-registry-best-practices#repository-namespaces) in Azure Container Registry to isolate images that are approved for production from images that are still being tested.</span></span>

<span data-ttu-id="6b327-429">In diesem Beispiel arbeitet ein Entwickler an einem Microservice mit dem Namen „Delivery Service“ (Lieferdienst).</span><span class="sxs-lookup"><span data-stu-id="6b327-429">In this example, a developer is working on a microservice called Delivery Service.</span></span> <span data-ttu-id="6b327-430">(Der Name stammt aus der Referenzimplementierung, die [hier](../../microservices/index.md#the-drone-delivery-application) beschrieben ist.) Beim Entwickeln eines neuen Features checkt der Entwickler Code in einen Featurebranch ein.</span><span class="sxs-lookup"><span data-stu-id="6b327-430">(The name comes from the reference implementation described [here](../../microservices/index.md#the-drone-delivery-application).) While developing a new feature, the developer checks code into a feature branch.</span></span>

![CI/CD-Workflow](./_images/aks-cicd-1.png)

<span data-ttu-id="6b327-432">Wenn Commits per Pushvorgang an diesen Branch übertragen werden, wird ein CI-Build für den Microservice ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="6b327-432">Pushing commits to this branch tiggers a CI build for the microservice.</span></span> <span data-ttu-id="6b327-433">Für Featurebranches wird die Benennungskonvention `feature/*` verwendet.</span><span class="sxs-lookup"><span data-stu-id="6b327-433">By convention, feature branches are named `feature/*`.</span></span> <span data-ttu-id="6b327-434">Die [Builddefinitionsdatei](/azure/devops/pipelines/yaml-schema) enthält einen Trigger, der nach dem Branchnamen und dem Quellpfad filtert.</span><span class="sxs-lookup"><span data-stu-id="6b327-434">The [build definition file](/azure/devops/pipelines/yaml-schema) includes a trigger that filters by the branch name and the source path.</span></span> <span data-ttu-id="6b327-435">Mit diesem Ansatz kann jedes Team über eine eigene Buildpipeline verfügen.</span><span class="sxs-lookup"><span data-stu-id="6b327-435">Using this approach, each team can have its own build pipeline.</span></span>

```yaml
trigger:
  batch: true
  branches:
    include:
    - master
    - feature/*

    exclude:
    - feature/experimental/*

  paths:
     include:
     - /src/shipping/delivery/
```

<span data-ttu-id="6b327-436">An diesem Punkt des Workflows führt der CI-Build eine Codeüberprüfung mit minimalem Umfang durch:</span><span class="sxs-lookup"><span data-stu-id="6b327-436">At this point in the workflow, the CI build runs some minimal code verification:</span></span>

1. <span data-ttu-id="6b327-437">Erstellen des Codes</span><span class="sxs-lookup"><span data-stu-id="6b327-437">Build code</span></span>
1. <span data-ttu-id="6b327-438">Ausführen von Komponententests</span><span class="sxs-lookup"><span data-stu-id="6b327-438">Run unit tests</span></span>

<span data-ttu-id="6b327-439">Hierbei werden die Buildzeiten kurz gehalten, damit der Entwickler schnell Feedback erhält.</span><span class="sxs-lookup"><span data-stu-id="6b327-439">The idea here is to keep the build times short so the developer can get quick feedback.</span></span> <span data-ttu-id="6b327-440">Wenn das Feature für die Zusammenführung mit dem Master bereit ist, öffnet der Entwickler einen PR-Vorgang.</span><span class="sxs-lookup"><span data-stu-id="6b327-440">When the feature is ready to merge into master, the developer opens a PR.</span></span> <span data-ttu-id="6b327-441">Hierdurch wird ein weiterer CI-Build ausgelöst, bei dem einige zusätzliche Überprüfungen durchgeführt werden:</span><span class="sxs-lookup"><span data-stu-id="6b327-441">This triggers another CI build that performs some additional checks:</span></span>

1. <span data-ttu-id="6b327-442">Erstellen des Codes</span><span class="sxs-lookup"><span data-stu-id="6b327-442">Build code</span></span>
1. <span data-ttu-id="6b327-443">Durchführen von Komponententests</span><span class="sxs-lookup"><span data-stu-id="6b327-443">Run unit tests</span></span>
1. <span data-ttu-id="6b327-444">Erstellen des Runtime-Containerimages</span><span class="sxs-lookup"><span data-stu-id="6b327-444">Build the runtime container image</span></span>
1. <span data-ttu-id="6b327-445">Durchführen von Überprüfungen auf Sicherheitsrisiken für das Image</span><span class="sxs-lookup"><span data-stu-id="6b327-445">Run vulnerability scans on the image</span></span>

![CI/CD-Workflow](./_images/aks-cicd-2.png)

> [!NOTE]
> <span data-ttu-id="6b327-447">In Azure Repos können Sie [Richtlinien](/azure/devops/repos/git/branch-policies) zum Schützen von Branches definieren.</span><span class="sxs-lookup"><span data-stu-id="6b327-447">In Azure Repos, you can define [policies](/azure/devops/repos/git/branch-policies) to protect branches.</span></span> <span data-ttu-id="6b327-448">Für die Richtlinie sind beispielsweise ggf. ein erfolgreicher CI-Build sowie eine Genehmigung eines Prüfers erforderlich, damit die Zusammenführung mit dem Master erfolgen kann.</span><span class="sxs-lookup"><span data-stu-id="6b327-448">For example, the policy could require a successful CI build plus a sign-off from an approver in order to merge into master.</span></span>

<span data-ttu-id="6b327-449">An einem bestimmten Punkt ist das Team zum Bereitstellen einer neuen Version des Lieferdiensts bereit.</span><span class="sxs-lookup"><span data-stu-id="6b327-449">At some point, the team is ready to deploy a new version of the Delivery service.</span></span> <span data-ttu-id="6b327-450">Hierzu erstellt der Release Manager einen Branch vom Master, indem er das folgende Benennungsmuster verwendet: `release/<microservice name>/<semver>`.</span><span class="sxs-lookup"><span data-stu-id="6b327-450">To do so, the release manager creates a branch from master with this naming pattern: `release/<microservice name>/<semver>`.</span></span> <span data-ttu-id="6b327-451">Beispiel: `release/delivery/v1.0.2`.</span><span class="sxs-lookup"><span data-stu-id="6b327-451">For example, `release/delivery/v1.0.2`.</span></span>
<span data-ttu-id="6b327-452">Hierdurch wird ein vollständiger CI-Buildvorgang ausgelöst, bei dem alle obigen Schritte und zusätzlich die folgenden Schritte ausgeführt werden:</span><span class="sxs-lookup"><span data-stu-id="6b327-452">This triggers a full CI build that runs all the previous steps plus:</span></span>

1. <span data-ttu-id="6b327-453">Übertragen des Docker-Images an Azure Container Registry per Pushvorgang.</span><span class="sxs-lookup"><span data-stu-id="6b327-453">Push the Docker image to Azure Container Registry.</span></span> <span data-ttu-id="6b327-454">Das Image wird mit der Versionsnummer aus dem Branchnamen versehen.</span><span class="sxs-lookup"><span data-stu-id="6b327-454">The image is tagged with the version number taken from the branch name.</span></span>
2. <span data-ttu-id="6b327-455">Ausführen von `helm package` zum Verpacken des Helm-Diagramms</span><span class="sxs-lookup"><span data-stu-id="6b327-455">Run `helm package` to package the Helm chart</span></span>
3. <span data-ttu-id="6b327-456">Übertragen des Helm-Pakets an Container Registry, indem `az acr helm push` ausgeführt wird</span><span class="sxs-lookup"><span data-stu-id="6b327-456">Push the Helm package to Container Registry by running `az acr helm push`.</span></span>

<span data-ttu-id="6b327-457">Wenn dieser Buildvorgang erfolgreich ist, wird mithilfe einer [Releasepipeline](/azure/devops/pipelines/release/what-is-release-management) von Azure Pipelines ein Bereitstellungsprozess ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="6b327-457">Assuming this build succeeds, it triggers a deployment process using an Azure Pipelines [release pipeline](/azure/devops/pipelines/release/what-is-release-management).</span></span> <span data-ttu-id="6b327-458">Diese Pipeline</span><span class="sxs-lookup"><span data-stu-id="6b327-458">This pipeline</span></span>

1. <span data-ttu-id="6b327-459">Führen Sie `helm upgrade` aus, um das Helm-Diagramm in einer Umgebung für die Qualitätssicherung bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="6b327-459">Run `helm upgrade` to deploy the Helm chart to a QA environment.</span></span>
1. <span data-ttu-id="6b327-460">Eine genehmigende Person meldet sich ab, bevor das Paket für die Produktion bereitgestellt wird.</span><span class="sxs-lookup"><span data-stu-id="6b327-460">An approver signs off before the package moves to production.</span></span> <span data-ttu-id="6b327-461">Weitere Informationen finden Sie unter [Release deployment control using approvals](/azure/devops/pipelines/release/approvals/approvals) (Steuerung von Releasebereitstellungen durch Genehmigungen).</span><span class="sxs-lookup"><span data-stu-id="6b327-461">See [Release deployment control using approvals](/azure/devops/pipelines/release/approvals/approvals).</span></span>
1. <span data-ttu-id="6b327-462">Versehen Sie das Docker-Image für den Produktionsnamespace in Azure Container Registry mit einem neuen Tag.</span><span class="sxs-lookup"><span data-stu-id="6b327-462">Re-tag the Docker image for the production namespace in Azure Container Registry.</span></span> <span data-ttu-id="6b327-463">Wenn das derzeitige Tag beispielsweise `myrepo.azurecr.io/delivery:v1.0.2` lautet, lautet das Tag für die Produktion `myrepo.azurecr.io/prod/delivery:v1.0.2`.</span><span class="sxs-lookup"><span data-stu-id="6b327-463">For example, if the current tag is `myrepo.azurecr.io/delivery:v1.0.2`, the production tag is `myrepo.azurecr.io/prod/delivery:v1.0.2`.</span></span>
1. <span data-ttu-id="6b327-464">Führen Sie `helm upgrade` aus, um das Helm-Diagramm für die Produktionsumgebung bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="6b327-464">Run `helm upgrade` to deploy the Helm chart to the production environment.</span></span>

![CI/CD-Workflow](./_images/aks-cicd-3.png)

<span data-ttu-id="6b327-466">Es ist wichtig, Folgendes zu beachten: Auch beim Monorepo-Ansatz können diese Aufgaben einzelnen Microservices zugeordnet werden, damit die Teams Bereitstellungen schneller durchführen können.</span><span class="sxs-lookup"><span data-stu-id="6b327-466">It's important to remember that even in a monorepo, these tasks can be scoped to individual microservices, so that teams can deploy with high velocity.</span></span> <span data-ttu-id="6b327-467">Dieser Prozess umfasst einige manuelle Schritte: Genehmigen von PRs, Erstellen von Releasebranches und Genehmigen von Bereitstellungen im Produktionscluster.</span><span class="sxs-lookup"><span data-stu-id="6b327-467">There are some manual steps in the process: Approving PRs, creating release branches, and approving deployments into the production cluster.</span></span> <span data-ttu-id="6b327-468">Der Richtlinie nach sind dies manuelle Schritte, aber sie können auch vollständig automatisiert werden, falls die Organisation dies vorzieht.</span><span class="sxs-lookup"><span data-stu-id="6b327-468">These steps are manual by policy &mdash; they could be completely automated if the organization prefers.</span></span>
