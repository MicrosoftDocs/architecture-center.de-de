---
title: Allgemeiner Leitfaden zum Wiederholen von Vorgängen
description: Anleitungen für die Vorgangswiederholung zur Behandlung vorübergehender Fehler.
author: dragon119
ms.date: 07/13/2016
pnp.series.title: Best Practices
ms.openlocfilehash: 9562e3447b2219fe2f3df96cfca24b845efa39b0
ms.sourcegitcommit: c53adf50d3a787956fc4ebc951b163a10eeb5d20
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 11/23/2017
ms.locfileid: "25545977"
---
# <a name="transient-fault-handling"></a>Behandeln vorübergehender Fehler

[!INCLUDE [header](../_includes/header.md)]

Alle Anwendungen, die mit Remotediensten und Ressourcen kommunizieren, müssen gegenüber vorübergehenden Fehlern empfindlich sein. Dies gilt insbesondere für Anwendungen, die in der Cloud ausgeführt werden und die Art der Umgebung und Konnektivität über das Internet bedeuten, dass diese Typen von Fehlern häufiger auftreten können. Vorübergehende Fehler umschließen den vorübergehenden Verlust der Netzwerkkonnektivität mit Komponenten und Diensten, die vorübergehende Nichtverfügbarkeit eines Diensts oder Timeouts, die auftreten, wenn ein Dienst ausgelastet ist. Diese Fehler werden häufig automatisch behoben und wenn die Aktion nach einer angemessenen Verzögerung wiederholt wird, wird sie wahrscheinlich erfolgreich ausgeführt werden.

Dieses Dokument bietet einen allgemeinen Leitfaden zum Behandeln vorübergehender Fehler. Informationen zur Behandlung von vorübergehenden Fehlern bei Verwendung von Microsoft Azure-Diensten finden Sie unter [Dienstspezifische Azure-Wiederholungsrichtlinien](./retry-service-specific.md).

## <a name="why-do-transient-faults-occur-in-the-cloud"></a>Warum treten vorübergehende Fehler in der Cloud auf?
Vorübergehende Fehler können in jeder Umgebung auf jeder Plattform und jedem Betriebssystem und bei jeder Anwendung auftreten. Bei Lösungen, die über eine lokale Infrastruktur laufen, werden Leistung und Verfügbarkeit der Anwendung sowie ihre Komponenten in der Regel durch teure und häufig zu selten genutzte Hardware-Redundanz verwaltet und die Komponenten und Ressourcen befinden sich nah beieinander. Während dadurch zwar die Wahrscheinlichkeit eines Fehlers verringert wird, kann dies dennoch zu vorübergehenden Fehler führen - und sogar zu einem Ausfall durch unvorhergesehene Ereignisse, wie z. B. Probleme mit der externen Stromversorgung und Netzwerken oder durch andere Notfallszenarien.

Cloud-Hosting, einschließlich privater Cloud-Systeme, kann eine höhere allgemeine Verfügbarkeit bieten, und zwar durch Verwenden gemeinsamer Ressourcen, Redundanz, automatisches Failover und dynamische Zuordnung von Ressourcen über eine große Anzahl herkömmlicher Compute-Knoten. Die Art dieser Umgebungen kann jedoch bedeuten, dass ein Auftreten vorübergehender Fehler wahrscheinlicher ist. Dafür gibt es mehrere Gründe:

* Viele Ressourcen in einer Cloud-Umgebung werden gemeinsam genutzt und der Zugriff auf diese Ressourcen unterliegt einer bestimmten Einschränkung, um die Ressource zu schützen. Wenn die Auslastung auf eine bestimmte Ebene steigt oder eine maximale Durchsatzrate erreicht wird, werden einige Dienste Verbindungen verweigern, um die Verarbeitung von vorhandenen Anforderungen zu ermöglichen und die Leistung des Dienstes für alle Benutzer zu wahren. Die Drosselung trägt dazu bei, die Qualität des Dienstes für Nachbarn und andere Mandanten, die die gemeinsamen Ressource nutzen, beizubehalten.
* Cloud-Umgebungen basieren auf einer sehr großen Anzahl herkömmlicher Hardware-Einheiten. Sie bieten Leistung, indem sie die die Last dynamisch über mehrere Computer-Einheiten und Infrastrukturkomponenten verteilen, und arbeiten zuverlässig, indem sie fehlerhafte Einheiten automatisch wiederverwerten oder austauschen. Diese Dynamik bedeutet, dass vorübergehende Fehler und temporäre Verbindungsfehler gelegentlich auftreten können.
* Es gibt häufig weitere Hardwarekomponenten, einschließlich der Netzwerkinfrastruktur, wie z. B. Router und Load Balancers, zwischen der Anwendung und den Ressourcen sowie Diensten, die sie verwendet. Diese zusätzliche Infrastruktur kann gelegentlich zu zusätzlicher Verbindungslatenz und vorübergehenden Verbindungsfehlern führen.
* Die Netzwerkbedingungen zwischen dem Client und dem Server sind möglicherweise variabel, insbesondere wenn die Kommunikation über das Internet läuft. Auch in lokalen Standorten kann sehr starker Datenverkehr die Kommunikation verlangsamen und dazu führen, dass zeitweise Verbindungsfehler auftreten.

## <a name="challenges"></a>Herausforderungen
Vorübergehende Fehler können eine enorme Auswirkung auf die empfundene Verfügbarkeit einer Anwendung haben, selbst wenn diese unter allen vorhersehbaren Umständen gründlich getestet wurde. Um sicherzustellen, dass Cloud-gehostete Anwendungen zuverlässig ausgeführt werden, müssen sie auf die folgenden Herausforderungen reagieren können:

* Die Anwendung muss in der Lage sein, Fehler zu entdecken, sobald diese auftreten, und bestimmen können, ob diese Fehler eher vorübergehende, lang andauernde oder terminale Fehler sind. Verschiedene Ressourcen senden wahrscheinlich unterschiedliche Antworten zurück, wenn ein Fehler auftritt, und diese Antworten können je nach Kontext des Vorgangs auch variieren. Beispielsweise kann sich die Antwort für einen Fehler beim Lesen aus dem Speicher von einer Antwort für einen Fehler beim Schreiben in den Speicher unterscheiden. Viele Ressourcen und Dienste verfügen über gut dokumentierte vorübergehende Fehlerverträge. Wenn derartige Informationen jedoch nicht verfügbar sind, ist es möglicherweise schwierig, die Art des Fehlers zu ermitteln, und ob er wahrscheinlich vorübergehend ist.
* Die Anwendung muss in der Lage sein, den Vorgang zu wiederholen, wenn festgestellt wird, dass der Fehler wahrscheinlich vorübergehend ist, sowie die Anzahl der Wiederholungsversuche für der Vorgang verfolgen können.
* Die Anwendung muss eine geeignete Strategie für die Wiederholungen verwenden. Diese Strategie gibt die Anzahl der Wiederholungsversuche, die Verzögerung zwischen jedem Versuch und die Aktionen an, die nach jedem fehlgeschlagenen Versuch vorzunehmen sind. Die entsprechende Anzahl der Versuche und die Verzögerung zwischen jedem einzelnen sind oft schwierig zu bestimmen und variieren basierend auf der Art der Anwendung sowie auf den aktuellen Betriebsbedingungen der Ressource und der Anwendung selbst.

## <a name="general-guidelines"></a>Allgemeine Richtlinien
Die folgenden Richtlinien werden Ihnen helfen, für Ihre Anwendungen einen geeigneten Mechanismus zum Behandeln von vorübergehenden Fehlern zu entwerfen:

* **Bestimmen Sie, ob ein integrierter Wiederholungsmechanismus vorhanden ist:**
  * Viele Dienste bieten eine SDK oder Client-Bibliothek, die einen Behandlungsmechanismus für vorübergehende Fehler enthält. Die von ihm verwendete Wiederholungsrichtlinie ist in der Regel auf die Art und die Anforderungen des Zieldienstes zugeschnitten. Alternativ können REST-Schnittstellen für Dienste auch Informationen zurückgeben, die hilfreich sind, um zu bestimmen, ob eine Wiederholung angemessen ist und wie lange vor dem nächsten Wiederholungsversuch gewartet werden sollte.
  * Verwenden Sie den integrierten Wiederholungsmechanismus, wenn einer verfügbar ist, es sei denn, Sie haben bestimmte und altbewährte Anforderungen, für die ein anderes Wiederholungsverhalten besser geeignet ist.
* **Bestimmen Sie, ob der Vorgang für die Wiederholung geeignet ist**:
  * Sie sollten Vorgänge nur bei vorübergehenden Fehlern wiederholen (in der Regel durch die Art des Fehlers angegeben) und wenn zumindest eine gewisse Wahrscheinlichkeit besteht, dass der Vorgang bei einem erneuten Versuch erfolgreich ist. Es ist ziemlich sinnlos Vorgänge erneut zu versuchen, die einen ungültigen Vorgang angeben, wie z. B. eine Datenbank-Aktualisierung für ein Element, das nicht  vorhanden ist, oder Anforderungen an einen Dienst oder eine Ressource, bei dem/der ein schwerwiegender aufgetreten ist.
  * Im Allgemeinen sollten Sie Wiederholungen nur implementieren, wenn die vollständige Auswirkung bestimmt werden kann, und die Bedingungen gut verstanden und überprüft werden können. Wenn dies nicht der Fall ist, überlassen Sie es dem aufrufenden Code, Wiederholungen zu implementieren. Denken Sie daran, dass sich die von Ressourcen und Diensten zurückgesendeten Fehler außerhalb Ihrer Kontrolle im Laufe der Zeit weiterentwickeln können und Sie dementsprechend womöglich Ihre Logik zur Erkennung vorübergehender Fehler überdenken müssen.
  * Wenn Sie Dienste oder Komponenten erstellen, dann ziehen Sie in Betracht, Fehlercodes und -meldungen zu implementieren, die Clients helfen werden, zu bestimmen, ob sie fehlgeschlagene Vorgänge wiederholen sollten oder nicht. Insbesondere sollten Sie angeben, ob der Client den Vorgang wiederholen (vielleicht durch Rückgabe eines **IsTransient** -Werts) und eine geeignete Verzögerung vor dem nächsten Wiederholungsversuch vorschlagen sollte. Wenn Sie einen Webdienst erstellen, sollten Sie erwägen, benutzerdefinierte Fehler zurückzusenden, die in Ihren Serviceverträgen definiert sind. Auch wenn generische Clients diese womöglich nicht lesen können, werden sie beim Erstellen von benutzerdefinierten Clients nützlich sein.
* **Bestimmen Sie eine geeignete Wiederholungsanzahl und ein dementsprechendes Intervall:**
  * Es ist wichtig, die Anzahl der Wiederholungsversuche und das Intervall dem Typ des Anwendungsfalls entsprechend zu optimieren. Wenn Sie zu wenige Wiederholungsversuche vornehmen, ist die Anwendung nicht in der Lage, den Vorgang abzuschließen und es wird wahrscheinlich ein Fehler auftreten. Wenn Sie zu viele Wiederholungsversuche vornehmen oder die Intervalle zwischen den einzelnen Versuchen zu kurz sind, kann die Anwendung potenziell Ressourcen enthalten wie z. B. Threads, Verbindungen und Speicher für lange Zeiträume, die sich negativ auf die Integrität der Anwendung auswirken.
  * Die angemessenen Werte für das Zeitintervall und die Anzahl der Wiederholungsversuche hängen von der Art des versuchten Vorgangs ab. Wenn der Vorgang beispielsweise Teil einer Benutzerinteraktion ist, sollte das Intervall kurz sein und es sollten nur wenige Wiederholungsversuche unternommen werden, um zu verhindern, dass Benutzer auf eine Antwort warten müssen (was Verbindungen offen hält und die Verfügbarkeit für andere Benutzer verringern kann). Wenn der Vorgang Teil eines langen oder kritischen Workflows ist, für den ein Abbrechen oder Neustarten des Prozesses teuer oder zeitaufwändig ist, ist es angebracht, zwischen den Versuchen länger zu warten und den Vorgang öfter zu wiederholen.
  * Bestimmen der geeigneten Intervalle zwischen Wiederholungen ist der schwierigste Teil beim Entwerfen einer erfolgreichen Strategie. Typische Strategien verwenden die folgenden Typen von Wiederholungsintervallen:
    * **Exponentielles Backoff**. Die Anwendung wartet vor dem ersten Wiederholungsversuch kurz und verlängert dann exponentiell die Abstände zwischen jedem nachfolgenden Wiederholungsintervall. Z. B. wird der Vorgang nach 3 Sekunden, 12 Sekunden, 30 Sekunden, usw. wiederholt.
    * **Inkrementelle Intervalle**. Die Anwendung wartet vor dem ersten Wiederholungsversuch kurz und verlängert dann inkrementell die Abstände zwischen jedem nachfolgenden Wiederholungsintervall. Z. B. wird der Vorgang nach 3 Sekunden, 7 Sekunden, 13 Sekunden, usw. wiederholt.
    * **Regelmäßige Intervalle**. Die Anwendung wartet zwischen jedem Versuch gleich lang. Beispielsweise wird der Vorgang alle 3 Sekunden wiederholt.
    * **Sofortiger Wiederholungsversuch**. Manchmal ist ein vorübergehender Fehler sehr kurz, vielleicht durch ein Ereignis verursacht, wie z. B. einen Netzwerk-Paket-Konflikt oder einen Spike in einer Hardwarekomponente. In diesem Fall ist das sofortige Wiederholen des Vorgangs geeignet, da dies erfolgreich sein kann, wenn der Fehler in der Zeit behoben wurde, die die Anwendung benötigt, um die nächste Anforderung zusammenzustellen und zu senden. Allerdings sollte nie mehr als ein sofortiger Wiederholungsversuch unternommen werden und Sie sollten auf alternative Strategien zurückgreifen, wie z. B. exponentielles Backoff oder Fallback-Aktionen, wenn die sofortige Wiederholung fehlschlägt.
    * **Zufällige Anordnung**. Jeder der zuvor erwähnten Strategien kann zufällige Anordnung umschließen, um zu verhindern, dass mehrere Instanzen des Client zur gleichen Zeit weitere Wiederholungsversuche senden. Beispielsweise kann eine Instanz den Vorgang nach 3 Sekunden, 11 Sekunden, 28 Sekunden usw. wiederholen, während eine andere Instanz den Vorgang nach 4 Sekunden, 12 Sekunden, 26 Sekunden usw. wiederholen kann. Die zufällige Anordnung ist eine nützliche Technik, die mit anderen Strategien kombiniert werden kann.  
  * Verwenden Sie als allgemeine Richtlinie eine exponentielle Backoff-Strategie für Hintergrundoperationen und sofortige oder regelmäßige Intervall-Wiederholungsstrategien für interaktive Vorgänge. In beiden Fällen sollten Sie die Verzögerung und die Anzahl der Wiederholungsversuche so auswählen, dass die die maximale Latenz für alle Wiederholungsversuche innerhalb der erforderlichen End-to-End-Latenzzeit liegt.
  * Berücksichtigen Sie die Kombination aller Faktoren, die zum maximalen Timeout für einen wiederholten Vorgang beitragen. Zu diesen Faktoren zählen die Zeit, die eine fehlgeschlagene Verbindung für eine Antwort benötigt (in der Regel durch einen Timeoutwert auf dem Client festgelegt), sowie die Verzögerung zwischen den Wiederholungsversuchen und die maximale Anzahl von Wiederholungen. Die Gesamtdauer kann zu einer sehr langen Gesamtvorgangszeit führen, insbesondere wenn eine exponentielle Verzögerungsstrategie verwendet wird, bei der die Intervalle zwischen Wiederholungen nach jedem Fehler größer werden. Wenn ein Prozess eine bestimmte Vereinbarung zum Servicelevel (SLA) erfüllen muss, muss die Gesamtvorgangszeit, einschließlich aller Timeouts und Verzögerungen, innerhalb der im SLA definierten liegen.
  * Überaggressive Wiederholungsstrategien, die zu kurze Intervalle haben oder zu viele Wiederholungen vorsehen, können sich negativ auf die Zielressource oder den Zieldienst auswirken. Das kann verhindern, dass sich die Ressource oder der Dienst von ihrer/seiner Überlastung erholen kann, wodurch er/sie weiterhin die Anforderungen blockieren oder ablehnen wird. Dies führt zu einem Teufelskreis, in dem mehr und mehr Anforderungen an die Ressource oder den Dienst gesendet werden, und somit die Möglichkeit zur Wiederherstellung weiter reduziert wird.
  * Berücksichtigen Sie das Timeout der Vorgänge bei der Auswahl der Wiederholungsintervalle, um zu vermeiden, sofort einen weiteren Versuch zu starten (z. B. wenn der Timeout-Zeitraum dem Wiederholungsintervall entspricht). Überlegen Sie auch, ob Sie den insgesamt möglichen Zeitraum (das Zeitlimit plus die Wiederholungsintervalle) unter einer bestimmten Gesamtzeit behalten müssen. Vorgänge, die ungewöhnlich kurze oder sehr lange Timeouts haben, können die Wartezeit und die Anzahl der Wiederholungsversuche für den Vorgang beeinflussen.
  * Verwenden Sie den Typ der Ausnahme und alle darin enthaltenen Daten oder die Fehlercodes und Meldungen, die vom Dienst zurückgegeben werden, um das Intervall und die Anzahl von Wiederholungen zu optimieren. Zum Beispiel können einige Ausnahmen oder Fehlercodes (wie HTTP-Code 503 „Dienst nicht verfügbar“ mit einem Retry-After-Header in der Antwort) angeben, wie lange der Fehler dauern kann, oder dass der Dienst ausgefallen ist und nicht auf einen anschließenden Versuch reagieren wird.
* **Vermeiden Sie Antimuster**
  * In den meisten Fällen sollten Sie Implementierungen vermeiden, die duplizierte Ebenen des Wiederholungscodes enthalten. Vermeiden Sie Entwürfe, die kaskadierende Wiederholungsmechanismen enthalten oder in jeder Phase eines Vorgangs, der eine Hierarchie von Anforderungen umschließt, eine Wiederholung implementieren, es sei denn, Sie haben spezielle Anforderungen, die dies erfordern. Verwenden Sie unter diesen besonderen Umständen Richtlinien, die eine übertriebene Anzahl an Wiederholungen und Verzögerungszeiträumen verhindern, und stellen Sie sicher, dass Sie die Folgen kennen. Wenn eine Komponente beispielsweise eine Anforderung an eine andere stellt, die dann auf den Zieldienst zugreift, und Sie für beide Aufrufe eine Wiederholung auf drei implementieren, dann gibt es insgesamt neun Wiederholungsversuche für den Dienst. Viele Dienste und Ressourcen implementieren einen integrierten Wiederholungsmechanismus und Sie sollten nachforschen, wie Sie diesen deaktivieren oder ändern können, wenn Wiederholungen auf einer höheren Ebene implementiert werden müssen.
  * Implementieren Sie niemals einen endlosen Wiederholungsmechanismus. Dadurch wird wahrscheinlich verhindert, dass eine Überladung der Ressource oder des Diensts  ausgeglichen wird, und kann zu einer Drosselung und Verbindungsverweigerung über einen längeren Zeitraum hinweg führen. Verwenden Sie eine endliche Anzahl oder Wiederholungen oder implementieren Sie ein Muster, z.B. einen [Schaltkreisunterbrecher](http://msdn.microsoft.com/library/dn589784.aspx), damit der Dienst wiederhergestellt werden kann.
  * Führen Sie nie öfter als einmal eine sofortige Wiederholung durch.
  * Vermeiden Sie die Verwendung eines regulären Wiederholungsintervalls, insbesondere bei einer großen Anzahl von Wiederholungsversuchen, wenn Sie auf Dienste und Ressourcen in Azure zugreifen. Der optimale Ansatz ist eine exponentielle Backoff-Strategie mit einer schaltkreisunterbrechenden Funktion.
  * Vermeiden Sie, dass mehrere Instanzen desselben Client oder mehrere Instanzen verschiedener Clients zur gleichen Zeit Wiederholungen senden. Besteht dafür eine hohe Wahrscheinlichkeit, dann führen Sie eine zufällige Anordnung in die Wiederholungsintervalle ein.
* **Testen Sie Ihre Wiederholungsstrategie und die Implementierung:**
  * Stellen Sie sicher, dass Sie Ihre Wiederholungsstrategie unter so vielen Bedingungen wie möglich vollständig testen, insbesondere wenn die Anwendung und die Zielressourcen oder Zieldienste diese bei extremer Auslastung nutzen. Um das Verhalten während der Tests zu überprüfen, können Sie folgende Aktionen ausführen:
    * Vorübergehende und dauerhafte Fehler in den Dienst einfügen. Senden Sie beispielsweise ungültige Anforderungen oder fügen Sie einen Code hinzu, der Testanforderungen und Antworten mit unterschiedlichen Fehlerarten erkennt. Ein Beispiel für die Verwendung von TestApi finden Sie unter [Fault Injection Testing with TestApi](http://msdn.microsoft.com/magazine/ff898404.aspx) (Fehlereinschleusungstests mit TestApi) und [Introduction to TestApi – Part 5: Managed Code Fault Injection APIs](http://blogs.msdn.com/b/ivo_manolov/archive/2009/11/25/9928447.aspx) (Einführung in TestApi – Teil 5: APIs für die Fehlereinschleusung in verwalteten Code).
    * Täuschen Sie die Ressource oder den Dienst vor, die/der einen Bereich von Fehlern zurückgibt, die der tatsächliche Dienst womöglich zurückgeben wird. Stellen Sie sicher, dass Sie alle Arten von Fehler behandeln, die Ihre Wiederholungsstrategie erkennen soll.
    * Erzwingen Sie das Auftreten vorübergehender Fehler, indem Sie vorübergehend den Dienst deaktivieren, wenn der von Ihnen erstellte und bereitgestellte Dienst benutzerdefiniert ist (Sie sollten natürlich nicht freigegebene Ressourcen oder freigegebene Dienste innerhalb Azure überladen).
    * Für HTTP-basierte APIs sollten Sie in Erwägung ziehen, in Ihren automatisierten Tests die FiddlerCore-Bibliothek zu verwenden, um das Ergebnis der HTTP-Anforderungen durch Hinzufügen zusätzlicher Roundtrip-Zeiten oder durch Ändern der Antwort (z. B. den HTTP-Statuscode, Header, Text oder andere Faktoren) zu ändern. Dies ermöglicht das deterministische Testen einer Teilmenge der Fehlerbedingungen, egal ob vorübergehende Fehler oder andere Fehlertypen. Weitere Informationen finden Sie unter [FiddlerCore](http://www.telerik.com/fiddler/fiddlercore). Überprüfen Sie für Beispiele für die Verwendung der Bibliothek, insbesondere der **HttpMangler**-Klasse, den [Quellcode für Azure Storage SDK](https://github.com/Azure/azure-storage-net/tree/master/Test).
    * Führen Sie hohe Ladefaktor und gleichzeitige Tests durch, um sicherzustellen, dass der Wiederholungsmechanismus und die Strategie unter diesen Bedingungen ordnungsgemäß funktionieren und sich nicht nachteilig auf den Betrieb des Clients auswirken oder dazu führen, dass Kreuzkontaminationen zwischen Anforderungen entstehen.
* **Verwalten Sie die Konfigurationen von Wiederholungsrichtlinien:**
  * Eine *Wiederholungsrichtlinie* ist eine Kombination aller Elemente Ihrer Wiederholungsstrategie. Sie definiert den Erkennungsmechanismus, der bestimmt, ob ein Fehler wahrscheinlich vorübergehend ist, sowie den Typ des zu verwendenden Intervalls (z. B. regelmäßig, exponentielles Backoff und zufällige Anordnung), den/die tatsächlichen Intervallwert(e) und die Anzahl der Wiederholungen bestimmt.
  * Wiederholungen müssen selbst bei der einfachsten Anwendung an vielen Stellen sowie in jeder Ebene der komplexeren Anwendungen implementiert werden. Anstatt einer Hartcodierung der Elemente jeder einzelnen Richtlinien an mehreren Standorten sollten Sie in Erwägung ziehen, einen zentralen Punkt zum Speichern aller Richtlinien zu verwenden. Speichern Sie beispielsweise die Werte, wie die Intervalle und die Wiederholungsanzahl, in Anwendungskonfigurationsdateien, lesen Sie diese zur Laufzeit und erstellen Sie programmgesteuerte Wiederholungsrichtlinien. Dies erleichtert die Verwaltung der Einstellungen sowie die Änderung und die Anpassung der Werte, um auf sich ändernde Anforderungen und Szenarien zu reagieren. Entwerfen Sie jedoch das System, um die Werte zu speichern, statt jedes Mal eine Konfigurationsdatei neu zu lesen, und stellen Sie sicher, dass geeignete Standardwerte verwendet werden, wenn die Werte aus der Konfiguration nicht abgerufen werden können.
  * Bei einer Azure-Cloud-Dienste-Anwendung sollten Sie in Erwägung ziehen, die Werte zu speichern, mit denen die Wiederholungsrichtlinien zur Laufzeit in der Dienstkonfigurationsdatei erstellt werden, damit sie ohne Neustart der Anwendung geändert werden können.
  * Nutzen Sie integrierte oder standardmäßige Wiederholungsstrategien, die in den Client-APIs verfügbar sind, doch nur insofern sie sich für Ihr Szenario eignen. Diese Strategien sind in der Regel allgemein. Für einige Szenarien ist womöglich nichts weiter erforderlich, aber in anderen Szenarien bieten sie vielleicht nicht die gesamte Palette von Optionen an, die Ihre Anforderungen benötigen. Sie müssen verstehen, wie die Einstellungen Ihre Anwendung durch Tests beeinflussen wird, um die geeignetsten Werte zu bestimmen.
* **Melden Sie sich an und verfolgen Sie vorübergehende und dauerhafte Fehler:**
  * Schließen Sie als Teil Ihrer Wiederholungsstrategie die Ausnahmebehandlung und eine andere Instrumentation ein, die protokolliert, wenn Wiederholungsversuche erfolgen. Während ein gelegentlicher vorübergehender Fehler und Wiederholungsversuch zu erwarten sind und auf kein Problem verweisen, sind regelmäßige und zunehmende Wiederholungen häufig ein Hinweis auf ein Problem, das zu einem Fehler führen kann, oder wirken sich aktuell auf die Leistung und Verfügbarkeit aus.
  * Protokollieren Sie vorübergehende Fehler als Warnungs- statt Fehlereinträge, damit Überwachungssysteme diese nicht als Anwendungsfehler erkennen, die womöglich falsche Warnungen auslösen.
  * Überlegen Sie einen Wert in Ihren Protokolleinträgen zu speichern, der angibt, ob die Wiederholungen durch Drosselung des Diensts oder andere Fehlerarten verursacht wurden, wie z. B. Verbindungsfehler, sodass Sie diese während der Datenanalyse unterscheiden können.   Eine Zunahme der Anzahl der Drosselungsfehler ist häufig ein Hinweis auf einen Designfehler in der Anwendung oder auf die Notwendigkeit, zu einem Premium-Dienst zu wechseln, der dedizierte Hardware bietet.  
  * Überlegen Sie die Gesamtzeit zu messen und zu protokollieren, die für Vorgänge benötigt wurden, die einen Wiederholungsmechanismus enthalten. Dies ist ein guter Indikator für die Gesamtauswirkung der vorübergehenden Fehler auf die Antwortzeiten der Benutzer, Prozess-Latenz und die Effizienz der Anwendungsfälle der Anwendung. Protokollieren Sie auch die Anzahl der aufgetretenen Wiederholungen, um die Faktoren zu verstehen, die die Antwortzeit beeinflusst haben.
  * Ziehen Sie das Implementieren einer Telemetrie und eines Überwachungssystems in Betracht, das Warnungen auslöst, wenn die Zahl und Rate von Fehlern, die durchschnittliche Anzahl von Wiederholungen oder die für eine erfolgreiche Ausführung von Vorgängen benötigte Gesamtzeit zunimmt.
* **Verwalten Sie Vorgänge, die ständig fehlschlagen:**
  
  * Unter bestimmten Umständen wird der Vorgang weiterhin bei jedem Versuch fehlschlagen und es ist wichtig zu berücksichtigen, wie Sie mit dieser Situation umgehen:
    * Obwohl eine Wiederholungsstrategie definiert, wie oft ein Vorgang höchstens wiederholt werden sollte, verhindert sie nicht, dass die Anwendung den Vorgang mit der gleichen Anzahl an Wiederholungen erneut wiederholt. Schlägt beispielsweise ein Dienst zur Bestellverarbeitung mit einem schwerwiegendem Fehler fehl, der diesen Dienst dauerhaft außer Betrieb setzt, könnte die Wiederholungsstrategie ein Verbindungs-Timeout erkennen und dies als vorübergehenden Fehler betrachten. Der Code wird den Vorgang eine bestimmte Anzahl an Versuchen wiederholen und dann aufgeben. Wenn jedoch ein anderer Kunde eine Bestellung aufgibt, wird der Vorgang erneut versucht, obwohl er mit Sicherheit jedes Mal fehlschlagen wird.
    * Implementieren Sie das [Trennschalter-Muster](http://msdn.microsoft.com/library/dn589784.aspx), um die kontinuierliche Wiederholungen von Vorgängen zu vermeiden, die ständig fehlschlagen. In diesem Muster werden Anforderungen, wenn die Anzahl der Fehler in einem angegebenen Zeitfenster den Schwellenwert überschreitet, sofort an den Aufrufer als Fehler zurückgegeben, ohne zu versuchen, auf die ausgefallene Ressource oder den Dienst zuzugreifen.
    * Die Anwendung kann in regelmäßigen Abständen und mit langen Abständen zwischen den Intervallen den Dienst testen, um zu erkennen, wann er wieder verfügbar ist. Welches Intervall angemessen ist, hängt vom jeweiligen Szenario ab, wie z. B. die Kritikalität des Vorgangs und der Art des Diensts, und kann von wenigen Minuten bis mehreren Stunden dauern. An dem Punkt, wo der Test erfolgreich ist, kann die Anwendung normal fortgesetzt werden und Anforderungen an den wiederhergestellten Dienst übergeben.
    * In der Zwischenzeit kann es möglich sein, auf eine andere Instanz des Diensts (z. B. in einem anderen Datencenter oder eine Anwendung) zurückzugreifen, einen ähnlichen Dienst zu verwenden, der eine kompatible (vielleicht einfachere) Funktion bietet, oder einige alternative Vorgänge auszuführen, in der Hoffnung, dass der Dienst schnell wieder verfügbar wird. Es könnte beispielsweise angebracht sein, die Anforderungen für den Dienst in einer Warteschlange oder einem Datenspeicher zu speichern und sie später wiederzugeben. Andernfalls können Sie möglicherweise den Benutzer an eine andere Instanz leiten, die Leistung der Anwendung bei immer noch akzeptabler Funktion verschlechtern oder einfach eine Nachricht an den Benutzer zurückgeben, aus der hervorgeht, dass die Anwendung derzeit nicht verfügbar ist.
* **Weitere Überlegungen**
  
  * Wenn Sie die Werte für die Anzahl der Wiederholungen und die Wiederholungsintervalle für eine Richtlinie festlegen, sollten Sie bedenken, ob der Dienst oder die Ressource Teil eines lang andauernden oder aus mehreren Schritten bestehenden Vorgangs ist. Es kann schwierig oder teuer sein, alle anderen Verfahrensschritte zu kompensieren, die bereits erfolgreich abgeschlossen wurden, wenn einer fehlschlägt. In diesem Fall könnten ein sehr langes Intervall und eine große Anzahl von Wiederholungen akzeptabel sein, solange diese keine anderen Vorgänge blockieren, indem knappe Ressourcen zurückgehalten oder gesperrt werden.
  * Überlegen Sie, ob eine Wiederholung des gleichen Vorgangs zu inkonsistenten Daten führen könnte. Wenn einige Teile eines aus mehreren Schritten bestehenden Prozesses wiederholt werden und die Vorgänge nicht idempotent sind, kann dies zu einer Inkonsistenz führen. Beispielsweise erzeugt ein Vorgang, der bei Wiederholung einen Wert inkrementiert, ein ungültiges Ergebnis. Einen Vorgang zu wiederholen, der eine Nachricht an eine Warteschlange sendet, kann eine Inkonsistenz im Nachrichtenconsumer verursachen, wenn er doppelte Nachrichten nicht ermitteln kann. Um dies zu vermeiden, stellen Sie sicher, dass Sie jeden Schritt als idempotenten Vorgang entwerfen. Weitere Informationen zu Idempotenz finden Sie unter [Idempotenz-Muster][idempotency-patterns].
  * Berücksichtigen Sie den Bereich der Vorgänge, die wiederholt werden. Beispielsweise ist es möglicherweise einfacher, einen Wiederholungscode auf einer Ebene zu implementieren, die mehrere Vorgänge umfasst, und sie alle zu wiederholen, wenn einer fehlschlägt. Allerdings kann dies zu Idempotenz-Problemen oder unnötigen Rollback-Operationen führen.
  * Wenn Sie einen Wiederholungsbereich auswählen, der mehrere Vorgänge umfasst, berücksichtigen Sie die gesamte Latenz beim Bestimmen der Wiederholungsintervalle, beim Überwachen des Zeitaufwands und vor dem Auslösen von Warnungen vor Fehlern.
  * Beachten Sie, wie Ihre Wiederholungsstrategie Nachbarn und andere Mandanten in einer freigegebenen Anwendung beeinflussen kann, oder bei Verwendung von freigegebenen Ressourcen und Diensten. Aggressive Wiederholungsrichtlinien können für diese anderen Benutzer und für Anwendungen, die Ressourcen und Dienste teilen, vermehrt zu vorübergehenden Fehlern führen. Ebenso kann Ihre Anwendung von den Wiederholungsrichtlinien, die von anderen Benutzern der Ressourcen und Dienste implementiert wurden, beeinträchtigt werden. Möglicherweise entscheiden Sie sich für erfolgskritische Anwendungen zur Verwendung von Premiumdiensten, die nicht gemeinsam genutzt werden. Dadurch erhalten Sie wesentlich mehr Kontrolle über das Laden und die sich daraus ergebende Drosselung dieser Ressourcen und Dienste, was Ihnen helfen kann, die zusätzlichen Kosten zu rechtfertigen.

## <a name="more-information"></a>Weitere Informationen
* [Dienstspezifische Azure Wiederholungsrichtlinien](./retry-service-specific.md)
* [Anwendungsblock zum Behandeln vorübergehender Fehler](http://msdn.microsoft.com/library/hh680934.aspx)
* [Trennschalter-Muster](http://msdn.microsoft.com/library/dn589784.aspx)
* [Muster für eine ausgleichende Transaktion](http://msdn.microsoft.com/library/dn589804.aspx)
* [Idempotenz-Muster][idempotency-patterns]

[idempotency-patterns]: http://blog.jonathanoliver.com/idempotency-patterns/

