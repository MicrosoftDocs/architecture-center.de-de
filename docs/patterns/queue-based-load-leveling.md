---
title: Warteschlangenbasiertes Lastenausgleichsmuster
titleSuffix: Cloud Design Patterns
description: Verwenden Sie eine Warteschlange, die als Puffer zwischen einem Task und einem von diesem aufgerufenen Dienst fungiert, um unregelmäßig auftretende hohe Lasten aufzufangen.
keywords: Entwurfsmuster
author: dragon119
ms.date: 01/02/2019
ms.custom: seodec18
ms.openlocfilehash: bb519fa52fcb6472733b6e52d7332d470eda8349
ms.sourcegitcommit: 680c9cef945dff6fee5e66b38e24f07804510fa9
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 01/04/2019
ms.locfileid: "54011547"
---
# <a name="queue-based-load-leveling-pattern"></a><span data-ttu-id="e0371-104">Warteschlangenbasiertes Lastenausgleichsmuster</span><span class="sxs-lookup"><span data-stu-id="e0371-104">Queue-Based Load Leveling pattern</span></span>

<span data-ttu-id="e0371-105">Verwenden Sie eine Warteschlange, die als Puffer zwischen einem Task und einem von ihm aufgerufenen Dienst fungiert, um unregelmäßig auftretende hohe Lasten aufzufangen, die den Ausfall des Diensts oder eine Zeitüberschreitung des Tasks verursachen können. Dies kann dazu beitragen, die Auswirkungen von Bedarfsspitzen auf die Verfügbarkeit und Reaktionsfähigkeit von Task und Dienst zu minimieren.</span><span class="sxs-lookup"><span data-stu-id="e0371-105">Use a queue that acts as a buffer between a task and a service it invokes in order to smooth intermittent heavy loads that can cause the service to fail or the task to time out. This can help to minimize the impact of peaks in demand on availability and responsiveness for both the task and the service.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="e0371-106">Kontext und Problem</span><span class="sxs-lookup"><span data-stu-id="e0371-106">Context and problem</span></span>

<span data-ttu-id="e0371-107">Viele Lösungen in der Cloud beinhalten das Ausführen von Tasks, die Dienste aufrufen.</span><span class="sxs-lookup"><span data-stu-id="e0371-107">Many solutions in the cloud involve running tasks that invoke services.</span></span> <span data-ttu-id="e0371-108">Wenn in dieser Umgebung ein Dienst zeitweilig starken Lasten ausgesetzt ist, kann dies Probleme bei der Leistung oder Zuverlässigkeit verursachen.</span><span class="sxs-lookup"><span data-stu-id="e0371-108">In this environment, if a service is subjected to intermittent heavy loads, it can cause performance or reliability issues.</span></span>

<span data-ttu-id="e0371-109">Ein Dienst kann in derselben Lösung enthalten sein wie die Tasks, die ihn verwenden, oder es kann sich um einen Drittanbieterdienst handeln, der Zugriff auf häufig genutzte Ressourcen bietet, z.B. ein Cache oder Speicherdienst.</span><span class="sxs-lookup"><span data-stu-id="e0371-109">A service could be part of the same solution as the tasks that use it, or it could be a third-party service providing access to frequently used resources such as a cache or a storage service.</span></span> <span data-ttu-id="e0371-110">Wenn derselbe Dienst von mehreren gleichzeitig ausgeführten Tasks verwendet wird, ist die Menge der zu einem bestimmten Zeitpunkt an den Dienst gesendeten Anforderungen eventuell schwierig vorherzusagen.</span><span class="sxs-lookup"><span data-stu-id="e0371-110">If the same service is used by a number of tasks running concurrently, it can be difficult to predict the volume of requests to the service at any time.</span></span>

<span data-ttu-id="e0371-111">Bei einem Dienst können Bedarfsspitzen auftreten, die dazu führen, dass der Dienst überlastet ist und nicht zeitgerecht auf Anforderungen reagieren kann.</span><span class="sxs-lookup"><span data-stu-id="e0371-111">A service might experience peaks in demand that cause it to overload and be unable to respond to requests in a timely manner.</span></span> <span data-ttu-id="e0371-112">Die Belastung eines Diensts durch eine große Anzahl gleichzeitiger Anforderungen kann auch zum Ausfall des Diensts führen, wenn er die durch diese Anforderungen verursachten Konflikte nicht bewältigen kann.</span><span class="sxs-lookup"><span data-stu-id="e0371-112">Flooding a service with a large number of concurrent requests can also result in the service failing if it's unable to handle the contention these requests cause.</span></span>

## <a name="solution"></a><span data-ttu-id="e0371-113">Lösung</span><span class="sxs-lookup"><span data-stu-id="e0371-113">Solution</span></span>

<span data-ttu-id="e0371-114">Gestalten Sie die Lösung um, und setzen Sie zwischen den Task und den Dienst eine Warteschlange.</span><span class="sxs-lookup"><span data-stu-id="e0371-114">Refactor the solution and introduce a queue between the task and the service.</span></span> <span data-ttu-id="e0371-115">Der Task und der Dienst werden asynchron ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="e0371-115">The task and the service run asynchronously.</span></span> <span data-ttu-id="e0371-116">Der Task sendet eine Nachricht mit den für den Dienst erforderlichen Daten an die Warteschlange.</span><span class="sxs-lookup"><span data-stu-id="e0371-116">The task posts a message containing the data required by the service to a queue.</span></span> <span data-ttu-id="e0371-117">Die Warteschlange fungiert als Puffer, der die Nachricht speichert, bis sie vom Dienst abgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="e0371-117">The queue acts as a buffer, storing the message until it's retrieved by the service.</span></span> <span data-ttu-id="e0371-118">Der Dienst empfängt die Nachrichten aus der Warteschlange und verarbeitet sie.</span><span class="sxs-lookup"><span data-stu-id="e0371-118">The service retrieves the messages from the queue and processes them.</span></span> <span data-ttu-id="e0371-119">Anforderungen von mehreren Tasks, die mit einer stark schwankenden Rate generiert werden können, können über dieselbe Nachrichtenwarteschlange an den Dienst übergeben werden.</span><span class="sxs-lookup"><span data-stu-id="e0371-119">Requests from a number of tasks, which can be generated at a highly variable rate, can be passed to the service through the same message queue.</span></span> <span data-ttu-id="e0371-120">In dieser Abbildung wird die Verwendung einer Warteschlange zum Ausgleichen der Last für einen Dienst gezeigt.</span><span class="sxs-lookup"><span data-stu-id="e0371-120">This figure shows using a queue to level the load on a service.</span></span>

![Abbildung 1 – Verwenden einer Warteschlange zum Ausgleichen der Last für einen Dienst](./_images/queue-based-load-leveling-pattern.png)

<span data-ttu-id="e0371-122">Die Warteschlange entkoppelt die Tasks vom Dienst, und der Dienst kann die Nachrichten mit der ihm angemessenen Geschwindigkeit behandeln, unabhängig von der Menge der Anforderungen von gleichzeitigen Tasks.</span><span class="sxs-lookup"><span data-stu-id="e0371-122">The queue decouples the tasks from the service, and the service can handle the messages at its own pace regardless of the volume of requests from concurrent tasks.</span></span> <span data-ttu-id="e0371-123">Zudem wird ein Task nicht verzögert, wenn der Dienst zu dem Zeitpunkt, zu dem der Task eine Nachricht an die Warteschlange sendet, nicht verfügbar ist.</span><span class="sxs-lookup"><span data-stu-id="e0371-123">Additionally, there's no delay to a task if the service isn't available at the time it posts a message to the queue.</span></span>

<span data-ttu-id="e0371-124">Dieses Muster bietet folgende Vorteile:</span><span class="sxs-lookup"><span data-stu-id="e0371-124">This pattern provides the following benefits:</span></span>

- <span data-ttu-id="e0371-125">Es kann zum Erhöhen der Verfügbarkeit beitragen, da Verzögerungen in Diensten keine unverzügliche und direkte Auswirkung auf die Anwendung haben. Diese kann weiter Nachrichten an die Warteschlange senden, selbst wenn der Dienst nicht verfügbar ist oder Nachrichten nicht parallel verarbeitet.</span><span class="sxs-lookup"><span data-stu-id="e0371-125">It can help to maximize availability because delays arising in services won't have an immediate and direct impact on the application, which can continue to post messages to the queue even when the service isn't available or isn't currently processing messages.</span></span>
- <span data-ttu-id="e0371-126">Es kann zum Erhöhen der Skalierbarkeit beitragen, da sowohl die Anzahl der Warteschlangen als auch die Anzahl der Dienste an den Bedarf angepasst werden können.</span><span class="sxs-lookup"><span data-stu-id="e0371-126">It can help to maximize scalability because both the number of queues and the number of services can be varied to meet demand.</span></span>
- <span data-ttu-id="e0371-127">Es kann zur Kontrolle der Kosten beitragen, da die Anzahl der bereitgestellten Dienstinstanzen nur der durchschnittlichen Last und nicht der Spitzenlast entsprechen muss.</span><span class="sxs-lookup"><span data-stu-id="e0371-127">It can help to control costs because the number of service instances deployed only have to be adequate to meet average load rather than the peak load.</span></span>

    >  <span data-ttu-id="e0371-128">Manche Dienste implementieren Drosselung, wenn der Bedarf einen Schwellenwert erreicht, nach dessen Überschreiten das System ausfallen kann.</span><span class="sxs-lookup"><span data-stu-id="e0371-128">Some services implement throttling when demand reaches a threshold beyond which the system could fail.</span></span> <span data-ttu-id="e0371-129">Durch die Drosselung kann die verfügbare Funktionalität reduziert werden.</span><span class="sxs-lookup"><span data-stu-id="e0371-129">Throttling can reduce the functionality available.</span></span> <span data-ttu-id="e0371-130">Sie können für diese Dienste Lastenausgleich implementieren, um zu verhindern, dass dieser Schwellenwert erreicht wird.</span><span class="sxs-lookup"><span data-stu-id="e0371-130">You can implement load leveling with these services to ensure that this threshold isn't reached.</span></span>

## <a name="issues-and-considerations"></a><span data-ttu-id="e0371-131">Probleme und Überlegungen</span><span class="sxs-lookup"><span data-stu-id="e0371-131">Issues and considerations</span></span>

<span data-ttu-id="e0371-132">Beachten Sie die folgenden Punkte bei der Entscheidung, wie dieses Muster implementiert werden soll:</span><span class="sxs-lookup"><span data-stu-id="e0371-132">Consider the following points when deciding how to implement this pattern:</span></span>

- <span data-ttu-id="e0371-133">Es muss Anwendungslogik implementiert werden, mit der die Rate der Verarbeitung von Nachrichten durch Dienste gesteuert wird, um eine Überlastung der Zielressource zu verhindern.</span><span class="sxs-lookup"><span data-stu-id="e0371-133">It's necessary to implement application logic that controls the rate at which services handle messages to avoid overwhelming the target resource.</span></span> <span data-ttu-id="e0371-134">Reichen Sie Bedarfsspitzen nicht an die nächste Stufe im System weiter.</span><span class="sxs-lookup"><span data-stu-id="e0371-134">Avoid passing spikes in demand to the next stage of the system.</span></span> <span data-ttu-id="e0371-135">Testen Sie das System unter Last, um sicherzustellen, dass es den erforderlichen Ausgleich bietet, und passen Sie die Anzahl der Warteschlangen und die Anzahl der Dienstinstanzen, die Nachrichten verarbeiten, entsprechend an.</span><span class="sxs-lookup"><span data-stu-id="e0371-135">Test the system under load to ensure that it provides the required leveling, and adjust the number of queues and the number of service instances that handle messages to achieve this.</span></span>
- <span data-ttu-id="e0371-136">Nachrichtenwarteschlangen sind ein unidirektionaler Kommunikationsmechanismus.</span><span class="sxs-lookup"><span data-stu-id="e0371-136">Message queues are a one-way communication mechanism.</span></span> <span data-ttu-id="e0371-137">Wenn ein Task eine Antwort von einem Dienst erwartet, muss möglicherweise ein Mechanismus implementiert werden, den der Dienst zum Senden einer Antwort verwenden kann.</span><span class="sxs-lookup"><span data-stu-id="e0371-137">If a task expects a reply from a service, it might be necessary to implement a mechanism that the service can use to send a response.</span></span> <span data-ttu-id="e0371-138">Weitere Informationen finden Sie unter [Einführung in asynchrone Nachrichten](https://msdn.microsoft.com/library/dn589781.aspx).</span><span class="sxs-lookup"><span data-stu-id="e0371-138">For more information, see the [Asynchronous Messaging Primer](https://msdn.microsoft.com/library/dn589781.aspx).</span></span>
- <span data-ttu-id="e0371-139">Gehen Sie vorsichtig vor, wenn Sie die automatische Skalierung auf Dienste anwenden, die auf Anforderungen in der Warteschlange lauschen.</span><span class="sxs-lookup"><span data-stu-id="e0371-139">Be careful if you apply autoscaling to services that are listening for requests on the queue.</span></span> <span data-ttu-id="e0371-140">Dies kann die Konflikte um Ressourcen erhöhen, die von diesen Diensten gemeinsam genutzt werden, und die Effektivität der Verwendung der Warteschlange für den Lastenausgleich verringern.</span><span class="sxs-lookup"><span data-stu-id="e0371-140">This can result in increased contention for any resources that these services share and diminish the effectiveness of using the queue to level the load.</span></span>

## <a name="when-to-use-this-pattern"></a><span data-ttu-id="e0371-141">Verwendung dieses Musters</span><span class="sxs-lookup"><span data-stu-id="e0371-141">When to use this pattern</span></span>

<span data-ttu-id="e0371-142">Dieses Muster ist für jede Anwendung hilfreich, die Dienste verwendet, die Überlastung ausgesetzt sind.</span><span class="sxs-lookup"><span data-stu-id="e0371-142">This pattern is useful to any application that uses services that are subject to overloading.</span></span>

<span data-ttu-id="e0371-143">Dieses Muster ist nicht hilfreich, wenn die Anwendung eine Antwort vom Dienst mit minimaler Wartezeit erwartet.</span><span class="sxs-lookup"><span data-stu-id="e0371-143">This pattern isn't useful if the application expects a response from the service with minimal latency.</span></span>

## <a name="example"></a><span data-ttu-id="e0371-144">Beispiel</span><span class="sxs-lookup"><span data-stu-id="e0371-144">Example</span></span>

<span data-ttu-id="e0371-145">Eine Web-App schreibt Daten in einen externen Datenspeicher.</span><span class="sxs-lookup"><span data-stu-id="e0371-145">A web app writes data to an external data store.</span></span> <span data-ttu-id="e0371-146">Bei gleichzeitiger Ausführung zahlreicher Instanzen der Web-App kann der Datenspeicher möglicherweise nicht schnell genug auf Anforderungen reagieren, was zu Anforderungstimeouts, zur Drosselung von Anforderungen oder zu anderen Fehlern führen kann.</span><span class="sxs-lookup"><span data-stu-id="e0371-146">If a large number of instances of the web app run concurrently, the data store might be unable to respond to requests quickly enough, causing requests to time out, be throttled, or otherwise fail.</span></span> <span data-ttu-id="e0371-147">Das folgende Diagramm zeigt einen Datenspeicher, der aufgrund einer großen Menge gleichzeitiger Anforderungen von Instanzen einer Anwendung überlastet ist:</span><span class="sxs-lookup"><span data-stu-id="e0371-147">The following diagram shows a data store being overwhelmed by a large number of concurrent requests from instances of an application.</span></span>

![Abbildung 2: Ein Dienst, der aufgrund einer großen Menge gleichzeitiger Anforderungen von Instanzen einer Web-App überlastet ist.](./_images/queue-based-load-leveling-overwhelmed.png)

<span data-ttu-id="e0371-149">Zur Behebung dieses Problems können Sie eine Warteschlange für den Lastenausgleich zwischen den Anwendungsinstanzen und dem Datenspeicher verwenden.</span><span class="sxs-lookup"><span data-stu-id="e0371-149">To resolve this, you can use a queue to level the load between the application instances and the data store.</span></span> <span data-ttu-id="e0371-150">Eine Azure Functions-App liest die Nachrichten aus der Warteschlange und führt die an den Datenspeicher gerichteten Lese-/Schreibanforderungen aus.</span><span class="sxs-lookup"><span data-stu-id="e0371-150">An Azure Functions app reads the messages from the queue and performs the read/write requests to the data store.</span></span> <span data-ttu-id="e0371-151">Die Anwendungslogik in der Funktions-App kann die Rate steuern, mit der Anforderungen an den Datenspeicher übergeben werden, um eine Überlastung des Datenspeichers zu verhindern.</span><span class="sxs-lookup"><span data-stu-id="e0371-151">The application logic in the function app can control the rate at which it passes requests to the data store, to prevent the store from being overwhelmed.</span></span> <span data-ttu-id="e0371-152">(Andernfalls verursacht die Funktions-App das gleiche Problem am Back-End.)</span><span class="sxs-lookup"><span data-stu-id="e0371-152">(Otherwise the function app will just re-introduce the same problem at the back end.)</span></span>

![Abbildung 3: Verwenden einer Warteschlange und einer Funktions-App für den Lastenausgleich](./_images/queue-based-load-leveling-function.png)



## <a name="related-patterns-and-guidance"></a><span data-ttu-id="e0371-154">Zugehörige Muster und Anleitungen</span><span class="sxs-lookup"><span data-stu-id="e0371-154">Related patterns and guidance</span></span>

<span data-ttu-id="e0371-155">Die folgenden Muster und Anweisungen können für die Implementierung dieses Musters ebenfalls relevant sein:</span><span class="sxs-lookup"><span data-stu-id="e0371-155">The following patterns and guidance might also be relevant when implementing this pattern:</span></span>

- <span data-ttu-id="e0371-156">[Einführung in asynchrone Nachrichten](https://msdn.microsoft.com/library/dn589781.aspx).</span><span class="sxs-lookup"><span data-stu-id="e0371-156">[Asynchronous Messaging Primer](https://msdn.microsoft.com/library/dn589781.aspx).</span></span> <span data-ttu-id="e0371-157">Nachrichtenwarteschlangen sind grundsätzlich asynchron.</span><span class="sxs-lookup"><span data-stu-id="e0371-157">Message queues are inherently asynchronous.</span></span> <span data-ttu-id="e0371-158">Möglicherweise muss die Anwendungslogik in einem Task neu entworfen werden, wenn dieser nicht mehr direkt mit einem Dienst kommuniziert, sondern eine Nachrichtenwarteschlange verwendet.</span><span class="sxs-lookup"><span data-stu-id="e0371-158">It might be necessary to redesign the application logic in a task if it's adapted from communicating directly with a service to using a message queue.</span></span> <span data-ttu-id="e0371-159">Ebenso kann es erforderlich sein, einen Dienst umzugestalten, damit er Anforderungen aus einer Nachrichtenwarteschlange akzeptiert.</span><span class="sxs-lookup"><span data-stu-id="e0371-159">Similarly, it might be necessary to refactor a service to accept requests from a message queue.</span></span> <span data-ttu-id="e0371-160">Alternativ kann möglicherweise ein Proxydienst implementiert werden, wie im Beispiel beschrieben.</span><span class="sxs-lookup"><span data-stu-id="e0371-160">Alternatively, it might be possible to implement a proxy service, as described in the example.</span></span>

- <span data-ttu-id="e0371-161">[Muster „Konkurrierende Consumer“](./competing-consumers.md).</span><span class="sxs-lookup"><span data-stu-id="e0371-161">[Competing Consumers pattern](./competing-consumers.md).</span></span> <span data-ttu-id="e0371-162">Möglicherweise können mehrere Instanzen eines Diensts ausgeführt werden, von denen jede als Consumer von Nachrichten aus der Warteschlange für den Lastenausgleich fungiert.</span><span class="sxs-lookup"><span data-stu-id="e0371-162">It might be possible to run multiple instances of a service, each acting as a message consumer from the load-leveling queue.</span></span> <span data-ttu-id="e0371-163">Sie können diesen Ansatz verwenden, um die Rate anzupassen, mit der Nachrichten empfangen und an einen Dienst übergeben werden.</span><span class="sxs-lookup"><span data-stu-id="e0371-163">You can use this approach to adjust the rate at which messages are received and passed to a service.</span></span>

- <span data-ttu-id="e0371-164">[Drosselungsmuster](./throttling.md).</span><span class="sxs-lookup"><span data-stu-id="e0371-164">[Throttling pattern](./throttling.md).</span></span> <span data-ttu-id="e0371-165">Eine einfache Möglichkeit zum Implementieren von Drosselung für einen Dienst ist die Verwendung von warteschlangenbasiertem Lastenausgleich und die Weiterleitung aller Anforderungen an einen Dienst über eine Nachrichtenwarteschlange.</span><span class="sxs-lookup"><span data-stu-id="e0371-165">A simple way to implement throttling with a service is to use queue-based load leveling and route all requests to a service through a message queue.</span></span> <span data-ttu-id="e0371-166">Der Dienst kann Anforderungen mit einer Rate verarbeiten, die sicherstellt, dass die für den Dienst erforderlichen Ressourcen nicht erschöpft werden, und mit der die möglicherweise auftretenden Konflikte reduziert werden.</span><span class="sxs-lookup"><span data-stu-id="e0371-166">The service can process requests at a rate that ensures that resources required by the service aren't exhausted, and to reduce the amount of contention that could occur.</span></span>

- <span data-ttu-id="e0371-167">[Auswahl von Azure-Messagingdiensten: Event Grid, Event Hubs und Service Bus](/azure/event-grid/compare-messaging-services).</span><span class="sxs-lookup"><span data-stu-id="e0371-167">[Choose between Azure messaging services](/azure/event-grid/compare-messaging-services).</span></span> <span data-ttu-id="e0371-168">Informationen zum Auswählen eines Nachrichten- und Warteschlangenmechanismus in Azure-Anwendungen.</span><span class="sxs-lookup"><span data-stu-id="e0371-168">Information about choosing a messaging and queuing mechanism in Azure applications.</span></span>

- <span data-ttu-id="e0371-169">[Verbessern der Skalierbarkeit in einer Azure-Webanwendung](../reference-architectures/app-service-web-app/scalable-web-app.md).</span><span class="sxs-lookup"><span data-stu-id="e0371-169">[Improve scalability in an Azure web application](../reference-architectures/app-service-web-app/scalable-web-app.md).</span></span> <span data-ttu-id="e0371-170">Diese Referenzarchitektur enthält einen warteschlangenbasierten Lastenausgleich.</span><span class="sxs-lookup"><span data-stu-id="e0371-170">This reference architecture includes queue-based load leveling as part of the architecture.</span></span>
