---
title: Muster „Prioritätswarteschlange“
titleSuffix: Cloud Design Patterns
description: Priorisieren Sie an Dienste gesendete Anforderungen, sodass Anforderungen mit einer höheren Priorität schneller empfangen und verarbeitet werden als Anforderungen mit einer niedrigeren Priorität.
keywords: Entwurfsmuster
author: dragon119
ms.date: 06/23/2017
ms.topic: design-pattern
ms.service: architecture-center
ms.subservice: cloud-fundamentals
ms.custom: seodec18
ms.openlocfilehash: b3cde9c59e7b4cd023369366ae69977b153eb805
ms.sourcegitcommit: 1b50810208354577b00e89e5c031b774b02736e2
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 01/23/2019
ms.locfileid: "54481583"
---
# <a name="priority-queue-pattern"></a><span data-ttu-id="c71ef-104">Muster „Prioritätswarteschlange“</span><span class="sxs-lookup"><span data-stu-id="c71ef-104">Priority Queue pattern</span></span>

[!INCLUDE [header](../_includes/header.md)]

<span data-ttu-id="c71ef-105">Priorisieren Sie an Dienste gesendete Anforderungen, sodass Anforderungen mit einer höheren Priorität schneller empfangen und verarbeitet werden als Anforderungen mit einer niedrigeren Priorität.</span><span class="sxs-lookup"><span data-stu-id="c71ef-105">Prioritize requests sent to services so that requests with a higher priority are received and processed more quickly than those with a lower priority.</span></span> <span data-ttu-id="c71ef-106">Dieses Muster erweist sich bei Anwendungen als nützlich, die einzelnen Clients unterschiedliche Servicelevelgarantien bieten.</span><span class="sxs-lookup"><span data-stu-id="c71ef-106">This pattern is useful in applications that offer different service level guarantees to individual clients.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="c71ef-107">Kontext und Problem</span><span class="sxs-lookup"><span data-stu-id="c71ef-107">Context and Problem</span></span>

<span data-ttu-id="c71ef-108">Anwendungen können bestimmte Aufgaben an andere Dienste delegieren, beispielsweise für die Ausführung der Hintergrundverarbeitung oder Integration in andere Anwendungen oder Dienste.</span><span class="sxs-lookup"><span data-stu-id="c71ef-108">Applications can delegate specific tasks to other services, for example, to perform background processing or to integrate with other applications or services.</span></span> <span data-ttu-id="c71ef-109">In der Cloud werden mit Nachrichtenwarteschlangen üblicherweise Aufgaben an die Hintergrundverarbeitung delegiert.</span><span class="sxs-lookup"><span data-stu-id="c71ef-109">In the cloud, a message queue is typically used to delegate tasks to background processing.</span></span> <span data-ttu-id="c71ef-110">In der Vielzahl der Fällen ist die Reihenfolge, in der Anforderungen von einem Dienst empfangen werden, unerheblich.</span><span class="sxs-lookup"><span data-stu-id="c71ef-110">In many cases the order requests are received in by a service isn't important.</span></span> <span data-ttu-id="c71ef-111">In manchen Fällen ist es jedoch notwendig, bestimmte Anforderungen zu priorisieren.</span><span class="sxs-lookup"><span data-stu-id="c71ef-111">In some cases, though, it's necessary to prioritize specific requests.</span></span> <span data-ttu-id="c71ef-112">Diese Anforderungen sollten vor Anforderungen mit niedrigerer Priorität, die zuvor von der Anwendung gesendet wurden, verarbeitet werden.</span><span class="sxs-lookup"><span data-stu-id="c71ef-112">These requests should be processed earlier than lower priority requests that were sent previously by the application.</span></span>

## <a name="solution"></a><span data-ttu-id="c71ef-113">Lösung</span><span class="sxs-lookup"><span data-stu-id="c71ef-113">Solution</span></span>

<span data-ttu-id="c71ef-114">Eine Warteschlange folgt in der Regel dem FIFO-Prinzip (First In, First Out), und Consumer erhalten Nachrichten normalerweise in der gleichen Reihenfolge, in der sie in der Warteschlange bereitgestellt wurden.</span><span class="sxs-lookup"><span data-stu-id="c71ef-114">A queue is usually a first-in, first-out (FIFO) structure, and consumers typically receive messages in the same order that they were posted to the queue.</span></span> <span data-ttu-id="c71ef-115">Einige Nachrichtenwarteschlangen unterstützen jedoch priorisierte Nachrichten.</span><span class="sxs-lookup"><span data-stu-id="c71ef-115">However, some message queues support priority messaging.</span></span> <span data-ttu-id="c71ef-116">Die Anwendung, die eine Nachricht bereitstellt, kann eine Priorität zuweisen. Die Nachrichten werden dann in der Warteschlange automatisch neu angeordnet, sodass Nachrichten mit einer höheren Priorität vor denen mit einer niedrigeren Priorität empfangen werden.</span><span class="sxs-lookup"><span data-stu-id="c71ef-116">The application posting a message can assign a priority and the messages in the queue are automatically reordered so that those with a higher priority will be received before those with a lower priority.</span></span> <span data-ttu-id="c71ef-117">Die folgende Abbildung zeigt eine Warteschlange mit priorisierten Nachrichten.</span><span class="sxs-lookup"><span data-stu-id="c71ef-117">The figure illustrates a queue with priority messaging.</span></span>

![Abbildung 1: Verwendung eines Warteschlangenmechanismus mit Unterstützung für die Priorisierung von Nachrichten](./_images/priority-queue-pattern.png)

> <span data-ttu-id="c71ef-119">Die meisten Implementierungen für Nachrichtenwarteschlangen unterstützen mehrere Consumer (nach dem [Muster „Konkurrierende Consumer“](./competing-consumers.md)), und die Anzahl der Consumerprozesse kann je nach Bedarf zentral hoch- oder herunterskaliert werden.</span><span class="sxs-lookup"><span data-stu-id="c71ef-119">Most message queue implementations support multiple consumers (following the [Competing Consumers pattern](./competing-consumers.md)), and the number of consumer processes can be scaled up or down depending on demand.</span></span>

<span data-ttu-id="c71ef-120">In Systemen, die keine prioritätsbasierten Nachrichtenwarteschlangen unterstützen, kann alternativ für jede Priorität eine eigene Warteschlange verwaltet werden.</span><span class="sxs-lookup"><span data-stu-id="c71ef-120">In systems that don't support priority-based message queues, an alternative solution is to maintain a separate queue for each priority.</span></span> <span data-ttu-id="c71ef-121">Die Anwendung ist für die Bereitstellung von Nachrichten in der entsprechenden Warteschlange zuständig.</span><span class="sxs-lookup"><span data-stu-id="c71ef-121">The application is responsible for posting messages to the appropriate queue.</span></span> <span data-ttu-id="c71ef-122">Jede Warteschlange kann über einen separaten Pool von Consumern verfügen.</span><span class="sxs-lookup"><span data-stu-id="c71ef-122">Each queue can have a separate pool of consumers.</span></span> <span data-ttu-id="c71ef-123">Für Warteschlangen mit höherer Priorität kann ein größerer Consumerpool auf schnellerer Hardware ausgeführt werden als für Warteschlangen mit niedrigerer Priorität.</span><span class="sxs-lookup"><span data-stu-id="c71ef-123">Higher priority queues can have a larger pool of consumers running on faster hardware than lower priority queues.</span></span> <span data-ttu-id="c71ef-124">Die folgende Abbildung veranschaulicht die Verwendung von separaten Nachrichtenwarteschlangen für die einzelnen Prioritäten.</span><span class="sxs-lookup"><span data-stu-id="c71ef-124">The next figure illustrates using separate message queues for each priority.</span></span>

![Abbildung 2: Verwendung von separaten Nachrichtenwarteschlangen für die einzelnen Prioritäten](./_images/priority-queue-separate.png)

<span data-ttu-id="c71ef-126">Eine Variante dieser Strategie besteht darin, einen einzigen Consumerpool zu verwalten, der zuerst in Warteschlangen mit hoher Priorität nach Nachrichten sucht und erst dann damit beginnt, Nachrichten aus Warteschlangen mit niedrigerer Priorität abzurufen.</span><span class="sxs-lookup"><span data-stu-id="c71ef-126">A variation on this strategy is to have a single pool of consumers that check for messages on high priority queues first, and only then start to fetch messages from lower priority queues.</span></span> <span data-ttu-id="c71ef-127">Es gibt einige semantische Unterschiede zwischen einer Lösung, die einen einzigen Pool von Consumerprozessen verwendet (entweder mit einer einzigen Warteschlange, die Nachrichten mit unterschiedlichen Prioritäten unterstützt, oder mit mehreren Warteschlangen, die jeweils Nachrichten mit einer einzigen Priorität verarbeiten), und einer Lösung, die mehrere Warteschlangen mit einem separaten Pool für jede Warteschlange verwendet.</span><span class="sxs-lookup"><span data-stu-id="c71ef-127">There are some semantic differences between a solution that uses a single pool of consumer processes (either with a single queue that supports messages with different priorities or with multiple queues that each handle messages of a single priority), and a solution that uses multiple queues with a separate pool for each queue.</span></span>

<span data-ttu-id="c71ef-128">Bei dem Modell mit einem einzigen Pool werden Nachrichten mit höherer Priorität stets vor Nachrichten mit niedrigerer Priorität empfangen und verarbeitet.</span><span class="sxs-lookup"><span data-stu-id="c71ef-128">In the single pool approach, higher priority messages are always received and processed before lower priority messages.</span></span> <span data-ttu-id="c71ef-129">Theoretisch könnten Nachrichten mit einer sehr niedrigen Priorität kontinuierlich abgelöst und niemals verarbeitet werden.</span><span class="sxs-lookup"><span data-stu-id="c71ef-129">In theory, messages that have a very low priority could be continually superseded and might never be processed.</span></span> <span data-ttu-id="c71ef-130">Bei dem Modell mit mehreren Pools werden Nachrichten mit niedrigerer Priorität immer verarbeitet, nur nicht so schnell wie Nachrichten mit höherer Priorität (abhängig von der relativen Größe der Pools und den für diese zur Verfügung stehenden Ressourcen).</span><span class="sxs-lookup"><span data-stu-id="c71ef-130">In the multiple pool approach, lower priority messages will always be processed, just not as quickly as those of a higher priority (depending on the relative size of the pools and the resources that they have available).</span></span>

<span data-ttu-id="c71ef-131">Die Verwendung eines Prioritätswarteschlangenmechanismus kann folgende Vorteile bieten:</span><span class="sxs-lookup"><span data-stu-id="c71ef-131">Using a priority queuing mechanism can provide the following advantages:</span></span>

- <span data-ttu-id="c71ef-132">Durch diesen Mechanismus wird es Anwendungen ermöglicht, Geschäftsanforderungen zu erfüllen, die eine Priorisierung der Verfügbarkeit oder Leistung erfordern, wie z.B. durch das Anbieten unterschiedlicher Servicelevels für bestimmte Kundengruppen.</span><span class="sxs-lookup"><span data-stu-id="c71ef-132">It allows applications to meet business requirements that require prioritization of availability or performance, such as offering different levels of service to specific groups of customers.</span></span>

- <span data-ttu-id="c71ef-133">Der Mechanismus kann zur Minimierung der Betriebskosten beitragen.</span><span class="sxs-lookup"><span data-stu-id="c71ef-133">It can help to minimize operational costs.</span></span> <span data-ttu-id="c71ef-134">Bei dem Modell mit einer einzigen Warteschlange können Sie die Anzahl der Consumer bei Bedarf reduzieren.</span><span class="sxs-lookup"><span data-stu-id="c71ef-134">In the single queue approach, you can scale back the number of consumers if necessary.</span></span> <span data-ttu-id="c71ef-135">Nachrichten mit hoher Priorität werden nach wie vor zuerst verarbeitet (wenn auch möglicherweise langsamer), und Nachrichten mit niedrigerer Priorität werden möglicherweise länger verzögert.</span><span class="sxs-lookup"><span data-stu-id="c71ef-135">High priority messages will still be processed first (although possibly more slowly), and lower priority messages might be delayed for longer.</span></span> <span data-ttu-id="c71ef-136">Wenn Sie das Modell mit mehreren Nachrichtenwarteschlangen mit separaten Consumerpools für die einzelnen Warteschlangen implementiert haben, können Sie den Consumerpool für Warteschlangen mit niedrigerer Priorität verringern oder sogar die Verarbeitung für einige Warteschlangen mit sehr niedriger Priorität anhalten. Für Letzteres müssen Sie alle Consumer anhalten, die auf Nachrichten in diesen Warteschlangen lauschen.</span><span class="sxs-lookup"><span data-stu-id="c71ef-136">If you've implemented the multiple message queue approach with separate pools of consumers for each queue, you can reduce the pool of consumers for lower priority queues, or even suspend processing for some very low priority queues by stopping all the consumers that listen for messages on those queues.</span></span>

- <span data-ttu-id="c71ef-137">Durch das Modell mit mehreren Nachrichtenwarteschlangen können Anwendungsleistung und Skalierbarkeit maximiert werden, indem Nachrichten gemäß den Verarbeitungsanforderungen partitioniert werden.</span><span class="sxs-lookup"><span data-stu-id="c71ef-137">The multiple message queue approach can help maximize application performance and scalability by partitioning messages based on processing requirements.</span></span> <span data-ttu-id="c71ef-138">So können wichtige Aufgaben z.B. derart priorisiert werden, dass sie von Empfängern für die sofortige Ausführung bearbeitet werden, während weniger wichtige Hintergrundaufgaben von Empfängern bearbeitet werden können, die für die Ausführung in weniger stark ausgelasteten Zeiträumen geplant sind.</span><span class="sxs-lookup"><span data-stu-id="c71ef-138">For example, vital tasks can be prioritized to be handled by receivers that run immediately while less important background tasks can be handled by receivers that are scheduled to run at less busy periods.</span></span>

## <a name="issues-and-considerations"></a><span data-ttu-id="c71ef-139">Probleme und Überlegungen</span><span class="sxs-lookup"><span data-stu-id="c71ef-139">Issues and Considerations</span></span>

<span data-ttu-id="c71ef-140">Beachten Sie die folgenden Punkte bei der Entscheidung, wie dieses Muster implementiert werden soll:</span><span class="sxs-lookup"><span data-stu-id="c71ef-140">Consider the following points when deciding how to implement this pattern:</span></span>

<span data-ttu-id="c71ef-141">Definieren Sie die Prioritäten im Kontext der Lösung.</span><span class="sxs-lookup"><span data-stu-id="c71ef-141">Define the priorities in the context of the solution.</span></span> <span data-ttu-id="c71ef-142">Eine hohe Priorität könnte z.B. bedeuten, dass Nachrichten innerhalb von zehn Sekunden verarbeitet werden sollten.</span><span class="sxs-lookup"><span data-stu-id="c71ef-142">For example, high priority could mean that messages should be processed within ten seconds.</span></span> <span data-ttu-id="c71ef-143">Ermitteln Sie die Anforderungen für die Bearbeitung von Elementen mit hoher Priorität und anderen Ressourcen, die zur Erfüllung dieser Kriterien zugewiesen werden sollten.</span><span class="sxs-lookup"><span data-stu-id="c71ef-143">Identify the requirements for handling high priority items, and the other resources that should be allocated to meet these criteria.</span></span>

<span data-ttu-id="c71ef-144">Legen Sie fest, ob alle Elemente mit hoher Priorität vor sämtlichen Elementen mit niedrigerer Priorität verarbeitet werden müssen.</span><span class="sxs-lookup"><span data-stu-id="c71ef-144">Decide if all high priority items must be processed before any lower priority items.</span></span> <span data-ttu-id="c71ef-145">Wenn die Nachrichten von einem einzigen Consumerpool verarbeitet werden, müssen Sie einen Mechanismus bereitstellen, der eine Aufgabe zur Bearbeitung einer Nachricht mit niedriger Priorität verdrängen und anhalten kann, wenn eine Nachricht mit höherer Priorität verfügbar wird.</span><span class="sxs-lookup"><span data-stu-id="c71ef-145">If the messages are being processed by a single pool of consumers, you have to provide a mechanism that can preempt and suspend a task that's handling a low priority message if a higher priority message becomes available.</span></span>

<span data-ttu-id="c71ef-146">Wenn bei einem Modell mit mehreren Warteschlangen ein einziger Pool mit Consumerprozessen eingesetzt wird, der auf alle Warteschlangen lauscht statt auf einen dedizierten Consumerpool für jede Warteschlange, muss auf den Consumer ein Algorithmus angewendet werden, der sicherstellt, dass er Nachrichten aus Warteschlangen mit höherer Priorität immer vor denen aus Warteschlangen mit niedrigerer Priorität verarbeitet.</span><span class="sxs-lookup"><span data-stu-id="c71ef-146">In the multiple queue approach, when using a single pool of consumer processes that listen on all queues rather than a dedicated consumer pool for each queue, the consumer must apply an algorithm that ensures it always services messages from higher priority queues before those from lower priority queues.</span></span>

<span data-ttu-id="c71ef-147">Überwachen Sie die Verarbeitungsgeschwindigkeit von Warteschlangen mit hoher und niedriger Priorität, um sicherzustellen, dass Nachrichten in diesen Warteschlangen mit der erwarteten Geschwindigkeit verarbeitet werden.</span><span class="sxs-lookup"><span data-stu-id="c71ef-147">Monitor the processing speed on high and low priority queues to ensure that messages in these queues are processed at the expected rates.</span></span>

<span data-ttu-id="c71ef-148">Wenn Sie sicherstellen müssen, dass Nachrichten mit niedriger Priorität verarbeitet werden, muss das Modell mit mehreren Warteschlangen mit mehreren Consumerpools implementiert werden.</span><span class="sxs-lookup"><span data-stu-id="c71ef-148">If you need to guarantee that low priority messages will be processed, it's necessary to implement the multiple message queue approach with multiple pools of consumers.</span></span> <span data-ttu-id="c71ef-149">Alternativ besteht bei einer Warteschlange mit Unterstützung für Nachrichtenpriorisierung die Möglichkeit, die Priorität einer in der Warteschlange gereihten Nachricht mit fortlaufender Dauer dynamisch zu erhöhen.</span><span class="sxs-lookup"><span data-stu-id="c71ef-149">Alternatively, in a queue that supports message prioritization, it's possible to dynamically increase the priority of a queued message as it ages.</span></span> <span data-ttu-id="c71ef-150">Um dieses Modell verwenden zu können, muss jedoch gegeben sein, dass dieses Feature von der Nachrichtenwarteschlange bereitgestellt wird.</span><span class="sxs-lookup"><span data-stu-id="c71ef-150">However, this approach depends on the message queue providing this feature.</span></span>

<span data-ttu-id="c71ef-151">Die Verwendung einer separaten Warteschlange für die einzelnen Nachrichtenprioritäten ist am besten für Systeme geeignet, die eine kleine Anzahl von klar definierter Prioritäten aufweisen.</span><span class="sxs-lookup"><span data-stu-id="c71ef-151">Using a separate queue for each message priority works best for systems that have a small number of well-defined priorities.</span></span>

<span data-ttu-id="c71ef-152">Nachrichtenprioritäten können vom System logisch ermittelt werden.</span><span class="sxs-lookup"><span data-stu-id="c71ef-152">Message priorities can be determined logically by the system.</span></span> <span data-ttu-id="c71ef-153">Anstelle von Nachrichten mit explizit hoher und niedriger Priorität könnten Nachrichten beispielsweise mit den Bezeichnungen „zahlungspflichtiger Kunde“ oder „nicht zahlungspflichtiger Kunde“ versehen werden.</span><span class="sxs-lookup"><span data-stu-id="c71ef-153">For example, rather than having explicit high and low priority messages, they could be designated as “fee paying customer,” or “non-fee paying customer.”</span></span> <span data-ttu-id="c71ef-154">Abhängig von Ihrem Geschäftsmodell kann Ihr System mehr Ressourcen für die Nachrichtenverarbeitung zahlungspflichtiger Kunden bereitstellen als für nicht zahlungspflichtige Kunden.</span><span class="sxs-lookup"><span data-stu-id="c71ef-154">Depending on your business model, your system can allocate more resources to processing messages from fee paying customers than non-fee paying ones.</span></span>

<span data-ttu-id="c71ef-155">Für die Suche nach einer Nachricht in einer Warteschlange fallen eventuell Verarbeitungskosten an (einige kommerzielle Messagingsysteme erheben eine geringfügige Gebühr, wenn eine Nachricht bereitgestellt oder abgerufen wird und Nachrichten in einer Warteschlange abgefragt werden).</span><span class="sxs-lookup"><span data-stu-id="c71ef-155">There might be a financial and processing cost associated with checking a queue for a message (some commercial messaging systems charge a small fee each time a message is posted or retrieved, and each time a queue is queried for messages).</span></span> <span data-ttu-id="c71ef-156">Bei der Prüfung von mehreren Warteschlangen fallen diese Kosten höher aus.</span><span class="sxs-lookup"><span data-stu-id="c71ef-156">This cost increases when checking multiple queues.</span></span>

<span data-ttu-id="c71ef-157">Die Größe eines Consumerpools kann basierend auf der Länge der Warteschlange, die der Pool bedient, dynamisch angepasst werden.</span><span class="sxs-lookup"><span data-stu-id="c71ef-157">It's possible to dynamically adjust the size of a pool of consumers based on the length of the queue that the pool is servicing.</span></span> <span data-ttu-id="c71ef-158">Weitere Informationen finden Sie im [Leitfaden für die automatische Skalierung](https://msdn.microsoft.com/library/dn589774.aspx).</span><span class="sxs-lookup"><span data-stu-id="c71ef-158">For more information, see the [Autoscaling Guidance](https://msdn.microsoft.com/library/dn589774.aspx).</span></span>

## <a name="when-to-use-this-pattern"></a><span data-ttu-id="c71ef-159">Verwendung dieses Musters</span><span class="sxs-lookup"><span data-stu-id="c71ef-159">When to use this pattern</span></span>

<span data-ttu-id="c71ef-160">Dieses Muster ist in Szenarien wie den folgenden nützlich:</span><span class="sxs-lookup"><span data-stu-id="c71ef-160">This pattern is useful in scenarios where:</span></span>

- <span data-ttu-id="c71ef-161">Das System muss mehrere Aufgaben mit unterschiedlichen Prioritäten verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="c71ef-161">The system must handle multiple tasks that have different priorities.</span></span>

- <span data-ttu-id="c71ef-162">Unterschiedliche Benutzer oder Mandanten sollten mit unterschiedlichen Prioritäten versehen werden.</span><span class="sxs-lookup"><span data-stu-id="c71ef-162">Different users or tenants should be served with different priority.</span></span>

## <a name="example"></a><span data-ttu-id="c71ef-163">Beispiel</span><span class="sxs-lookup"><span data-stu-id="c71ef-163">Example</span></span>

<span data-ttu-id="c71ef-164">Microsoft Azure bietet keinen Queuingmechanismus, der die automatische Priorisierung von Nachrichten durch Sortierung nativ unterstützt.</span><span class="sxs-lookup"><span data-stu-id="c71ef-164">Microsoft Azure doesn't provide a queuing mechanism that natively supports automatic prioritization of messages through sorting.</span></span> <span data-ttu-id="c71ef-165">Microsoft Azure bietet jedoch Azure Service Bus-Themen und -Abonnements, die einen Queuingmechanismus mit Nachrichtenfilterung sowie einem großen Spektrum an flexiblen Funktionen unterstützen. Somit ist Microsoft Azure die ideale Lösung für den Einsatz in den meisten Implementierungen von Prioritätswarteschlangen.</span><span class="sxs-lookup"><span data-stu-id="c71ef-165">However, it does provide Azure Service Bus topics and subscriptions that support a queuing mechanism that provides message filtering, together with a wide range of flexible capabilities that make it ideal for use in most priority queue implementations.</span></span>

<span data-ttu-id="c71ef-166">Eine Azure-Lösung kann ein Service Bus-Thema implementieren, für das eine Anwendung wie bei einer Warteschlange Nachrichten bereitstellen kann.</span><span class="sxs-lookup"><span data-stu-id="c71ef-166">An Azure solution can implement a Service Bus topic an application can post messages to, in the same way as a queue.</span></span> <span data-ttu-id="c71ef-167">Nachrichten können Metadaten in Form von anwendungs- und benutzerdefinierten Eigenschaften enthalten.</span><span class="sxs-lookup"><span data-stu-id="c71ef-167">Messages can contain metadata in the form of application-defined custom properties.</span></span> <span data-ttu-id="c71ef-168">Dem Thema können Service Bus-Abonnements zugeordnet werden, die Nachrichten anhand ihrer Eigenschaften filtern können.</span><span class="sxs-lookup"><span data-stu-id="c71ef-168">Service Bus subscriptions can be associated with the topic, and these subscriptions can filter messages based on their properties.</span></span> <span data-ttu-id="c71ef-169">Wenn eine Anwendung eine Nachricht an ein Thema sendet, wird die Nachricht an das entsprechende Abonnement weitergeleitet, wo sie von einem Consumer gelesen werden kann.</span><span class="sxs-lookup"><span data-stu-id="c71ef-169">When an application sends a message to a topic, the message is directed to the appropriate subscription where it can be read by a consumer.</span></span> <span data-ttu-id="c71ef-170">Consumerprozesse können Nachrichten mit derselben Semantik aus einem Abonnement abrufen wie eine Nachrichtenwarteschlange (ein Abonnement stellt eine logische Warteschlange dar).</span><span class="sxs-lookup"><span data-stu-id="c71ef-170">Consumer processes can retrieve messages from a subscription using the same semantics as a message queue (a subscription is a logical queue).</span></span> <span data-ttu-id="c71ef-171">Die folgende Abbildung zeigt die Implementierung einer Prioritätswarteschlange mit Azure Service Bus-Themen und -Abonnements.</span><span class="sxs-lookup"><span data-stu-id="c71ef-171">The following figure illustrates implementing a priority queue with Azure Service Bus topics and subscriptions.</span></span>

![Abbildung 3: Implementierung einer Prioritätswarteschlange mit Azure Service Bus-Themen und -Abonnements](./_images/priority-queue-service-bus.png)

<span data-ttu-id="c71ef-173">In der obigen Abbildung erstellt die Anwendung mehrere Nachrichten und weist einer benutzerdefinierten Eigenschaft namens `Priority` in jeder Nachricht entweder den Wert `High` oder `Low` zu.</span><span class="sxs-lookup"><span data-stu-id="c71ef-173">In the figure above, the application creates several messages and assigns a custom property called `Priority` in each message with a value, either `High` or `Low`.</span></span> <span data-ttu-id="c71ef-174">Diese Nachrichten werden von der Anwendung für ein Thema bereitgestellt.</span><span class="sxs-lookup"><span data-stu-id="c71ef-174">The application posts these messages to a topic.</span></span> <span data-ttu-id="c71ef-175">Dem Thema sind zwei Abonnements zugeordnet, die beide anhand der Eigenschaft `Priority` Nachrichten filtern.</span><span class="sxs-lookup"><span data-stu-id="c71ef-175">The topic has two associated subscriptions that both filter messages by examining the `Priority` property.</span></span> <span data-ttu-id="c71ef-176">Ein Abonnement akzeptiert Nachrichten, bei denen die Eigenschaft `Priority` auf `High` festgelegt ist, während das andere Abonnement Nachrichten akzeptiert, bei denen die Eigenschaft `Priority` auf `Low` festgelegt ist.</span><span class="sxs-lookup"><span data-stu-id="c71ef-176">One subscription accepts messages where the `Priority` property is set to `High`, and the other accepts messages where the `Priority` property is set to `Low`.</span></span> <span data-ttu-id="c71ef-177">Ein Consumerpool liest Nachrichten aus jedem Abonnement.</span><span class="sxs-lookup"><span data-stu-id="c71ef-177">A pool of consumers reads messages from each subscription.</span></span> <span data-ttu-id="c71ef-178">Das Abonnement mit hoher Priorität weist einen größeren Pool auf. Diese Consumer können eventuell auf leistungsstärkeren Computern mit einer größeren Anzahl verfügbarer Ressourcen ausgeführt werden als die Consumer im Pool mit niedriger Priorität.</span><span class="sxs-lookup"><span data-stu-id="c71ef-178">The high priority subscription has a larger pool, and these consumers might be running on more powerful computers with more resources available than the consumers in the low priority pool.</span></span>

<span data-ttu-id="c71ef-179">Beachten Sie, dass die Bezeichnung von Nachrichten mit hoher und niedriger Priorität in diesem Beispiel keine Besonderheit darstellt.</span><span class="sxs-lookup"><span data-stu-id="c71ef-179">Note that there's nothing special about the designation of high and low priority messages in this example.</span></span> <span data-ttu-id="c71ef-180">Es handelt sich lediglich um Bezeichnungen, die in den einzelnen Nachrichten als Eigenschaften angegeben sind und zur Weiterleitung von Nachrichten an ein bestimmtes Abonnement verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="c71ef-180">They're simply labels specified as properties in each message, and are used to direct messages to a specific subscription.</span></span> <span data-ttu-id="c71ef-181">Falls zusätzliche Prioritäten erforderlich sein sollten, ist es relativ einfach, weitere Abonnements und Pools von Consumerprozessen für die Verarbeitung dieser Prioritäten zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="c71ef-181">If additional priorities are required, it's relatively easy to create further subscriptions and pools of consumer processes to handle these priorities.</span></span>

<span data-ttu-id="c71ef-182">Die PriorityQueue-Lösung, die auf [GitHub](https://github.com/mspnp/cloud-design-patterns/tree/master/priority-queue) verfügbar ist, umfasst eine Implementierung dieses Ansatzes.</span><span class="sxs-lookup"><span data-stu-id="c71ef-182">The PriorityQueue solution available on [GitHub](https://github.com/mspnp/cloud-design-patterns/tree/master/priority-queue) contains an implementation of this approach.</span></span> <span data-ttu-id="c71ef-183">Diese Lösung enthält die zwei Workerrollenprojekte namens `PriorityQueue.High` und `PriorityQueue.Low`.</span><span class="sxs-lookup"><span data-stu-id="c71ef-183">This solution contains two worker role projects named `PriorityQueue.High` and `PriorityQueue.Low`.</span></span> <span data-ttu-id="c71ef-184">Diese Workerrollen erben die Klasse `PriorityWorkerRole`, die die Funktionalität für die Verbindung mit einem bestimmten Abonnement in der `OnStart`-Methode enthält.</span><span class="sxs-lookup"><span data-stu-id="c71ef-184">These worker roles inherit from the `PriorityWorkerRole` class that contains the functionality for connecting to a specified subscription in the `OnStart` method.</span></span>

<span data-ttu-id="c71ef-185">Die Workerrollen `PriorityQueue.High` und `PriorityQueue.Low` stellen eine Verbindung mit verschiedenen Abonnements her, die in den jeweiligen Konfigurationseinstellungen definiert sind.</span><span class="sxs-lookup"><span data-stu-id="c71ef-185">The `PriorityQueue.High` and `PriorityQueue.Low` worker roles connect to different subscriptions, defined by their configuration settings.</span></span> <span data-ttu-id="c71ef-186">Ein Administrator kann für jede Rolle, die ausgeführt werden soll, eine unterschiedliche Anzahl konfigurieren.</span><span class="sxs-lookup"><span data-stu-id="c71ef-186">An administrator can configure different numbers of each role to be run.</span></span> <span data-ttu-id="c71ef-187">Normalerweise gibt es von der Workerrolle `PriorityQueue.High` mehr Instanzen als von der Workerrolle `PriorityQueue.Low`.</span><span class="sxs-lookup"><span data-stu-id="c71ef-187">Typically there'll be more instances of the `PriorityQueue.High` worker role than the `PriorityQueue.Low` worker role.</span></span>

<span data-ttu-id="c71ef-188">Die `Run`-Methode in der Klasse `PriorityWorkerRole` bewirkt, dass für jede empfangene Nachricht in der Warteschlange die virtuelle `ProcessMessage`-Methode (ebenfalls in der Klasse `PriorityWorkerRole` definiert) ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="c71ef-188">The `Run` method in the `PriorityWorkerRole` class arranges for the virtual `ProcessMessage` method (also defined in the `PriorityWorkerRole` class) to be run for each message received on the queue.</span></span> <span data-ttu-id="c71ef-189">Der folgende Code zeigt die `Run`- und `ProcessMessage`-Methoden:</span><span class="sxs-lookup"><span data-stu-id="c71ef-189">The following code shows the `Run` and `ProcessMessage` methods.</span></span> <span data-ttu-id="c71ef-190">Die im PriorityQueue.Shared-Projekt definierte Klasse `QueueManager` stellt Hilfsmethoden für die Verwendung von Azure Service Bus-Warteschlangen zur Verfügung.</span><span class="sxs-lookup"><span data-stu-id="c71ef-190">The `QueueManager` class, defined in the PriorityQueue.Shared project, provides helper methods for using Azure Service Bus queues.</span></span>

```csharp
public class PriorityWorkerRole : RoleEntryPoint
{
  private QueueManager queueManager;
  ...

  public override void Run()
  {
    // Start listening for messages on the subscription.
    var subscriptionName = CloudConfigurationManager.GetSetting("SubscriptionName");
    this.queueManager.ReceiveMessages(subscriptionName, this.ProcessMessage);
    ...;
  }
  ...

  protected virtual async Task ProcessMessage(BrokeredMessage message)
  {
    // Simulating processing.
    await Task.Delay(TimeSpan.FromSeconds(2));
  }
}
```

<span data-ttu-id="c71ef-191">Die Workerrolle `PriorityQueue.High` und `PriorityQueue.Low` überschreiben die Standardfunktionalität der `ProcessMessage`-Methode.</span><span class="sxs-lookup"><span data-stu-id="c71ef-191">The `PriorityQueue.High` and `PriorityQueue.Low` worker roles both override the default functionality of the `ProcessMessage` method.</span></span> <span data-ttu-id="c71ef-192">Im folgenden Code wird die `ProcessMessage`-Methode für die Workerrolle `PriorityQueue.High` veranschaulicht.</span><span class="sxs-lookup"><span data-stu-id="c71ef-192">The code below shows the `ProcessMessage` method for the `PriorityQueue.High` worker role.</span></span>

```csharp
protected override async Task ProcessMessage(BrokeredMessage message)
{
  // Simulate message processing for High priority messages.
  await base.ProcessMessage(message);
  Trace.TraceInformation("High priority message processed by " +
    RoleEnvironment.CurrentRoleInstance.Id + " MessageId: " + message.MessageId);
}
```

<span data-ttu-id="c71ef-193">Wenn eine Anwendung Nachrichten zu dem Thema bereitstellt, das den von den Workerrollen `PriorityQueue.High` und `PriorityQueue.Low` verwendeten Abonnements zugeordnet ist, legt sie die Priorität mithilfe der benutzerdefinierten Eigenschaft `Priority` fest, wie im folgenden Codebeispiel gezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="c71ef-193">When an application posts messages to the topic associated with the subscriptions used by the `PriorityQueue.High` and `PriorityQueue.Low` worker roles, it specifies the priority by using the `Priority` custom property, as shown in the following code example.</span></span> <span data-ttu-id="c71ef-194">Dieser Code (in der Klasse `WorkerRole` im PriorityQueue.Sender-Projekt implementiert) verwendet die Hilfsmethode `SendBatchAsync` der Klasse `QueueManager`, um Nachrichten zu einem Thema batchweise bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="c71ef-194">This code (implemented in the `WorkerRole` class in the PriorityQueue.Sender project), uses the `SendBatchAsync` helper method of the `QueueManager` class to post messages to a topic in batches.</span></span>

```csharp
// Send a low priority batch.
var lowMessages = new List<BrokeredMessage>();

for (int i = 0; i < 10; i++)
{
  var message = new BrokeredMessage() { MessageId = Guid.NewGuid().ToString() };
  message.Properties["Priority"] = Priority.Low;
  lowMessages.Add(message);
}

this.queueManager.SendBatchAsync(lowMessages).Wait();
...

// Send a high priority batch.
var highMessages = new List<BrokeredMessage>();

for (int i = 0; i < 10; i++)
{
  var message = new BrokeredMessage() { MessageId = Guid.NewGuid().ToString() };
  message.Properties["Priority"] = Priority.High;
  highMessages.Add(message);
}

this.queueManager.SendBatchAsync(highMessages).Wait();
```

## <a name="related-patterns-and-guidance"></a><span data-ttu-id="c71ef-195">Zugehörige Muster und Anleitungen</span><span class="sxs-lookup"><span data-stu-id="c71ef-195">Related patterns and guidance</span></span>

<span data-ttu-id="c71ef-196">Die folgenden Muster und Anweisungen können für die Implementierung dieses Musters ebenfalls relevant sein:</span><span class="sxs-lookup"><span data-stu-id="c71ef-196">The following patterns and guidance might also be relevant when implementing this pattern:</span></span>

- <span data-ttu-id="c71ef-197">Ein Beispiel für dieses Muster steht auf [GitHub](https://github.com/mspnp/cloud-design-patterns/tree/master/priority-queue).</span><span class="sxs-lookup"><span data-stu-id="c71ef-197">A sample that demonstrates this pattern is available on [GitHub](https://github.com/mspnp/cloud-design-patterns/tree/master/priority-queue).</span></span>

- <span data-ttu-id="c71ef-198">[Einführung in asynchrone Nachrichten](https://msdn.microsoft.com/library/dn589781.aspx).</span><span class="sxs-lookup"><span data-stu-id="c71ef-198">[Asynchronous Messaging Primer](https://msdn.microsoft.com/library/dn589781.aspx).</span></span> <span data-ttu-id="c71ef-199">Ein Consumerdienst, der eine Anforderung verarbeitet, muss möglicherweise eine Antwort an die Instanz der Anwendung senden, die die Anforderung bereitgestellt hat.</span><span class="sxs-lookup"><span data-stu-id="c71ef-199">A consumer service that processes a request might need to send a reply to the instance of the application that posted the request.</span></span> <span data-ttu-id="c71ef-200">Dieser Primer stellt Informationen zu den Strategien bereit, die Sie zur Implementierung von Anforderung/Antwort-Nachrichten implementieren können.</span><span class="sxs-lookup"><span data-stu-id="c71ef-200">Provides information on the strategies that you can use to implement request/response messaging.</span></span>

- <span data-ttu-id="c71ef-201">[Muster „Konkurrierende Consumer“](./competing-consumers.md):</span><span class="sxs-lookup"><span data-stu-id="c71ef-201">[Competing Consumers pattern](./competing-consumers.md).</span></span> <span data-ttu-id="c71ef-202">Um den Durchsatz der Warteschlangen zu erhöhen, können mehrere Consumer auf die gleiche Warteschlange lauschen und die Aufgaben parallel verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="c71ef-202">To increase the throughput of the queues, it’s possible to have multiple consumers that listen on the same queue, and process the tasks in parallel.</span></span> <span data-ttu-id="c71ef-203">Diese Consumer konkurrieren um Nachrichten, doch nur ein Consumer sollte in der Lage sein, die einzelnen Nachrichten zu verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="c71ef-203">These consumers will compete for messages, but only one should be able to process each message.</span></span> <span data-ttu-id="c71ef-204">Dieses Muster bietet weitere Informationen über die Vor- und Nachteile, die sich bei der Implementierung dieser Vorgehensweise ergeben.</span><span class="sxs-lookup"><span data-stu-id="c71ef-204">Provides more information on the benefits and tradeoffs of implementing this approach.</span></span>

- <span data-ttu-id="c71ef-205">[Muster „Drosselung“](./throttling.md):</span><span class="sxs-lookup"><span data-stu-id="c71ef-205">[Throttling pattern](./throttling.md).</span></span> <span data-ttu-id="c71ef-206">Sie können Drosselungen über Warteschlangen implementieren.</span><span class="sxs-lookup"><span data-stu-id="c71ef-206">You can implement throttling by using queues.</span></span> <span data-ttu-id="c71ef-207">Anhand von Prioritätsnachrichten kann sichergestellt werden, dass Anforderungen von kritischen Anwendungen oder Anwendungen, die von wichtigen Kunden ausgeführt werden, Vorrang gegenüber Anforderungen von weniger wichtigen Anwendungen haben.</span><span class="sxs-lookup"><span data-stu-id="c71ef-207">Priority messaging can be used to ensure that requests from critical applications, or applications being run by high-value customers, are given priority over requests from less important applications.</span></span>

- <span data-ttu-id="c71ef-208">[Leitfaden für die automatische Skalierung](https://msdn.microsoft.com/library/dn589774.aspx):</span><span class="sxs-lookup"><span data-stu-id="c71ef-208">[Autoscaling Guidance](https://msdn.microsoft.com/library/dn589774.aspx).</span></span> <span data-ttu-id="c71ef-209">Die Größe des Pools von Consumerprozessen, die eine Warteschlange verarbeiten, kann abhängig von der Länge der Warteschlange skaliert werden.</span><span class="sxs-lookup"><span data-stu-id="c71ef-209">It might be possible to scale the size of the pool of consumer processes handling a queue depending on the length of the queue.</span></span> <span data-ttu-id="c71ef-210">Diese Strategie kann helfen, um die Leistung insbesondere bei Pools zu verbessern, die Nachrichten mit hoher Priorität verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="c71ef-210">This strategy can help to improve performance, especially for pools handling high priority messages.</span></span>

- <span data-ttu-id="c71ef-211">[Enterprise Integration Patterns with Service Bus](https://abhishekrlal.com/2013/01/11/enterprise-integration-patterns-with-service-bus-part-2/) (Unternehmensintegrationsmuster mit Service Bus) im Blog von Abhishek Lal</span><span class="sxs-lookup"><span data-stu-id="c71ef-211">[Enterprise Integration Patterns with Service Bus](https://abhishekrlal.com/2013/01/11/enterprise-integration-patterns-with-service-bus-part-2/) on Abhishek Lal’s blog.</span></span>
