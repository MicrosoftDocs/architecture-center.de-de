---
title: Wiederholungsmuster
titleSuffix: Cloud Design Patterns
description: Ermöglichen Sie einer Anwendung beim Herstellen einer Verbindung mit einem Dienst oder einer Netzwerkressource die Behandlung antizipierter, temporärer Fehler, indem ein zuvor nicht erfolgreich durchgeführter Vorgang transparent wiederholt wird.
keywords: Entwurfsmuster
author: dragon119
ms.date: 06/23/2017
ms.topic: design-pattern
ms.service: architecture-center
ms.subservice: cloud-fundamentals
ms.custom: seodec18
ms.openlocfilehash: 8d37bc2aed17bfef4d54f29f269b23ce4a5c52c0
ms.sourcegitcommit: 273e690c0cfabbc3822089c7d8bc743ef41d2b6e
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 02/08/2019
ms.locfileid: "55897659"
---
# <a name="retry-pattern"></a><span data-ttu-id="f9110-104">Wiederholungsmuster</span><span class="sxs-lookup"><span data-stu-id="f9110-104">Retry pattern</span></span>

[!INCLUDE [header](../_includes/header.md)]

<span data-ttu-id="f9110-105">Ermöglichen Sie einer Anwendung beim Herstellen einer Verbindung mit einem Dienst oder einer Netzwerkressource die Behandlung vorübergehender Fehler, indem ein fehlgeschlagener Vorgang transparent wiederholt wird.</span><span class="sxs-lookup"><span data-stu-id="f9110-105">Enable an application to handle transient failures when it tries to connect to a service or network resource, by transparently retrying a failed operation.</span></span> <span data-ttu-id="f9110-106">Dies kann die Stabilität der Anwendung verbessern.</span><span class="sxs-lookup"><span data-stu-id="f9110-106">This can improve the stability of the application.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="f9110-107">Kontext und Problem</span><span class="sxs-lookup"><span data-stu-id="f9110-107">Context and problem</span></span>

<span data-ttu-id="f9110-108">Eine Anwendung, die mit in der Cloud ausgeführten Elementen kommuniziert, muss gegenüber vorübergehenden Fehlern empfindlich sein, die in dieser Umgebung auftreten können.</span><span class="sxs-lookup"><span data-stu-id="f9110-108">An application that communicates with elements running in the cloud has to be sensitive to the transient faults that can occur in this environment.</span></span> <span data-ttu-id="f9110-109">Fehler umfassen den vorübergehenden Verlust der Netzwerkkonnektivität mit Komponenten und Diensten, die vorübergehende Nichtverfügbarkeit eines Diensts oder Timeouts, die auftreten, wenn ein Dienst ausgelastet ist.</span><span class="sxs-lookup"><span data-stu-id="f9110-109">Faults include the momentary loss of network connectivity to components and services, the temporary unavailability of a service, or timeouts that occur when a service is busy.</span></span>

<span data-ttu-id="f9110-110">Diese Fehler werden in der Regel automatisch behoben, und wenn die Aktion, die einen Fehler ausgelöst hat, nach einer angemessenen Verzögerung wiederholt wird, wird sie wahrscheinlich erfolgreich ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="f9110-110">These faults are typically self-correcting, and if the action that triggered a fault is repeated after a suitable delay it's likely to be successful.</span></span> <span data-ttu-id="f9110-111">Beispielsweise kann ein Datenbankdienst, der eine große Anzahl gleichzeitiger Anforderungen verarbeitet, eine Drosselungsstrategie implementieren, durch die weitere Anforderungen vorübergehend abgelehnt werden, bis die Arbeitsauslastung abgenommen hat.</span><span class="sxs-lookup"><span data-stu-id="f9110-111">For example, a database service that's processing a large number of concurrent requests can implement a throttling strategy that temporarily rejects any further requests until its workload has eased.</span></span> <span data-ttu-id="f9110-112">Eine Anwendung, die auf die Datenbank zuzugreifen versucht, kann möglicherweise keine Verbindung herstellen, doch ist bei einem wiederholten Versuch nach einer Verzögerung der Zugriff möglich.</span><span class="sxs-lookup"><span data-stu-id="f9110-112">An application trying to access the database might fail to connect, but if it tries again after a delay it might succeed.</span></span>

## <a name="solution"></a><span data-ttu-id="f9110-113">Lösung</span><span class="sxs-lookup"><span data-stu-id="f9110-113">Solution</span></span>

<span data-ttu-id="f9110-114">In der Cloud sind vorübergehende Fehler nicht ungewöhnlich, und eine Anwendung sollte so entworfen sein, dass diese elegant und transparent behandelt werden.</span><span class="sxs-lookup"><span data-stu-id="f9110-114">In the cloud, transient faults aren't uncommon and an application should be designed to handle them elegantly and transparently.</span></span> <span data-ttu-id="f9110-115">Dadurch verringern sich die Auswirkungen, die Fehler auf die Geschäftsaufgaben haben können, die von der Anwendung ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="f9110-115">This minimizes the effects faults can have on the business tasks the application is performing.</span></span>

<span data-ttu-id="f9110-116">Wenn eine Anwendung beim Senden einer Anforderung an einen Remotedienst einen Fehler erkennt, kann dieser mithilfe der folgenden Strategien behandelt werden:</span><span class="sxs-lookup"><span data-stu-id="f9110-116">If an application detects a failure when it tries to send a request to a remote service, it can handle the failure using the following strategies:</span></span>

- <span data-ttu-id="f9110-117">**Abbrechen**.</span><span class="sxs-lookup"><span data-stu-id="f9110-117">**Cancel**.</span></span> <span data-ttu-id="f9110-118">Wenn der Fehler anzeigt, dass er nicht vorübergehend ist oder durch eine Wiederholung wahrscheinlich nicht erfolgreich behoben werden kann, sollte die Anwendung den Vorgang abbrechen und eine Ausnahme melden.</span><span class="sxs-lookup"><span data-stu-id="f9110-118">If the fault indicates that the failure isn't transient or is unlikely to be successful if repeated, the application should cancel the operation and report an exception.</span></span> <span data-ttu-id="f9110-119">Beispielsweise kann ein Authentifizierungsfehler, der durch Bereitstellung ungültiger Anmeldeinformationen entsteht, wahrscheinlich nicht erfolgreich behoben werden, unabhängig davon, wie oft dies versucht wird.</span><span class="sxs-lookup"><span data-stu-id="f9110-119">For example, an authentication failure caused by providing invalid credentials is not likely to succeed no matter how many times it's attempted.</span></span>

- <span data-ttu-id="f9110-120">**Wiederholen**.</span><span class="sxs-lookup"><span data-stu-id="f9110-120">**Retry**.</span></span> <span data-ttu-id="f9110-121">Ist der gemeldete Fehler ungewöhnlich oder selten, wurde er möglicherweise durch ungewöhnliche Umstände verursacht, wie z. B. ein Netzwerkpaket, das während der Übertragung beschädigt wurde.</span><span class="sxs-lookup"><span data-stu-id="f9110-121">If the specific fault reported is unusual or rare, it might have been caused by unusual circumstances such as a network packet becoming corrupted while it was being transmitted.</span></span> <span data-ttu-id="f9110-122">In diesem Fall kann die Anwendung die fehlgeschlagene Anforderung sofort wiederholen, da der gleiche Fehler wahrscheinlich nicht erneut auftreten wird und die Anforderung dann erfolgreich ausgeführt werden kann.</span><span class="sxs-lookup"><span data-stu-id="f9110-122">In this case, the application could retry the failing request again immediately because the same failure is unlikely to be repeated and the request will probably be successful.</span></span>

- <span data-ttu-id="f9110-123">**Wiederholen nach Verzögerung**.</span><span class="sxs-lookup"><span data-stu-id="f9110-123">**Retry after delay**.</span></span> <span data-ttu-id="f9110-124">Wenn der Fehler durch einen der eher häufig auftretenden Konnektivitäts- oder Auslastungsfehler verursacht wird, benötigt das Netzwerk oder der Dienst möglicherweise eine kurze Zeit, um die Verbindungsprobleme zu beheben oder die Arbeitsrückstände aufzuarbeiten.</span><span class="sxs-lookup"><span data-stu-id="f9110-124">If the fault is caused by one of the more commonplace connectivity or busy failures, the network or service might need a short period while the connectivity issues are corrected or the backlog of work is cleared.</span></span> <span data-ttu-id="f9110-125">Die Anwendung sollte eine entsprechende Zeit lang warten, bevor die Anforderung wiederholt wird.</span><span class="sxs-lookup"><span data-stu-id="f9110-125">The application should wait for a suitable time before retrying the request.</span></span>

<span data-ttu-id="f9110-126">Bei häufiger auftretenden vorübergehenden Fehlern sollte der Zeitraum zwischen den Wiederholungen so gewählt werden, dass Anforderungen von mehreren Instanzen der Anwendung so gleichmäßig wie möglich verteilt werden.</span><span class="sxs-lookup"><span data-stu-id="f9110-126">For the more common transient failures, the period between retries should be chosen to spread requests from multiple instances of the application as evenly as possible.</span></span> <span data-ttu-id="f9110-127">Dadurch sinkt die Wahrscheinlichkeit, dass ein ausgelasteter Dienst weiterhin überlastet wird.</span><span class="sxs-lookup"><span data-stu-id="f9110-127">This reduces the chance of a busy service continuing to be overloaded.</span></span> <span data-ttu-id="f9110-128">Wenn viele Instanzen einer Anwendung einen Dienst ständig mit Wiederholungsanforderungen überlasten, benötigt der Dienst mehr Zeit zur Wiederherstellung.</span><span class="sxs-lookup"><span data-stu-id="f9110-128">If many instances of an application are continually overwhelming a service with retry requests, it'll take the service longer to recover.</span></span>

<span data-ttu-id="f9110-129">Schlägt die Anforderung immer noch fehl, kann die Anwendung warten und einen erneuten Versuch unternehmen.</span><span class="sxs-lookup"><span data-stu-id="f9110-129">If the request still fails, the application can wait and make another attempt.</span></span> <span data-ttu-id="f9110-130">Bei Bedarf kann dieser Vorgang mit zunehmender Verzögerung zwischen den Wiederholungsversuchen ausgeführt werden, bis eine maximale Anzahl von Anforderungsversuchen unternommen wurde.</span><span class="sxs-lookup"><span data-stu-id="f9110-130">If necessary, this process can be repeated with increasing delays between retry attempts, until some maximum number of requests have been attempted.</span></span> <span data-ttu-id="f9110-131">Die Verzögerung kann inkrementell oder exponentiell erhöht werden, je nach Art des Fehlers und der Wahrscheinlichkeit, dass er während dieser Zeit behoben wird.</span><span class="sxs-lookup"><span data-stu-id="f9110-131">The delay can be increased incrementally or exponentially, depending on the type of failure and the probability that it'll be corrected during this time.</span></span>

<span data-ttu-id="f9110-132">Das folgende Diagramm veranschaulicht das Aufrufen eines Vorgangs in einem gehosteten Dienst mithilfe dieses Musters.</span><span class="sxs-lookup"><span data-stu-id="f9110-132">The following diagram illustrates invoking an operation in a hosted service using this pattern.</span></span> <span data-ttu-id="f9110-133">Wenn die Anforderung nach einer vordefinierten Anzahl von Versuchen nicht erfolgreich ausgeführt werden kann, sollte die Anwendung den Fehler als Ausnahme behandeln und entsprechend vorgehen.</span><span class="sxs-lookup"><span data-stu-id="f9110-133">If the request is unsuccessful after a predefined number of attempts, the application should treat the fault as an exception and handle it accordingly.</span></span>

![Abbildung 1: Aufrufen eines Vorgangs in einem gehosteten Dienst mithilfe des Wiederholungsmusters](./_images/retry-pattern.png)

<span data-ttu-id="f9110-135">Die Anwendung sollte alle Zugriffsversuche auf einen Remotedienst in Code einschließen, der eine Wiederholungsrichtlinie implementiert, die einer der oben aufgeführten Strategien entspricht.</span><span class="sxs-lookup"><span data-stu-id="f9110-135">The application should wrap all attempts to access a remote service in code that implements a retry policy matching one of the strategies listed above.</span></span> <span data-ttu-id="f9110-136">Anforderungen, die an verschiedene Dienste gesendet werden, können unterschiedliche Richtlinien unterliegen.</span><span class="sxs-lookup"><span data-stu-id="f9110-136">Requests sent to different services can be subject to different policies.</span></span> <span data-ttu-id="f9110-137">Einige Anbieter stellen Bibliotheken bereit, die Wiederholungsrichtlinien implementieren, in denen die Anwendung die maximale Anzahl von Wiederholungen, die Zeit zwischen Wiederholungsversuchen und andere Parameter angeben kann.</span><span class="sxs-lookup"><span data-stu-id="f9110-137">Some vendors provide libraries that implement retry policies, where the application can specify the maximum number of retries, the time between retry attempts, and other parameters.</span></span>

<span data-ttu-id="f9110-138">Eine Anwendung sollte die Details der Fehler und fehlgeschlagenen Vorgänge protokollieren.</span><span class="sxs-lookup"><span data-stu-id="f9110-138">An application should log the details of faults and failing operations.</span></span> <span data-ttu-id="f9110-139">Diese Informationen sind für Betreiber nützlich.</span><span class="sxs-lookup"><span data-stu-id="f9110-139">This information is useful to operators.</span></span> <span data-ttu-id="f9110-140">Wenn ein Dienst häufig nicht verfügbar oder ausgelastet ist, liegt dies oft daran, dass die Ressourcen des Diensts ausgeschöpft sind.</span><span class="sxs-lookup"><span data-stu-id="f9110-140">If a service is frequently unavailable or busy, it's often because the service has exhausted its resources.</span></span> <span data-ttu-id="f9110-141">Sie können die Häufigkeit dieser Fehler reduzieren, indem Sie den Dienst horizontal skalieren.</span><span class="sxs-lookup"><span data-stu-id="f9110-141">You can reduce the frequency of these faults by scaling out the service.</span></span> <span data-ttu-id="f9110-142">Wenn beispielsweise ein Datenbankdienst ständig überlastet ist, kann es nützlich sein, die Datenbank zu partitionieren und die Last auf mehrere Server zu verteilen.</span><span class="sxs-lookup"><span data-stu-id="f9110-142">For example, if a database service is continually overloaded, it might be beneficial to partition the database and spread the load across multiple servers.</span></span>

> <span data-ttu-id="f9110-143">[Microsoft Entity Framework](https://docs.microsoft.com/ef/) bietet Funktionen für das Wiederholen von Datenbankvorgängen.</span><span class="sxs-lookup"><span data-stu-id="f9110-143">[Microsoft Entity Framework](https://docs.microsoft.com/ef/) provides facilities for retrying database operations.</span></span> <span data-ttu-id="f9110-144">Auch die meisten Azure-Dienste und Client-SDKs enthalten einen Wiederholungsmechanismus.</span><span class="sxs-lookup"><span data-stu-id="f9110-144">Also, most Azure services and client SDKs include a retry mechanism.</span></span> <span data-ttu-id="f9110-145">Weitere Informationen finden Sie unter [Wiederholungsanleitung für bestimmte Dienste](/azure/architecture/best-practices/retry-service-specific).</span><span class="sxs-lookup"><span data-stu-id="f9110-145">For more information, see [Retry guidance for specific services](/azure/architecture/best-practices/retry-service-specific).</span></span>

## <a name="issues-and-considerations"></a><span data-ttu-id="f9110-146">Probleme und Überlegungen</span><span class="sxs-lookup"><span data-stu-id="f9110-146">Issues and considerations</span></span>

<span data-ttu-id="f9110-147">Bei der Entscheidung, wie dieses Muster implementiert werden soll, sind die folgenden Punkte zu beachten.</span><span class="sxs-lookup"><span data-stu-id="f9110-147">You should consider the following points when deciding how to implement this pattern.</span></span>

<span data-ttu-id="f9110-148">Die Wiederholungsrichtlinie sollte entsprechend den geschäftlichen Anforderungen der Anwendung und der Art des Fehlers angepasst werden.</span><span class="sxs-lookup"><span data-stu-id="f9110-148">The retry policy should be tuned to match the business requirements of the application and the nature of the failure.</span></span> <span data-ttu-id="f9110-149">Bei einigen nicht kritischen Vorgängen ist es besser, Fail-Fast-fähig zu sein, statt sie mehrere Male zu wiederholen und dadurch den Durchsatz der Anwendung zu verringern.</span><span class="sxs-lookup"><span data-stu-id="f9110-149">For some noncritical operations, it's better to fail fast rather than retry several times and impact the throughput of the application.</span></span> <span data-ttu-id="f9110-150">Bei einer interaktiven Webanwendung, die auf einen Remotedienst zugreift, ist es beispielsweise besser, nach einer kleineren Anzahl von Wiederholungen mit nur einer kurzen Verzögerung zwischen den Wiederholungsversuchen einen Fehler auszugeben und dem Benutzer eine entsprechende Meldung anzuzeigen (z. B. „Versuchen Sie es später noch einmal“).</span><span class="sxs-lookup"><span data-stu-id="f9110-150">For example, in an interactive web application accessing a remote service, it's better to fail after a smaller number of retries with only a short delay between retry attempts, and display a suitable message to the user (for example, “please try again later”).</span></span> <span data-ttu-id="f9110-151">Bei einer Batchanwendung ist es möglicherweise besser, die Anzahl der Wiederholungsversuche mit einer exponentiell zunehmenden Verzögerung zwischen den einzelnen Versuchen zu erhöhen.</span><span class="sxs-lookup"><span data-stu-id="f9110-151">For a batch application, it might be more appropriate to increase the number of retry attempts with an exponentially increasing delay between attempts.</span></span>

<span data-ttu-id="f9110-152">Durch eine aggressive Wiederholungsrichtlinie mit minimaler Verzögerung zwischen den Versuchen und einer großen Anzahl von Wiederholungen kann ein ausgelasteter Dienst, der nahe oder an seiner Kapazitätsgrenze ausgeführt wird, zusätzlich beeinträchtigt werden.</span><span class="sxs-lookup"><span data-stu-id="f9110-152">An aggressive retry policy with minimal delay between attempts, and a large number of retries, could further degrade a busy service that's running close to or at capacity.</span></span> <span data-ttu-id="f9110-153">Diese Wiederholungsrichtlinie könnte sich auch auf die Reaktionsfähigkeit der Anwendung auswirken, wenn ständig versucht wird, einen fehlgeschlagenen Vorgang auszuführen.</span><span class="sxs-lookup"><span data-stu-id="f9110-153">This retry policy could also affect the responsiveness of the application if it's continually trying to perform a failing operation.</span></span>

<span data-ttu-id="f9110-154">Wenn eine Anforderung nach einer erheblichen Anzahl von Wiederholungen immer noch fehlschlägt, ist es besser, wenn die Anwendung weitere Anforderungen an die gleiche Ressource verhindert und einfach sofort einen Fehler meldet.</span><span class="sxs-lookup"><span data-stu-id="f9110-154">If a request still fails after a significant number of retries, it's better for the application to prevent further requests going to the same resource and simply report a failure immediately.</span></span> <span data-ttu-id="f9110-155">Nach Ablauf des Zeitraums kann die Anwendung eine oder mehrere Anforderungen vorläufig zulassen, um festzustellen, ob diese erfolgreich ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="f9110-155">When the period expires, the application can tentatively allow one or more requests through to see whether they're successful.</span></span> <span data-ttu-id="f9110-156">Weitere Informationen zu dieser Strategie finden Sie unter [Trennschalter-Muster](./circuit-breaker.md).</span><span class="sxs-lookup"><span data-stu-id="f9110-156">For more details of this strategy, see the [Circuit Breaker pattern](./circuit-breaker.md).</span></span>

<span data-ttu-id="f9110-157">Achten Sie darauf, ob der Vorgang idempotent ist.</span><span class="sxs-lookup"><span data-stu-id="f9110-157">Consider whether the operation is idempotent.</span></span> <span data-ttu-id="f9110-158">Wenn das der Fall ist, ist eine Wiederholung grundsätzlich sicher.</span><span class="sxs-lookup"><span data-stu-id="f9110-158">If so, it's inherently safe to retry.</span></span> <span data-ttu-id="f9110-159">Andernfalls könnte der Vorgang bei Wiederholungen mehr als einmal ausgeführt werden, was unbeabsichtigte Nebeneffekte haben kann.</span><span class="sxs-lookup"><span data-stu-id="f9110-159">Otherwise, retries could cause the operation to be executed more than once, with unintended side effects.</span></span> <span data-ttu-id="f9110-160">Beispielsweise kann ein Dienst die Anforderung empfangen, sie erfolgreich verarbeiten, jedoch das Senden einer Antwort fehlschlagen.</span><span class="sxs-lookup"><span data-stu-id="f9110-160">For example, a service might receive the request, process the request successfully, but fail to send a response.</span></span> <span data-ttu-id="f9110-161">An diesem Punkt kann die Wiederholungslogik die Anforderung erneut senden, da davon ausgegangen wird, dass die erste Anforderung nicht empfangen wurde.</span><span class="sxs-lookup"><span data-stu-id="f9110-161">At that point, the retry logic might re-send the request, assuming that the first request wasn't received.</span></span>

<span data-ttu-id="f9110-162">Eine Anforderung an einen Dienst kann aus einer Vielzahl von Gründen fehlschlagen, die je nach Art des Fehlers verschiedene Ausnahmen auslösen.</span><span class="sxs-lookup"><span data-stu-id="f9110-162">A request to a service can fail for a variety of reasons raising different exceptions depending on the nature of the failure.</span></span> <span data-ttu-id="f9110-163">Einige Ausnahmen geben einen Fehler an, der schnell behoben werden kann, während andere angeben, dass der Fehler länger andauert.</span><span class="sxs-lookup"><span data-stu-id="f9110-163">Some exceptions indicate a failure that can be resolved quickly, while others indicate that the failure is longer lasting.</span></span> <span data-ttu-id="f9110-164">Es ist nützlich, wenn bei der Wiederholungsrichtlinie der Zeitraum zwischen den Wiederholungsversuchen entsprechend dem Typ der Ausnahme angepasst wird.</span><span class="sxs-lookup"><span data-stu-id="f9110-164">It's useful for the retry policy to adjust the time between retry attempts based on the type of the exception.</span></span>

<span data-ttu-id="f9110-165">Beachten Sie, wie sich das Wiederholen eines Vorgangs, der Teil einer Transaktion ist, auf die Transaktionskonsistenz insgesamt auswirkt.</span><span class="sxs-lookup"><span data-stu-id="f9110-165">Consider how retrying an operation that's part of a transaction will affect the overall transaction consistency.</span></span> <span data-ttu-id="f9110-166">Nehmen Sie eine Feinanpassung der Wiederholungsrichtlinie für Transaktionsvorgänge vor, um die Wahrscheinlichkeit einer erfolgreichen Ausführung zu erhöhen und die Notwendigkeit zu verringern, alle Transaktionsschritte rückgängig zu machen.</span><span class="sxs-lookup"><span data-stu-id="f9110-166">Fine tune the retry policy for transactional operations to maximize the chance of success and reduce the need to undo all the transaction steps.</span></span>

<span data-ttu-id="f9110-167">Stellen Sie sicher, dass der gesamte Wiederholungscode vollständig für eine Vielzahl von Fehlerbedingungen getestet ist.</span><span class="sxs-lookup"><span data-stu-id="f9110-167">Ensure that all retry code is fully tested against a variety of failure conditions.</span></span> <span data-ttu-id="f9110-168">Vergewissern Sie sich, dass er keine schwerwiegenden Auswirkungen auf die Leistungsfähigkeit oder Zuverlässigkeit der Anwendung hat, keine übermäßige Auslastung von Diensten und Ressourcen bewirkt und auch keine Racebedingungen oder Engpässe erzeugt.</span><span class="sxs-lookup"><span data-stu-id="f9110-168">Check that it doesn't severely impact the performance or reliability of the application, cause excessive load on services and resources, or generate race conditions or bottlenecks.</span></span>

<span data-ttu-id="f9110-169">Implementieren Sie eine Wiederholungslogik nur unter Berücksichtigung des gesamten Kontexts eines fehlgeschlagenen Vorgangs.</span><span class="sxs-lookup"><span data-stu-id="f9110-169">Implement retry logic only where the full context of a failing operation is understood.</span></span> <span data-ttu-id="f9110-170">Wenn beispielsweise eine Aufgabe, die eine Wiederholungsrichtlinie enthält, eine andere Aufgabe aufruft, die ebenfalls eine Wiederholungsrichtlinie enthält, kann diese zusätzliche Ebene von Wiederholungen zu lange Verzögerungen bei der Verarbeitung führen.</span><span class="sxs-lookup"><span data-stu-id="f9110-170">For example, if a task that contains a retry policy invokes another task that also contains a retry policy, this extra layer of retries can add long delays to the processing.</span></span> <span data-ttu-id="f9110-171">Möglicherweise ist es besser, die Aufgabe auf niedrigerer Ebene so zu konfigurieren, dass sie Fail-Fast-fähig ist und die Ursache des Fehlers an die Aufgabe zurückmeldet, von der sie aufgerufen wurde.</span><span class="sxs-lookup"><span data-stu-id="f9110-171">It might be better to configure the lower-level task to fail fast and report the reason for the failure back to the task that invoked it.</span></span> <span data-ttu-id="f9110-172">Diese Aufgabe auf höherer Ebene kann dann den Fehler basierend auf ihrer eigenen Richtlinie behandeln.</span><span class="sxs-lookup"><span data-stu-id="f9110-172">This higher-level task can then handle the failure based on its own policy.</span></span>

<span data-ttu-id="f9110-173">Es ist wichtig, alle Konnektivitätsfehler zu protokollieren, die zu einer Wiederholung führen, damit zugrunde liegende Probleme mit der Anwendung, Diensten oder Ressourcen ermittelt werden können.</span><span class="sxs-lookup"><span data-stu-id="f9110-173">It's important to log all connectivity failures that cause a retry so that underlying problems with the application, services, or resources can be identified.</span></span>

<span data-ttu-id="f9110-174">Untersuchen Sie die Fehler, die am wahrscheinlichsten für einen Dienst oder eine Ressource auftreten können, um festzustellen, ob diese wahrscheinlich lang andauernd oder terminal sind.</span><span class="sxs-lookup"><span data-stu-id="f9110-174">Investigate the faults that are most likely to occur for a service or a resource to discover if they're likely to be long lasting or terminal.</span></span> <span data-ttu-id="f9110-175">Wenn das der Fall ist, sollte der Fehler besser als Ausnahme behandelt werden.</span><span class="sxs-lookup"><span data-stu-id="f9110-175">If they are, it's better to handle the fault as an exception.</span></span> <span data-ttu-id="f9110-176">Die Anwendung kann die Ausnahme melden oder protokollieren und dann fortfahren, indem entweder ein alternativer Dienst (sofern verfügbar) aufgerufen oder eingeschränkte Funktionalität geboten wird.</span><span class="sxs-lookup"><span data-stu-id="f9110-176">The application can report or log the exception, and then try to continue either by invoking an alternative service (if one is available), or by offering degraded functionality.</span></span> <span data-ttu-id="f9110-177">Weitere Informationen zum Erkennen und Behandeln lang andauernder Fehler finden Sie unter der [Trennschalter-Muster](./circuit-breaker.md).</span><span class="sxs-lookup"><span data-stu-id="f9110-177">For more information on how to detect and handle long-lasting faults, see the [Circuit Breaker pattern](./circuit-breaker.md).</span></span>

## <a name="when-to-use-this-pattern"></a><span data-ttu-id="f9110-178">Verwendung dieses Musters</span><span class="sxs-lookup"><span data-stu-id="f9110-178">When to use this pattern</span></span>

<span data-ttu-id="f9110-179">Verwenden Sie dieses Muster, wenn es bei einer Anwendung zu vorübergehenden Fehlern bei der Interaktion mit einem Remotedienst oder dem Zugriff auf eine Remoteressource kommen kann.</span><span class="sxs-lookup"><span data-stu-id="f9110-179">Use this pattern when an application could experience transient faults as it interacts with a remote service or accesses a remote resource.</span></span> <span data-ttu-id="f9110-180">Diese Fehler sind erwartungsgemäß von kurzer Dauer und das Wiederholen einer zuvor fehlgeschlagenen Anforderung kann bei einem weiteren Versuch erfolgreich sein.</span><span class="sxs-lookup"><span data-stu-id="f9110-180">These faults are expected to be short lived, and repeating a request that has previously failed could succeed on a subsequent attempt.</span></span>

<span data-ttu-id="f9110-181">Dieses Muster ist in folgenden Fällen möglicherweise nicht geeignet:</span><span class="sxs-lookup"><span data-stu-id="f9110-181">This pattern might not be useful:</span></span>

- <span data-ttu-id="f9110-182">Wenn ein Fehler wahrscheinlich länger andauert, da sich dies auf die Reaktionsfähigkeit einer Anwendung auswirken kann.</span><span class="sxs-lookup"><span data-stu-id="f9110-182">When a fault is likely to be long lasting, because this can affect the responsiveness of an application.</span></span> <span data-ttu-id="f9110-183">Die Anwendung verschwendet möglicherweise Zeit und Ressourcen bei dem Versuch, eine Anforderung zu wiederholen, die wahrscheinlich fehlschlägt.</span><span class="sxs-lookup"><span data-stu-id="f9110-183">The application might be wasting time and resources trying to repeat a request that's likely to fail.</span></span>
- <span data-ttu-id="f9110-184">Bei der Behandlung von Fehlern, die nicht auf vorübergehenden Fehlern basieren, z. B. interne Ausnahmen, die auf Fehler in der Geschäftslogik einer Anwendung zurückzuführen sind.</span><span class="sxs-lookup"><span data-stu-id="f9110-184">For handling failures that aren't due to transient faults, such as internal exceptions caused by errors in the business logic of an application.</span></span>
- <span data-ttu-id="f9110-185">Als Alternative zur Behebung von Skalierbarkeitsproblemen in einem System.</span><span class="sxs-lookup"><span data-stu-id="f9110-185">As an alternative to addressing scalability issues in a system.</span></span> <span data-ttu-id="f9110-186">Wenn bei einer Anwendung häufig Auslastungsfehler auftreten, ist dies oft ein Zeichen dafür, dass der Dienst oder die Ressource, auf den bzw. die zugegriffen wird, hochskaliert werden sollte.</span><span class="sxs-lookup"><span data-stu-id="f9110-186">If an application experiences frequent busy faults, it's often a sign that the service or resource being accessed should be scaled up.</span></span>

## <a name="example"></a><span data-ttu-id="f9110-187">Beispiel</span><span class="sxs-lookup"><span data-stu-id="f9110-187">Example</span></span>

<span data-ttu-id="f9110-188">Dieses Beispiel in C# zeigt eine Implementierung des Wiederholungsmusters.</span><span class="sxs-lookup"><span data-stu-id="f9110-188">This example in C# illustrates an implementation of the Retry pattern.</span></span> <span data-ttu-id="f9110-189">Die unten gezeigte Methode `OperationWithBasicRetryAsync` ruft einen externen Dienst asynchron über die Methode `TransientOperationAsync` auf.</span><span class="sxs-lookup"><span data-stu-id="f9110-189">The `OperationWithBasicRetryAsync` method, shown below, invokes an external service asynchronously through the `TransientOperationAsync` method.</span></span> <span data-ttu-id="f9110-190">Die Details der Methode `TransientOperationAsync` entsprechen dem jeweiligen Dienst und sind im Beispielcode ausgelassen.</span><span class="sxs-lookup"><span data-stu-id="f9110-190">The details of the `TransientOperationAsync` method will be specific to the service and are omitted from the sample code.</span></span>

```csharp
private int retryCount = 3;
private readonly TimeSpan delay = TimeSpan.FromSeconds(5);

public async Task OperationWithBasicRetryAsync()
{
  int currentRetry = 0;

  for (;;)
  {
    try
    {
      // Call external service.
      await TransientOperationAsync();

      // Return or break.
      break;
    }
    catch (Exception ex)
    {
      Trace.TraceError("Operation Exception");

      currentRetry++;

      // Check if the exception thrown was a transient exception
      // based on the logic in the error detection strategy.
      // Determine whether to retry the operation, as well as how
      // long to wait, based on the retry strategy.
      if (currentRetry > this.retryCount || !IsTransient(ex))
      {
        // If this isn't a transient error or we shouldn't retry,
        // rethrow the exception.
        throw;
      }
    }

    // Wait to retry the operation.
    // Consider calculating an exponential delay here and
    // using a strategy best suited for the operation and fault.
    await Task.Delay(delay);
  }
}

// Async method that wraps a call to a remote service (details not shown).
private async Task TransientOperationAsync()
{
  ...
}
```

<span data-ttu-id="f9110-191">Die Anweisung, mit der diese Methode aufgerufen wird, befindet sich in einem try/catch-Block, der in eine for-Schleife eingeschlossen ist.</span><span class="sxs-lookup"><span data-stu-id="f9110-191">The statement that invokes this method is contained in a try/catch block wrapped in a for loop.</span></span> <span data-ttu-id="f9110-192">Die for-Schleife wird beendet, wenn die `TransientOperationAsync`-Methode erfolgreich aufgerufen und keine Ausnahme ausgelöst wird.</span><span class="sxs-lookup"><span data-stu-id="f9110-192">The for loop exits if the call to the `TransientOperationAsync` method succeeds without throwing an exception.</span></span> <span data-ttu-id="f9110-193">Wenn die `TransientOperationAsync`-Methode fehlschlägt, wird mit dem catch-Block die Ursache des Fehlers überprüft.</span><span class="sxs-lookup"><span data-stu-id="f9110-193">If the `TransientOperationAsync` method fails, the catch block examines the reason for the failure.</span></span> <span data-ttu-id="f9110-194">Wird davon ausgegangen, dass es sich um einen vorübergehenden Fehler handelt, wartet der Code für eine kurzen Verzögerungszeit, bevor der Vorgang wiederholt wird.</span><span class="sxs-lookup"><span data-stu-id="f9110-194">If it's believed to be a transient error the code waits for a short delay before retrying the operation.</span></span>

<span data-ttu-id="f9110-195">Die for-Schleife verfolgt auch die Anzahl, wie oft eine Ausführung des Vorgangs versucht wurde, und wenn der Code dreimal fehlschlägt, wird davon ausgegangen, dass die Ausnahme länger andauert.</span><span class="sxs-lookup"><span data-stu-id="f9110-195">The for loop also tracks the number of times that the operation has been attempted, and if the code fails three times the exception is assumed to be more long lasting.</span></span> <span data-ttu-id="f9110-196">Wenn die Ausnahme nicht vorübergehend ist oder lang andauert, löst der catch-Handler eine Ausnahme aus.</span><span class="sxs-lookup"><span data-stu-id="f9110-196">If the exception isn't transient or it's long lasting, the catch handler throws an exception.</span></span> <span data-ttu-id="f9110-197">Diese Ausnahme beendet die for-Schleife und sollte von dem Code abgefangen werden, der die `OperationWithBasicRetryAsync`-Methode aufruft.</span><span class="sxs-lookup"><span data-stu-id="f9110-197">This exception exits the for loop and should be caught by the code that invokes the `OperationWithBasicRetryAsync` method.</span></span>

<span data-ttu-id="f9110-198">Die unten gezeigte `IsTransient`-Methode prüft auf einen bestimmten Satz von Ausnahmen, die für die Umgebung relevant sind, in der der Code ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="f9110-198">The `IsTransient` method, shown below, checks for a specific set of exceptions that are relevant to the environment the code is run in.</span></span> <span data-ttu-id="f9110-199">Die Definition einer vorübergehenden Ausnahme unterscheidet sich je nach Ressourcen, auf die zugegriffen wird, und der Umgebung, in der der Vorgang ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="f9110-199">The definition of a transient exception will vary according to the resources being accessed and the environment the operation is being performed in.</span></span>

```csharp
private bool IsTransient(Exception ex)
{
  // Determine if the exception is transient.
  // In some cases this is as simple as checking the exception type, in other
  // cases it might be necessary to inspect other properties of the exception.
  if (ex is OperationTransientException)
    return true;

  var webException = ex as WebException;
  if (webException != null)
  {
    // If the web exception contains one of the following status values
    // it might be transient.
    return new[] {WebExceptionStatus.ConnectionClosed,
                  WebExceptionStatus.Timeout,
                  WebExceptionStatus.RequestCanceled }.
            Contains(webException.Status);
  }

  // Additional exception checking logic goes here.
  return false;
}
```

## <a name="related-patterns-and-guidance"></a><span data-ttu-id="f9110-200">Zugehörige Muster und Anleitungen</span><span class="sxs-lookup"><span data-stu-id="f9110-200">Related patterns and guidance</span></span>

- <span data-ttu-id="f9110-201">[Muster „Trennschalter“](./circuit-breaker.md).</span><span class="sxs-lookup"><span data-stu-id="f9110-201">[Circuit Breaker pattern](./circuit-breaker.md).</span></span> <span data-ttu-id="f9110-202">Das Wiederholungsmuster eignet sich zum Behandeln vorübergehender Fehler.</span><span class="sxs-lookup"><span data-stu-id="f9110-202">The Retry pattern is useful for handling transient faults.</span></span> <span data-ttu-id="f9110-203">Wenn bei einem Fehler davon ausgegangen wird, dass er länger andauert, ist es möglicherweise besser, das Trennschalter-Muster zu implementieren.</span><span class="sxs-lookup"><span data-stu-id="f9110-203">If a failure is expected to be more long lasting, it might be more appropriate to implement the Circuit Breaker pattern.</span></span> <span data-ttu-id="f9110-204">Das Wiederholungsmuster kann auch in Verbindung mit einem Trennschalter verwendet werden, um einen umfassenden Ansatz zur Behandlung von Fehlern bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="f9110-204">The Retry pattern can also be used in conjunction with a circuit breaker to provide a comprehensive approach to handling faults.</span></span>
- [<span data-ttu-id="f9110-205">Wiederholungsanleitung für bestimmte Dienste</span><span class="sxs-lookup"><span data-stu-id="f9110-205">Retry guidance for specific services</span></span>](/azure/architecture/best-practices/retry-service-specific)
- [<span data-ttu-id="f9110-206">Verbindungsstabilität</span><span class="sxs-lookup"><span data-stu-id="f9110-206">Connection Resiliency</span></span>](https://docs.microsoft.com/ef/core/miscellaneous/connection-resiliency)
